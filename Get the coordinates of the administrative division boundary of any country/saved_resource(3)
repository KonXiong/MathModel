_.Module.define({path:"creativeplatform/widget/aopApp",requires:[],sub:{initial:function(i){this._initApps(i)},_initApps:function(i){for(var t=i.length,e=0;t>e;e++)this.requireInstanceAsync("creativeplatform/widget/"+i[e])}}});
;_.Module.define({path:"creativeplatform/widget/normalApp",requires:[],sub:{initial:function(i){this._initApps(i)},_initApps:function(i){for(var t=i.length,e=0;t>e;e++)this.requireInstanceAsync("creativeplatform/widget/"+i[e])}}});_.Module.define({path:"common/widget/Card",requires:[],sub:{_option:{},_j_card:null,_open_timer:null,_close_timer:null,_is_show:!1,_is_first_show:!0,_default_option:{content:"",arrow_dir:"down",arrow_pos:{},card_css:{width:170,"z-index":1001},arrow_req:!0,auto_positon:!1,event_target:null,offset:{x:0,y:0},card_leave_display:!1,card_hover_show:!0,card_leave_hide:!1,attr:"",clazz:"",wrap:$("body")},initial:function(t){var i=this;i._option=$.extend(!0,{},i._default_option,t),this._buildCard()},_buildCard:function(){var t=this._option,i=this._genericTpl(),e=t.wrap;this._j_card=$(i),this._j_card.find(".j_content").html(t.content),e.append(this._j_card),delete t.card_css.height,this._j_card.css(t.card_css),t.card_css.height=this._j_card.find(".j_content").outerHeight(!0),this._arrow=this._j_card.find(".j_ui_white_arrow"),void 0===t.arrow_pos.left&&(this._arrow_left=t.card_css.width/2-10,this._arrow.css({left:this._arrow_left})),this._arrow.css(t.arrow_pos),t.arrow_req||this._j_card.find(".j_ui_white_arrow").hide(),t.auto_positon&&this._autoPosition()},_autoPosition:function(){var t=this._option,i={},e=$(window).height(),_=$(window).width(),o=($(document).scrollLeft(),$(document).scrollTop()),r=(t.event_target.innerWidth(),t.event_target.innerHeight()),s="",a={x:t.event_target.offset().left-t.card_css.width/2+t.event_target.outerWidth(!0)/2,y:t.event_target.offset().top-t.card_css.height-10,width:this._j_card.innerWidth(),height:this._j_card.innerHeight()+this._arrow.innerHeight()};i.left=a.x,i.top=a.y;var n=t.arrow_pos.left||this._arrow_left,d=15,h=_;_<$(document).width()&&(h=$(document).width());var c=h-(t.card_css.width+d);i.left<d?(n+=i.left-d,i.left=d):i.left>c&&(n+=i.left-c,i.left=c),i.top<o?(s="up",i.top+=r+(a.height||0),i.top-=t.offset.y):(i.top+=i.top+r>o+e?-r-(a.height||0):0,s="down",i.top+=t.offset.y),this._arrow.removeClass("ui_white_down").removeClass("ui_white_up").addClass("ui_white_"+s).css({left:n}),this._j_card.css(i)},_genericTpl:function(){var t=this._option.attr,i=this._option.arrow_dir,e=this._option.clazz,_=['<div class="ui_card_wrap '+e+'" '+t+' style="visibility: hidden">','<div class="j_content ui_card_content ">',"</div>",'<span class="j_ui_white_arrow arrow ui_white_'+i+'"></span>',"</div>"].join("");return _},showCard:function(t){var i=this;i._close_timer&&clearTimeout(i._close_timer),t&&"delayShow"==t.type?(i._open_timer&&clearTimeout(i._open_timer),i._open_timer=setTimeout(function(){i._showCardDo()},t.time)):i._showCardDo()},closeCard:function(t){var i=this;i._open_timer&&clearTimeout(i._open_timer),t&&"delayClose"==t.type?i._close_timer=setTimeout(function(){i._closeCardDo()},t.time):i._closeCardDo()},hideCard:function(t){var i=this;i._open_timer&&clearTimeout(i._open_timer),t&&"delayHide"==t.type?i._close_timer=setTimeout(function(){i._hideCardDo()},t.time):i._hideCardDo()},_showCardDo:function(){var t=this;t._is_first_show&&(this._j_card.bind("mouseenter",function(){t._option.card_hover_show&&(t._is_show=!0)}),this._j_card.bind("mouseleave",function(){return t._option.card_leave_display?!1:(t._is_show=!1,void(t._option.card_leave_hide?t.hideCard():t.closeCard()))}),t._is_first_show=!1),this._j_card.css({visibility:"visible"})},_closeCardDo:function(){var t=this;this._j_card&&!this._is_show&&t._j_card.remove()},_hideCardDo:function(){var t=this;this._j_card&&!this._is_show&&t._j_card.css({visibility:"hidden"})},setContent:function(t){var i=this._option;if(null!==this._j_card){var e=this._j_card.find(".j_content");e.html(t),i.card_css.height=e.outerHeight(!0),this._j_card.css({height:i.card_css.height}),i.auto_positon&&this._autoPosition()}}}});_.Module.define({path:"common/component/JsPager",sub:{_cfg:{},_amount:0,_center_pos:0,_jwrapper:null,_isNew:!0,_page_template:{normal:'<a href="#url#" index="#page#" #special#>#page#</a>',current:"<span #special#>#page#</span>",prev:'<a href="#url#" index="#page#" #special#>\u4E0A\u4E00\u9875</a>',next:'<a href="#url#" index="#page#" #special#>\u4E0B\u4E00\u9875</a>',head:'<a href="#url#" index="#page#" #special#>\u9996\u9875</a>',tail:'<a href="#url#" index="#page#" #special#>\u5C3E\u9875</a>',prev_disable:'<a href="#url#" index="#page#" #special#>\u4E0A\u4E00\u9875</a>',next_disable:'<a href="#url#" index="#page#" #special#>\u4E0B\u4E00\u9875</a>',head_disable:'<a href="#url#" index="#page#" #special#>\u9996\u9875</a>',tail_disable:'<a href="#url#" index="#page#" #special#>\u5C3E\u9875</a>',status:'<span #special#><span class="js_pager_idx">#page#</span>/<span class="js_pager_total">#total#</span></span>'},_default_cfg:{container:$("body"),amount:10,isHtml:!1,current:1,total:10,mode:0,url:"##",openInNew:!1,showStatus:!1,statusPos:"head",showDisableItem:!1,template:{},classname:{wrapper:"tbui_js_pager",normal:"",current:"current",prev:"prev",next:"next",head:"head",tail:"tail",status:"status",prev_disable:"prev_disable",next_disable:"next_disable",head_disable:"head_disable",tail_disable:"tail_disable"}},initial:function(e){var a=this;if(a._isNew){a._cfg=$.extend({},a._default_cfg,e);var t=a._cfg;t.template=$.extend({},a._page_template,t.template),t.amount=parseInt(t.amount),t.current=parseInt(t.current),t.total=parseInt(t.total),a._amount=t.total>t.amount?t.amount:t.total,a._center_pos=parseInt((a._amount+1)/2)}else a._cfg=$.extend(a._cfg,e);a._amount<=1||(a._cfg.isHtml||a._render(),a._isNew=!1)},_render:function(){var e=this,a=e._cfg,t=[],r="";if(a.showStatus&&"head"===a.statusPos&&t.push(e._generateHtml("status",a.current,a.total)),a.current>1?(t.push(e._generateHtml("head",1)),t.push(e._generateHtml("prev",a.current-1))):a.showDisableItem&&(t.push(e._generateHtml("head_disable",1)),t.push(e._generateHtml("prev_disable",a.current-1))),e._amount){var n,s,l,p;n=a.current-parseInt((e._amount-1)/2),s=a.current+e._center_pos,1>n?(l=1-n,n=1,s+=l,s=s>a.total?a.total:s):s>a.total&&(l=s-a.total,s=a.total,n-=l,n=1>n?1:n);for(var i=n;s>=i;i++)p=i==a.current?"current":"normal",t.push(e._generateHtml(p,i))}if(a.current<a.total?(t.push(e._generateHtml("next",a.current+1)),t.push(e._generateHtml("tail",a.total))):a.showDisableItem&&(t.push(e._generateHtml("next_disable",a.current+1)),t.push(e._generateHtml("tail_disable",a.total))),a.showStatus&&"tail"===a.statusPos&&t.push(e._generateHtml("status",a.current,a.total)),r=t.join(""),e._isNew&&(e._jwrapper=$("<div>",{"class":a.classname.wrapper}),e._jwrapper.bind("click",function(t){return"A"==t.target.nodeName&&("0"!==$(t.target).tbattr("ok")&&e.trigger("pageChange",parseInt($(t.target).tbattr("index"))),0==a.mode)?!1:void 0}),!a.isHtml)){var u=$("string"==typeof a.container?"#"+a.container:a.container);u.empty(),u.append(this._jwrapper)}return a.isHtml?r:void e._jwrapper.html(r)},_generateHtml:function(e,a,t){var r="",n=this._cfg;r=n.template[e],r=r.replace(/#page#/g,a),r=r.replace(/#url#/g,n.url.replace(/\{page\}/g,a)),"undefined"!=typeof t&&(r=r.replace(/#total#/g,t));var s="";return n.classname[e]&&(s+='class="'+n.classname[e]+'"'),n.openInNew&&(s+=" target=_blank"),-1!==e.indexOf("disable")&&(s+=' ok="0"'),r=r.replace(/#special#/,s)}}});_.Module.define({path:"common/widget/LoginDialog",sub:{config:{staticPage:$.tb.location.getProtocol()+"//"+$.tb.location.getHost()+"/tb/static-common/html/pass/v3Jump.html",product:"tb",charset:PageData.charset?PageData.charset:"UTF-8",u:$.tb.location.getHref()},loginWrapper:"tiebaLoginId",$tiebaCustomPassLogin:null,passLoginIns:null,passjumpUrl:"",isHideCloseIcon:!1,initial:function(s){var i=this;s&&(this.passjumpUrl=s.jumpUrl||"",this.isHideCloseIcon=!!s.isHideCloseIcon),this.$tiebaCustomPassLogin=$("#tiebaCustomPassLogin"),this.$tiebaCustomPassLogin[0]?this.showLogin():(this.renderLoginHtml(),setTimeout(function(){i.customPassLogin()},200))},renderLoginHtml:function(){var s='<div id="tiebaCustomPassLogin" class="tieba-custom-pass-login"><div class="tieba-login-background"></div><div class="tieba-login-wrapper"><div id="'+this.loginWrapper+'"></div>'+(this.isHideCloseIcon?"":'<span class="close-btn"></span>')+'<p class="custom-pass-link"><span class="download-tieba-app pass-link">\u4E0B\u8F7D\u8D34\u5427App</span><span class="close-app-qr pass-link">\u5173\u95ED\u4E8C\u7EF4\u7801</span></p><div class="pass-tieba-app-wrapper"><div class="app-download-icon"></div></div></div></div>';$("body").append(s)},customPassLogin:function(){var s=this;!function(i){var a="undefined"!=typeof Env&&Env.server_time?Env.server_time:(new Date).getTime(),t="https://passport";i.JsLoadManager.use([t+".baidu.com/passApi/js/wrapper.js?cdnversion="+Math.floor(a/6e4)],function(){passport.use("login",{tangram:!0,loginVersion:"v4",defaultCss:!1},function(a){s.$tiebaCustomPassLogin=i("#tiebaCustomPassLogin"),s.passLoginIns=new a.passport.login({product:s.config.product,loginType:1,staticPage:s.config.staticPage,charset:s.config.charset,qrcodeCfg:{appName:"\u8D34\u5427",appTitle:'<p class="login-qrcode-title">\u8BF7\u4F7F\u7528 <span class="font-key">\u767E\u5EA6\u8D34\u5427App</span> \u626B\u7801\u767B\u5F55</p><p class="login-qrcode-tip">\u6700\u65B0\u7248\u767E\u5EA6\u8D34\u5427App -\u300C\u6211\u7684\u300D\u53F3\u4E0A\u89D2 - \u626B\u4E00\u626B</p>'},qrcodeLogin:1,hasRegUrl:!0,autosuggest:!0,hasPlaceholder:!0,registerLink:"https://passport.baidu.com/v2/?reg&tpl=tb&u=//tieba.baidu.com",forgetLink:"https://passport.baidu.com/?getpass_index"}),s.passLoginIns.on("loginSuccess",function(i){s.loginSuccess.call(s,i)}),s.passLoginIns.on("loginError",function(i){s.loginError.call(s,i)}),s.passLoginIns.render(s.loginWrapper),s.showLogin(),s.handleEvent()})},!0,"utf-8")}(window.jQuery)},trackLoginHide:function(){$.stats.track("\u8D34\u5427\u767B\u5F55\u7EDF\u8BA1","\u767B\u5F55\u6846\u5173\u95ED","","view")},trackLoginShow:function(){$.stats.track("\u8D34\u5427\u767B\u5F55\u7EDF\u8BA1","\u767B\u5F55\u6846\u6253\u5F00","","view")},loginSuccess:function(s){s.returnValue=!1,$.stats.track("\u8D34\u5427\u767B\u5F55\u7EDF\u8BA1","\u767B\u5F55\u6210\u529F","","click"),localStorage.setItem("LOGIN_TIME",Date.now()),this.passjumpUrl&&/.baidu.com/.test(this.passjumpUrl.split("?")[0])?$.tb.location.setHref(this.passjumpUrl):$.tb.location.reload()},loginError:function(){},showLogin:function(){this.$tiebaCustomPassLogin.find("span.pass-generalError-error").text(""),this.$tiebaCustomPassLogin.show(),this.trackLoginShow()},hideLogin:function(){this.$tiebaCustomPassLogin.hide(),this.toggleTiebaAppWrapper.call(this,!1)},handleEvent:function(){var s=this;s.$tiebaCustomPassLogin.find(".close-btn").click(function(){s.hideLogin.call(s),s.trackLoginHide()}),s.$tiebaCustomPassLogin.find(".download-tieba-app").click(function(){s.toggleTiebaAppWrapper.call(s,!0),$.stats.track("\u8D34\u5427\u767B\u5F55\u7EDF\u8BA1","\u70B9\u51FB\u4E0B\u8F7D\u8D34\u5427App","","click")}),s.$tiebaCustomPassLogin.find(".close-app-qr").click(function(){s.toggleTiebaAppWrapper.call(s,!1)})},toggleTiebaAppWrapper:function(s){var i=this;s?(i.$tiebaCustomPassLogin.find(".pass-tieba-app-wrapper").show(),i.$tiebaCustomPassLogin.find(".download-tieba-app").hide(),i.$tiebaCustomPassLogin.find(".close-app-qr").show()):(i.$tiebaCustomPassLogin.find(".pass-tieba-app-wrapper").hide(),i.$tiebaCustomPassLogin.find(".download-tieba-app").show(),i.$tiebaCustomPassLogin.find(".close-app-qr").hide())}}});_.Module.define({path:"common/widget/UserHead",sub:{initial:function(){this.initOptions()},initOptions:function(){this.options={gif:["1100001","1100002","1100003","1100013","1100015","1100016","1100017","1100019","1100133","1100135"],filter:[]}},getImgFormat:function(t){var r="png";return-1!=$.inArray(t,this.options.gif)&&(r="gif"),r},getHeadUrl:function(t){var r=t.mParr_props&&t.mParr_props.portrait||"",i="";return i=r.end_time>Env.server_time/1e3?r.url:"https:"===$.tb.location.getProtocol()?"https://gss0.bdstatic.com/6LZ1dD3d1sgCo2Kml5_Y_D3/sys/portrait/item/"+t.portrait:"https://gss0.bdstatic.com/6LZ1dD3d1sgCo2Kml5_Y_D3/sys/portrait/item/"+t.portrait},getHeadFrameStyle:function(t,r){var i=t.mParr_props&&t.mParr_props.avatarframe||"",e="",o=null,s={hasFrame:!1,stylestr:""};return i.end_time>Env.server_time/1e3&&(e=i.props_id,o=["width:"+r+"px","height:"+r+"px","padding:10px","background:url(/tb/static-common/img/props/"+r+"/"+e+"."+this.getImgFormat(e)+") no-repeat","border:none","left:-6px","top:-6px"],s={hasFrame:!0,stylestr:o.join(";")}),s}}});_.Module.define({path:"user/widget/userApi",requires:[],sub:{initial:function(){},checkUniversalMembershipOf:function(e){return $.getPageData("mParr_props.level.props_id",0,e)>0&&1e3*$.getPageData("mParr_props.level.end_time",0,e)>1*new Date},checkOverdueSuperMembershipOf:function(e){return 2==$.getPageData("mParr_props.level.props_id")&&1e3*$.getPageData("mParr_props.level.end_time",0,e)<1*new Date},checkSuperMemberShipOf:function(e){return 2===this.getUniversalMemberLevelOf(e)&&1e3*$.getPageData("mParr_props.level.end_time",0,e)>1*new Date},checkSingleForumMembershipOf:function(e,r){var t=$.getPageData("mParr_props.forum_member",0,e);return t?t[r]&&1e3*t[r].end_time>1*new Date:!1},getUniversalMemberLevelOf:function(e){return this.checkUniversalMembershipOf(e)?$.getPageData("mParr_props.level.props_id",0,e):0}}});_.Module.define({path:"common/widget/GlobalSwitch",sub:{judgeOpenAndConvertAsync:function(e,n){var o=!0;try{$.ajax({url:"/mo/q/sync",dataType:"json",timeout:2e3,success:function(e){var n=e.no,t=e.error,r=e.data;if(0===n&&r){var a=r.yy_live_config;o=!(a.yy_pay_open!==PageData.user.open_switch||a.yy_is_convert!==PageData.user.open_convert)}else console.error(t)},complete:function(){n&&!o&&n(),e&&o&&e()}})}catch(t){console.error(t)}},getOpenAndConvertAsync:function(e,n){var o=!1;try{$.ajax({url:"/mo/q/sync",dataType:"json",timeout:2e3,success:function(e){var n=e.no,t=e.error,r=e.data;if(0===n&&r){var a=r.yy_live_config;o=+a.yy_pay_open&&+a.yy_is_convert,PageData.user.open_convert=+a.yy_is_convert,PageData.user.open_switch=+a.yy_pay_open}else console.error(t)},complete:function(){n&&!o&&n(),e&&o&&e()}})}catch(t){console.error(t)}},getSwitch:function(){return PageData.user.open_switch||0},getConvert:function(){return PageData.user.open_convert||0},getScores:function(){return PageData.user.yy_scores||0}}});_.Module.define({path:"user/widget/Icons",requires:["IconCard","IconsBookView","IconsBookTip","IconsBookControl","IconsBookCommon"],sub:{iconClassList:{0:"",1:"icon-crown-vip",2:["icon-crown-super-vip","icon-crown-super-v1","icon-crown-super-v2","icon-crown-super-v3","icon-crown-super-v4","icon-crown-super-v5"],3:["icon-crown-year-vip","icon-crown-year-v1","icon-crown-year-v2","icon-crown-year-v3","icon-crown-year-v4","icon-crown-year-v5"]},overdueSuperIconList:["icon-crown-super-non","icon-crown-super-non1","icon-crown-super-non2","icon-crown-super-non3","icon-crown-super-non4","icon-crown-super-non5"],initial:function(){this._buySlot=$(".j_icon_slot_buy"),this._icon_book_wrap=$(".j_book_icon"),this.common=this.use("IconsBookCommon"),PageUnit.load("icons_category"),this.userApi=this.requireInstance("user/widget/userApi",[])},getCrownIconClass:function(e,i){var n=$.getPageData("vipInfo.v_level",0,e),t=this.userApi.getUniversalMemberLevelOf(e),r=$.getPageData("vipInfo.v_status",0,e);r=parseInt(r,10),t=3===r?3:t;var a="";if(i){if(this.userApi.checkOverdueSuperMembershipOf(e))return this.overdueSuperIconList[n];if(0===t)return a="icon-crown-super-non"}switch(t){case 0:a=this.iconClassList[t];break;case 1:a=this.iconClassList[t];break;case 2:case 3:a=this.iconClassList[t][n]}return a},getPreIconHtml:function(e,i,n){var t={};t.mParr_props=e,i=i||t;var r,a=["\u8D34\u5427\u4F1A\u5458","\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458"],o="",s=Math.round((new Date).getTime()/1e3),c=$.getPageData("forum.forum_id",0);this.userApi.checkSingleForumMembershipOf(i,c)&&(o='<div class="pre_icon_wrap pre_icon_wrap_theme"><a class="icon_tbworld icon-vip3-16" title="\u672C\u5427\u4F1A\u5458" href="/tbmall/tshow" onclick="return false" target="_blank"></a></div>');var l="";return e&&e.level&&e.level.end_time>s?(l=this.getCrownIconClass(i),o='<div class="pre_icon_wrap pre_icon_wrap_theme1">',r=e.level.props_id,o+='<a class="icon_tbworld '+l+'" href="/tbmall/tshow" target="_blank" title="'+a[r-1]+'"></a>',o+="</div>"):n&&(l=this.getCrownIconClass(i,!0),o='<span class="pre_icon_wrap pre_icon_wrap_theme1">',r=$.getPageData("level.props_id",0,e),o+='<a class="icon_tbworld '+l+'" href="/tbmall/tshow" target="_blank" title="'+a[r-1]+'"></a>',o+="</span>"),o},getTbvipIconHtml:function(e,i,n){i=i?i:1,n=n?n:"";var t="";return e&&e.type&&(t='<span class="tbvip_icon_wrap tbvip_icon_wrap_theme'+i+" "+n+'"><a class="icon_tbvip icon_tbvip_type'+e.type+'" href="/tbvip/index"target="_blank" title="'+e.intro+'"></a></span>'),t},getIconsHtml:function(e,i,n){var n=n?n:5,t=e.new_iconinfo,r=0;for(var a in t)r++;var o='<span class="icon_wrap  icon_wrap_theme1">',s=0;if(!t){var c=e.iconinfo;if(c){var l=c[0];o+=this._getOldHtml(l,1)}}for(var _ in t){var p=t[_];if(s==n)break;if($.isEmptyObject(p)){if("1"==_){var c=e.iconinfo;if(!$.isEmptyObject(c)){var l=this._getReplaceIcon(c,t);if(!l)continue;o+=this._getOldHtml(l,1),s++}}}else this.common.isShowDurationIcon(p)&&(o+=this._getIconHtml(p,1),s++)}return o+="</span>"},_getReplaceIcon:function(e,i){if($.isEmptyObject(i))return e[0];for(var n=0;n<e.length;n++){var t=e[n];if(!this._judgeIconInNewiconinfo(i,t))return t}return null},_judgeIconInNewiconinfo:function(e,i){if($.isEmptyObject(e))return!1;if($.isEmptyObject(i))return!1;for(var n in e){var t=e[n];if(t&&t.name==i.name)return!0}return!1},_imgSize:{1:14,2:18},_oldIconTitle:{is_lottery_1:"\u94C1\u724C\u4E16\u754C\u676F\u8FBE\u4EBA",is_lottery_2:"\u94DC\u724C\u4E16\u754C\u676F\u8FBE\u4EBA",is_lottery_3:"\u94F6\u724C\u4E16\u754C\u676F\u8FBE\u4EBA",is_lottery_4:"\u91D1\u724C\u4E16\u754C\u676F\u8FBE\u4EBA",is_coreuser_1:"\u8D34\u5427\u6838\u5FC3\u7528\u6237",is_verify_1:"\u767E\u5EA6\u8D34\u5427\u4F01\u4E1A\u5E73\u53F0\u8BA4\u8BC1",user_type_1:"\u8D34\u5427\u5B9E\u540D\u8BA4\u8BC1",is_battle_1:"\u8D34\u5427\u62F3\u738B",is_welfare_1:"\u798F\u5229\u5370\u8BB0"},_getOldHtml:function(e,i){var n="",t=e.sprite[e.value];if(!t)for(var r in e.sprite){if(e.sprite[r]&&(0!=e.value||"meizhi_level"==e.name)){t=e.sprite[r];break}return n}var a=e.icon+"?stamp="+t.split(",")[0];switch(background='style="background: url('+a+") no-repeat center center; filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src="+a+',sizingMethod=scale); background-size: 14px 14px"',e.name){case"meizhi_level":var o=e.value;o=o?o:0,o>=2&&(o-=2,n+='<a class="old_icon_size" '+background+' class="maizhi_link" href="/p/'+e.meizhi_thread_id+'" target="_blank" title="\u8D34\u5427\u59B9\u7EB8\u8BA4\u8BC1"><span class="icon_meizhi meizhi_level_'+o+'"></span></a>');break;case"is_member":n+='<a class="old_icon_size" '+background+' target="_blank"  class=" icon_fanclub"  title="\u7C89\u4E1D\u4F1A\u5458"></a>';break;default:n+=e.title_url?'<a class="old_icon_size" '+background+' target="_blank"  href="'+e.title_url+'"  title="'+e.title+'"  locate="'+e.name+"_"+e.value+'"> </a>':'<span class="old_icon_size" '+background+' title="'+this._oldIconTitle[e.name+"_"+e.value]+'"  locate="'+e.name+"_"+e.value+'"></span>'}return n},_getIconHtml:function(e,i){var n,t,r,a,o,i=i||1,s=50,c="",l="//tb1.bdstatic.com/tb/cms/com/icon/";if(n=e.sprite[e.value],!n)for(var _ in e.sprite){if(e.sprite[_]&&(0!=e.value||"meizhi_level"==e.name)){n=e.sprite[_];break}return c}t=n.split(","),r=t[0],a=t[1];var p=l+e.category_id+"_"+this._imgSize[i]+".png?stamp="+r;switch(o='style="background: url('+p+") no-repeat -"+a*s+"px  -"+(i-1)*s+'px;"',e.name){case"meizhi_level":var u=e.value;u=u?u:0,u>=2&&(u-=2,c+="<a "+o+' class="maizhi_link" href="/p/'+e.meizhi_thread_id+'" target="_blank" title="\u8D34\u5427\u59B9\u7EB8\u8BA4\u8BC1"><span class="icon_meizhi meizhi_level_'+u+'"></span></a>');break;case"is_member":c+="<a "+o+' target="_blank"  class=" icon_fanclub" ></a>';break;default:if(e.title_url)c+="<a "+o+' target="_blank"  href="'+e.title_url+'"  title="'+e.title+'"  locate="'+e.name+"_"+e.value+'"> </a>';else{{e.title}c+="<span "+o+' title="'+e.title+'"  locate="'+e.name+"_"+e.value+'"></span>'}}return c}}});
;_.Module.define({path:"user/widget/Icons/IconsBookControl",requires:["IconsBookView","IconsBookTip","IconCard","IconsBookMessagebox","IconsBookGetIcon"],sub:{_icon_book:null,_icon_book_ajax:null,_icon_user_action:"",_icon_tab_loaded:{},_tip:null,_messagebox:null,tabLen:0,_slot_no:0,_icon_info:{},_current_tab_index:0,_selected_icon_name:"",_target_ele:null,_is_open_yycurrency:function(){return this.globalSwitch=this.requireInstance("common/widget/GlobalSwitch"),this.globalSwitch.getSwitch()&&this.globalSwitch.getConvert()},_option:{width:655},_slot_buy_price:[0,0,100,1e4,3e4,5e4,1e4,2e4,1e5],initial:function(){var o=this;o._wrap=$("body"),o._view=o.use("user/widget/Icons/IconsBookView");var e=PageData.category_info,t=e.category_list||[{category_id:"101",category_name:"\u8DB3\u7403"},{category_id:"102",category_name:"\u661F\u5EA7"},{category_id:"104",category_name:"\u5176\u4ED6"}];o.defaultCategoryId=o._getDefaultCategoryId(e.default_category),o.bindIconBookHookEvents(t)},buildReqParams:function(o){return this._is_open_yycurrency()&&"object"==typeof o&&(o.pay_type=50),o},bindIconBookHookEvents:function(o){var e=this;e._wrap.delegate(".j_icon_slot_buy","mouseenter",function(){e.__timeoutId&&clearTimeout(e.__timeoutId),e.closeAllCard(),e._icon_user_action="buy_slot",e._target_ele=$(this),e._selected_icon_name="";var o=$(".j_icon_slot").length;return e._slot_no=1,e.buySlot({add_slot_no:o+1,price:e._slot_buy_price[o+1],action:"buy_slot"},$(this)),!1}),e._wrap.delegate(".j_icon_slot_buy","mouseleave",function(){return e.__timeoutId&&clearTimeout(e.__timeoutId),e.__timeoutId=setTimeout(function(){e._messagebox&&e._messagebox.hideBox()},200),!1}),e._wrap.delegate(".j_icon_slot","click",function(t){e.closeAllCard(),e._setIconRefresh($(this)),e._icon_user_action="replace_icon",e._target_ele=$(this);var a=$(this).tbattr("data-slot"),_=$(this).tbattr("data-name");e._selected_icon_name=_,e._slot_no=a;var i="",n={};for(var c in n)n[c].name==_&&(i=n[c].category_id);e.initIconBook({slot_no:a,category_info:o,icon_id:_,action:"replace_icon",category_id:i},$(this)),t.preventDefault()}),e._wrap.delegate(".j_slot_null_icon","click",function(t){t.preventDefault(),e.closeAllCard(),e._selected_icon_name="",e._setIconRefresh($(this)),e._icon_user_action="buy_icon",e._target_ele=$(this);var a=$(this).tbattr("data-slot");e._slot_no=a;e.initIconBook({slot_no:a,category_info:o,icon_id:"",action:"buy_icon"},$(this))}),e._wrap.delegate(".j_icon_slot","hover",function(o){var e=$(this);if(!e.hasClass("j_slot_null_icon")){var t=$(this).tbattr("data-name"),a=($(this).tbattr("data-slot"),{});if(a){var _=null;for(var i in a)if(a[i].name==t){_=a[i];break}if(_&&_["level_"+_.value]){var n=_["level_"+_.value],c="url("+n.icon_1+") no-repeat",r=o||event;if("mouseenter"==r.type){var s={background:c},l=e.css("background");l||(l=e[0].style.background),e.data({bg:l}),e.css(s),e.addClass("icon_slot_hover"),e.children(".j_icon_slot_refresh").addClass("icon_slot_refresh_hover")}else{var l=e.data("bg"),s={background:l};e.css(s),e.removeClass("icon_slot_hover"),e.children(".j_icon_slot_refresh").removeClass("icon_slot_refresh_hover")}}}}})},buySlot:function(o,e){var t=this;t._messagebox||(t._messagebox=t.use("user/widget/Icons/IconsBookMessagebox")),t._messagebox.is_leave_close=!0,t._messagebox.showBox(o,e)},initIconBook:function(o,e){var t=this,a=o.category_info;t.closeIconBook();var _=t._view.getTabItem(a),i={content:_,card_css:{width:t._option.width,zIndex:$.getcurzIndex()},auto_positon:!0,event_target:e,attr:"id='icon_book_tab'",wrap:$("body")};if(t._icon_book=t.use("user/widget/Icons/IconCard",i),t._icon_book.showCard({type:"delayShow",time:200}),t.initTab(),o.icon_id){var n=t._getTabIdByCategory(o.category_id);t._selected_icon_name=o.icon_id,t._showTab(n,o.icon_id)}else t._showTab(t._getDefaultIndex(t.defaultCategoryId));$.stats.track("\u5370\u8BB0\u4E2D\u5FC3\u6D6E\u5C42","icon_system")},closeIconBook:function(){var o=this;o._tip&&o._tip.closeTip(),o._icon_book&&(o._icon_book.closeCard(),o._icon_book=null)},initTab:function(){var o=this;o.tabLen=$(".icon_book_tab_head li").length,o._bindHeadEvents()},_bindHeadEvents:function(){var o=this;$(".icon_book_tab_head").delegate("li","click",function(){var e=$(this).index();o._showTab(e),o._tip&&o._tip.hideTip()}),$(".icon_book_close").click(function(){return $("#icon_book_tab").remove(),o._tip&&(o._tip.hideTip(),o._tip=null),$(".icon_wrap .j_icon_slot_refresh").removeClass("icon_slot_refresh"),!1}),$(".icon_book_close").hover(function(){$(this).addClass("icon_book_close_hover")},function(){$(this).removeClass("icon_book_close_hover")})},_showTab:function(o,e){var t=this;$(".icon_book_tab_head .head_inner").each(function(){!$(this).hasClass("space")&&$(this).parent().index()<t.tabLen-1&&$(this).addClass("space")}),0>o?"0":$("#tab_head_"+(o-1)+" div.space").removeClass("space"),$(".icon_book_tab_head li.tab_active").removeClass("tab_active").addClass("tab_deactive"),$("#tab_head_"+o).removeClass("tab_deactive").addClass("tab_active"),$(".icon_book_tab_body div.tab_body_item_active").removeClass("tab_body_item_active"),$("#tab_content_"+o).addClass("tab_body_item_active"),e=e||t._selected_icon_name,t._loadTabContent(o,e),t._current_tab_index=e},_loadTabContent:function(o,e){var t=this,a='<div class="icon_book_error">\u6B63\u5728\u52AA\u529B\u52A0\u8F7D\uFF0C\u8BF7\u7A0D\u540E...</div>';$("#tab_content_"+o).html(a);var _={ie:"utf-8"},i=$("#tab_head_"+o).tbattr("data-categoryId");_.tbs=PageData.tbs,_.category_id=i,t.buildReqParams(_),t._icon_book_ajax&&t._icon_book_ajax.abort(),t._icon_book_ajax=$.ajax({type:"post",url:"/icon/submit/icon",data:_,dataType:"json"}).success(function(a){if(a&&0===a.no){var _=a.data,n=_.icon_info,c=t._view.getTabContent(n,e,i);$("#tab_content_"+o).html(c),t._bindTabContenEvent(o),t.initScroll(o),t._icon_tab_loaded[o]=!0,t._icon_info["category_"+o]=_.icon_info}else if(a&&100000001===a.no)$.dialog.alert(a.error);else{var c='<div class="icon_book_error">\u672A\u77E5\u9519\u8BEF<a href="javascript:void(0)" id="icon_book_reload" class="icon_book_reload">\u5237\u65B0</a></div>';$("#tab_content_"+o).html(c),$("#icon_book_reload").on("click",function(){return t._loadTabContent(o),!1})}})},_bindTabContenEvent:function(){var o=this;o._tip||(o._tip=o.use("user/widget/Icons/IconsBookTip",[o]));var e=$("#icon_book_wrap");e.on("mouseenter",".tab_body_item_active .icon_box_place",function(){$(this).children(".icon_border").addClass("icon_border_hover")}).on("mouseleave",".tab_body_item_active .icon_box_place",function(){$(this).children(".icon_border").removeClass("icon_border_hover")}),e.delegate(".icon_wrap .icon_box_place","mouseenter",function(){var e=o._target_ele.tbattr("data-name"),t=$(this).tbattr("data-id"),a=$(this).tbattr("data-level"),_=$(this).hasClass("icon_not_use"),i=$(".icon_book .tab_body_item_active")[0].id.replace("tab_content_",""),n=o._icon_info["category_"+i],c=null,r=null;if(n){n=n.normal||[];for(var s=0;s<n.length;s++)n[s].name==t&&(c=n[s]),e&&n[s].name==e&&(r=n[s])}var l={icon_id:t,in_use:!_,slot_no:o._slot_no,value:a,icon_info:c,old_icon_id:e,old_icon_info:r};o._tip.showTip(l,$(this))}),e.delegate(".icon_view","mouseleave",function(){setTimeout(function(){o._tip&&o._tip.hideTip&&o._tip.hideTip()},1500)}),e.delegate(".collect_icon_wrap .icon_box_place","mouseenter",function(){if(!($(this).children(".icon_locked").length>0)){var e=o._target_ele.tbattr("data-name"),t=$(this).tbattr("data-id"),a=$(this).tbattr("data-level"),_=$(this).hasClass("icon_not_use"),i=$(".icon_book .tab_body_item_active")[0].id.replace("tab_content_",""),n=o._icon_info["category_"+i],c=null,r=null;if(n){n=n.advanced||[];for(var s=0;s<n.length;s++)n[s].name==t&&(c=n[s]),e&&n[s].name==e&&(r=n[s])}var l={icon_id:t,in_use:!_,slot_no:o._slot_no,value:a,icon_info:c,old_icon_id:e,old_icon_info:r};o._tip.showTip(l,$(this))}}),e.delegate(".collect_icon_wrap .icon_box_place","mouseleave",function(){setTimeout(function(){o._tip.hideTip()},6e3)})},_getTabIdByCategory:function(o){for(var e=this,t=$(".icon_book_tab_head li"),a=0;a<t.length;a++)if($(t[a]).tbattr("data-categoryId")==o)return a;return e._getDefaultIndex(e.defaultCategoryId)},_getDefaultCategoryId:function(o){var e="";for(var t in o)e=t;return e},_getDefaultIndex:function(o){for(var e=$(".icon_book_tab_head li"),t=0;t<e.length;t++)if($(e[t]).tbattr("data-categoryId")==o)return t},initScroll:function(o){var e=this,t=$("#tab_content_"+o+" .icon_wrap");t&&t.length>0&&e.bindArrowScrollEvent("icon_wrap");var a=$("#tab_content_"+o+" .collect_icon_wrap");a&&a.length>0&&e.bindArrowScrollEvent("collect_icon_wrap")},bindArrowScrollEvent:function(o){var e=this;$("."+o).delegate(".icon_wrap_scroll_arrow","hover",function(){$(this).hasClass("arrow_disable")||$(this).toggleClass("arrow_hover")}),$("."+o).delegate(".right_arrow","click",function(){e._move("left",o),e._tip&&e._tip.hideTip()}),$("."+o).delegate(".left_arrow","click",function(){e._move("right",o),e._tip&&e._tip.hideTip()})},_move:function(o,e){var t=this,a=0,_=$($(".tab_body_item_active ."+e+" .icon_view")[0]).tbattr("total-col");switch(_=parseInt(_),o){case"left":a=t._moveLeft(_,e);break;case"right":a=t._moveRight(_,e)}a&&$(".tab_body_item_active .icon_wrap .icon_list").animate({left:a},300);var i=55*_;a&&(a=Math.abs(parseInt(a)),a+550>=i?($(".tab_body_item_active ."+e+" .icon_wrap_right_arrow").addClass("arrow_disable"),$(".tab_body_item_active ."+e+" .icon_wrap_left_arrow").removeClass("arrow_disable")):($(".tab_body_item_active ."+e+" .icon_wrap_right_arrow").removeClass("arrow_disable"),$(".tab_body_item_active ."+e+" .icon_wrap_left_arrow").removeClass("arrow_disable")),0==a&&($(".tab_body_item_active ."+e+" .icon_wrap_right_arrow").removeClass("arrow_disable"),$(".tab_body_item_active ."+e+" .icon_wrap_left_arrow").addClass("arrow_disable")))},_moveLeft:function(o,e){var t=0,a=o;if(!(10>=a)){var _=55*a,i=$(".tab_body_item_active ."+e+" .icon_list").css("left"),n=Math.abs(parseInt(i));n%55!=0&&(n=n%55*55);var c=_-n;if(c>550)return t=n+165,"-"+t+"px"}},_moveRight:function(o,e){var t=0,a=o;if(!(10>=a)){var _=$(".tab_body_item_active ."+e+" .icon_list").css("left"),i=parseInt(_);if(!(i>=0))return t=Math.abs(i)-165,0>t&&(t=0),"-"+t+"px"}},closeAllCard:function(){var o=this;o._tip&&o._tip.closeTip(),o._messagebox&&o._messagebox.hideBox(),o.closeIconBook(),o._removeIconRefresh()},_setIconRefresh:function(o){$(".icon_wrap .j_icon_slot_refresh").removeClass("icon_slot_refresh"),o.children(".j_icon_slot_refresh").addClass("icon_slot_refresh")},_removeIconRefresh:function(){$(".icon_wrap .j_icon_slot_refresh").removeClass("icon_slot_refresh")}}});
;_.Module.define({path:"user/widget/Icons/IconsBookGetIcon",requires:["IconsBookCommon"],sub:{_dialog:null,initial:function(){this.common=this.use("IconsBookCommon")},get:function(){return this._dialog},show:function(){this._dialog.show()},hide:function(){this._dialog.hide()},close:function(){this._dialog.close()},_init:function(o){var i={modal:!0,showTitle:!1,fixed:!0,width:290,height:180},n=this;i.html='<div class="icon_book_dialog_wrap">'+o+"</div>",this._dialog=new $.dialog(i),this._dialog.element.find(".icon_book_dialog_wrap .icon_book_msgbox_close").click(function(o){o.preventDefault(),n._dialog.close()}),this._dialog.element.find(".icon_book_dialog_wrap .icon_book_msgbox_close").hover(function(){$(this).addClass("icon_book_msgbox_close_hover")},function(){$(this).removeClass("icon_book_msgbox_close_hover")})},getOneIcon:function(o){var i=this;if(!o)return void i._handleError();var n={ie:"utf-8"};n.tbs=PageData.tbs,n.icon_name=o,i._ajax&&i._ajax.abort(),i._ajax=$.ajax({type:"post",url:"/icon/seticon",data:n,dataType:"json"}).success(function(o){if(o&&0===o.no){var n=o.data;if(!n.icon_info)return void i._handleError();i.showOneIcon(n.icon_info)}else o&&2380009===o.no?$.dialog.alert("\u540C\u540Dicon\u53EA\u80FD\u4F69\u6234\u4E00\u4E2A\uFF01"):i._handleError()})},_handleError:function(){var o=this,i=o._getErrorTpl();o._init(i),o.show(),this._dialog.element.find(".icon_book_dialog_wrap .ui_btn").click(function(){$.tb.location.reload()})},showOneIcon:function(o){var i=this,n=i._getOneIconTpl(o);i._init(n),i.show()},_getOneIconTpl:function(o){if(o){var i=this._getIconStyle(o),n={styleBg:i,iconTitle:o.title},s=['<div class="icon_book_msgbox">','<div class="icon_book_msgbox_wrap">','<div class="icon_book_msgbox_body">','<div class="icon_msgbox_title">\u606D\u559C\u4F60\u83B7\u5F97\u4E86#{iconTitle}</div>','<div class="icon_msgbox_get_icon">','<div class="msg_icon_get_one" style="left:110px;background: #{styleBg}"></div>','<div class="msg_icon_get_two"></div>','<div class="msg_icon_get_three"></div>',"</div>",'<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m">',"<span><em>\u5FEB\u53BB\u770B\u770B\u6211\u7684\u56FE\u9274</em></span>","</a>","</div>","</div>",'<div class="icon_book_msgbox_close"></div>',"</div>","</div>"].join("");return $.tb.format(s,n)}},showDurationIcon:function(o,i){var n=[];n.push(o),this.showIconList(n,i,"duration")},showIconList:function(o,i,n){var s=this,t={hide_btn:!1,close_callback:function(){},close_time:0};t=$.extend(t,i);var c=s._getIconListTpl(o,t.hide_btn,n);s._init(c),s.show(),t.close_time&&parseInt(t.close_time)>0&&setTimeout(function(){s._dialog.close()},parseInt(t.close_time)),t.close_callback&&"function"==typeof t.close_callback&&s._dialog.onclose(function(){t.close_callback()})},_getIconListTpl:function(o,i,n){var s=this,t=PageData.user.portrait;if(o||$.isArray(o)){for(var c=[],a=[],e="",_=i?"":['<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m">',"<span><em>\u5FEB\u53BB\u770B\u770B\u6211\u7684\u56FE\u9274</em></span>","</a>","</div>"].join(""),l=0;l<o.length;l++){var d=s._getIconFormatInfo(o[l],o.length);c.push(d.iconTitle),a.push(d.iconTpl)}if(c=c.join(","),a=a.join(""),n&&"duration"==n){var r=this.common.getIconExpired(o[0]);r>-1&&(e="<span>\u6709\u6548\u5929\u6570\uFF1A"+r+"</span><br>")}var g=['<div class="icon_book_msgbox">','<div class="icon_book_msgbox_wrap">','<div class="icon_book_msgbox_body">','<div class="icon_msgbox_title">\u606D\u559C\u4F60\u83B7\u5F97\u4E86'+c+"</div>",'<div class="icon_msgbox_get_icon clearfix">',a,"</div>",_,'<p class="icon_book_go_home">',e,'<a href="/home/main?id='+t+'&fr=icon" target="_blank">\u53BB\u6211\u7684\u4E2A\u4EBA\u4E2D\u5FC3\u67E5\u770B>></a>',"</p>","</div>",'<div class="icon_book_msgbox_close"></div>',"</div>","</div>"].join("");return g}},_getIconFormatInfo:function(o,i){var n=this._getIconStyle(o),s={iconTpl:'<div class="msg_icon_get msg_icon_get_'+parseInt(i)+'" style="left:110px;'+n+'"></div>',styleBg:n,iconTitle:o.title};return s},_getIconStyle:function(o){var i=0,n=0,s="//tb1.bdstatic.com/tb/cms/com/icon/icon_sprite.png",t=o.sprite[o.value].split(","),c=50,a=t[0],e=t[1];i=2*c,n=e*c;var _="background: url("+s+"?stamp="+a+") no-repeat -"+n+"px -"+i+"px;";return _},_getErrorTpl:function(){var o=['<div class="icon_book_msgbox">','<div class="icon_book_msgbox_wrap">','<div class="icon_book_msgbox_body">','<div class="icon_msgbox_title">\u672A\u77E5\u9519\u8BEF</div>','<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m" style="height: 27px; border-radius: 3px;">',"<span><em>\u5237\u65B0</em></span>","</a>","</div>","</div>",'<div class="icon_book_msgbox_close"></div>',"</div>","</div>"].join("");return o}}});
;_.Module.define({path:"user/widget/Icons/IconsBookTip",requires:["IconCard","IconsBookMessagebox","IconsBookCommon"],sub:{_icon_book_tip:null,_icon_data:null,_ajax:null,_control:null,_msgbox:null,_option:{width:"535px"},_is_show:!1,_is_open_yycurrency_open:function(){return this.globalSwitch=this.requireInstance("common/widget/GlobalSwitch"),this.globalSwitch.getSwitch()&&this.globalSwitch.getConvert()},_is_open_yycurrency:function(o){return this._is_open_yycurrency_open()?o.replace(/(\d*)T\u8C46/g,function(o,i){return(i/100||"")+"Y\u5E01"}):o},buildReqParams:function(o){return this._is_open_yycurrency_open()&&"object"==typeof o&&(o.pay_type=50),o},spriteImgSize:36,initial:function(o){var i=this;i.common=this.use("IconsBookCommon"),i._control=o[0]},getControl:function(){return this._control},showTip:function(o,i){if(o){var n=this,e=$("#icon_book_tip");0==e.length&&$(".icon_card_wrap").append(this._getWrapTpl()),e=$("#icon_book_tip"),n._setContent(o);var t=$(".j_icon_book_tip .j_tip_up_arrow"),s=i.position(),c=s.top,a=s.left-5,r=i.parents(".icon_view"),p=r.position(),l=parseInt(p.left)+15,u=c+106;i.parents(".collect_wrap").length>0&&(u+=146),e.css({display:"block",visibility:"visible",top:u+"px",left:l+"px","z-index":2e4});var d=parseInt(a)+25;t.css({left:d+"px"}),n._bindEvents(),$(".icon_book_tip .j_tip_icon_price").html(n._is_open_yycurrency("\u6D88\u8017"+o.icon_info.price+"T\u8C46")),n._icon_data=o,$("#j_icon_book_action_btn").one("click",function(){var i=!0,e=0,t=PageData.user.Parr_scores;t&&(e=t.scores_other+t.scores_money);var s=-1;if(s=n._icon_data.price?n._icon_data.price:n._icon_data.icon_info.price,s>0&&0>e-s&&(i=!1,$(".icon_book_tip .icon_action_wrap").html(n._getNoRemainTip()),$("#j_icon_book_recharge_btn").click(function(){_.Module.use("common/widget/TchargeDialog")})),o.in_use)1==parseInt(o.slot_no)?n._replaceIcon4FirstSlot(o):n._replaceIcon4OtherSlot(o);else if(i){var c=$("#j_icon_book_action_btn em");c.length>0&&c.html("\u8D2D\u4E70\u4E2D"),n._buyIconRequest(o)}})}},hideTip:function(){var o=this;o._is_show||o.closeTip()},closeTip:function(){tip=$("#icon_book_tip"),(tip||0!=tip.length)&&tip.remove()},_bindEvents:function(){var o=$("#icon_book_tip"),i=this;o.bind("mouseenter",function(){i._is_show=!0}).bind("mouseleave",function(){i._is_show=!1,i.hideTip()})},_replaceIcon4FirstSlot:function(o){var i=this;i._control.closeIconBook(),i._msgbox||(i._msgbox=i.use("user/widget/Icons/IconsBookMessagebox"));var n=$(".icon_wrap .icon_slot_refresh");i._msgbox.showReplaceFirstSlotBox(o,n,i._replaceIcon4OtherSlot,i)},_replaceIcon4OtherSlot:function(o){var i=this,n={ie:"utf-8"};n.tbs=PageData.tbs,n.icon_name=o.icon_id,n.slot_no=o.slot_no,i._ajax&&i._ajax.abort(),i._ajax=$.ajax({type:"post",url:"/icon/seticon",data:n,dataType:"json"}).success(function(o){if(o&&0===o.no){var n=o.data;i._refreshAfterReplace(n.icon_info)}else o&&2270028===o.no?(i._msgbox||(i._msgbox=i.use("user/widget/Icons/IconsBookMessagebox")),i._msgbox.hasNotEnoughTdou()):$.dialog.alert(o&&2380009===o.no?"\u540C\u540Dicon\u53EA\u80FD\u4F69\u6234\u4E00\u4E2A\uFF01":"\u672A\u77E5\u9519\u8BEF\uFF0C\u8BF7\u5237\u65B0\u91CD\u8BD5\uFF01")})},_refreshAfterReplace:function(){var o=this;setTimeout(function(){o.closeTip()},0),o._msgbox||(o._msgbox=o.use("user/widget/Icons/IconsBookMessagebox")),o._msgbox.replaceIconSuccess(o)},_buyIcon:function(o){var i=this;i._control.closeIconBook(),i._msgbox||(i._msgbox=i.use("user/widget/Icons/IconsBookMessagebox"));var n=$(".icon_wrap .icon_slot_refresh");i._msgbox.showBuyIconBox(o,n,i._buyIconRequest,i)},_buyIconRequest:function(o){var i=this,n={ie:"utf-8"};n.tbs=$.getPageData("tbs"),n.icon_name=o.icon_id,n.level=o.value,i.buildReqParams(n),i._ajax&&i._ajax.abort(),i._ajax=$.ajax({type:"post",url:"/icon/buyIcon",data:n,dataType:"json"}).success(function(o){o&&0===o.no?i.common.redirect(o.data,"\u5370\u8BB0\u4E2D\u5FC3TIP",function(o){var e=$.getPageData("user.Parr_scores",{});e.scores_total=$.getPageData("data.data.user_info.scores",0,o),console.log(o),$(".j_userinfo_scores_num").html(e.scores_total);var t=$(".icon_box_place[data-id="+n.icon_name+"]");t.removeClass("icon_not_use"),t.find(".j_icon_subscript").removeClass("icon_locked"),i.closeTip()}):o&&2270028===o.no?(i._msgbox||(i._msgbox=i.use("user/widget/Icons/IconsBookMessagebox")),i._msgbox.hasNotEnoughTdou()):$.dialog.alert(o&&100000001===o.no?o.error:"\u7CFB\u7EDF\u9519\u8BEF, \u8BF7\u7A0D\u5019\u518D\u8BD5")})},_refreshAfterBuy:function(o){this._refreshAfterReplace(o)},_setContent:function(o){var i=this._getTpl(o);$("#icon_book_tip").html(i)},_getWrapTpl:function(){var o=['<div id="icon_book_tip" class="icon_tip_card_wrap">',"</div>"].join("");return o},_getNoRemainTip:function(){var o=['<div class="icon_action" style="padding-top: 10px">','<div class="j_tip_icon_price tip_icon_price" style="height: 12px; margin-bottom:5px;display: block">T\u8C46\u4E0D\u8DB3</div>','<a href="javascript:void(0)" id="j_icon_book_recharge_btn" class="ui_btn ui_btn_m" style="height: 27px; border-radius: 3px;"><span><em>\u5145\u503C</em></span></a>',"</div>"].join("");return this._is_open_yycurrency(o)},_getTpl:function(o){var i=this,n=o.icon_info,e=n.sprite[n.value].split(","),t=50,s=e[0],_=e[1],c=0,a=_*t,r="https://tb3.bdstatic.com/public/icon/"+n.category_id+"_"+i.spriteImgSize+".png",p=" background:url("+r+"?stamp="+s+") no-repeat -"+a+"px -"+c+"px;",l="",u=i.common.getIconExpired(n);u>-1&&(l='<span style="margin-left: 20px;">\u5269\u4F59\u65F6\u95F4\uFF1A'+u+"\u5929</span>");var d=n.title,b=n.intro,g=n.intro_url,m={background_img:p,desc_title:d+l||"\u5370\u8BB0",desc_detail:b||"",desc_link:g||"//tieba.baidu.com/",btn_value:o.in_use?"\u66FF\u6362":"\u8D2D\u4E70",price_info_display:1==o.in_use?"none":"block",padding_top:o.in_use?"20":"10",in_use_display:"none",in_use_text:"",button_display:0==o.in_use&&0==n.price?"none":"block"};i._judgeCommIconInSlot(o.icon_id)&&(m.button_display="none"),"none"==m.button_display&&(m.in_use_display="display",m.in_use_text="\u4F7F\u7528\u4E2D",m.price_info_display="none"),0==o.in_use&&0==n.price&&(m.in_use_text="\u6D3B\u52A8\u83B7\u53D6");var h=['<div class="icon_book_tip j_icon_book_tip">','<div class="tip_up_arrow j_tip_up_arrow"></div>','<div class="tip_body">','<div class="tip_icon">','<div class="tip_icon_img" style="#{background_img}}"></div>',"</div>",'<div class="icon_desc">','<div class="icon_desc_title"><span>#{desc_title}</span></div>','<div class="icon_desc_detail"><span>#{desc_detail}</span><a href="#{desc_link}"  target="_blank"><span style="padding-left:5px;">\u8BE6\u60C5 >></span></a></div>',"</div>",'<div class="icon_action_wrap">','<div class="icon_action" style="padding-top:#{padding_top}px">','<div class="j_tip_icon_price tip_icon_price" style="height: 12px; margin-bottom:5px;display: #{price_info_display}"></div>','<div class="j_tip_icon_use tip_icon_use" style=" margin-bottom:5px;display: #{in_use_display}">#{in_use_text}</div>','<a href="javascript:void(0)" id="j_icon_book_action_btn" class="ui_btn ui_btn_m icon_book_action_btn" style="height: 27px; border-radius: 3px;display: #{button_display}"><span><em>#{btn_value}</em></span></a>',"</div>","</div>","</div>","</div>"].join("");return $.tb.format(h,m)},_judgeCommIconInSlot:function(o){var i={};for(var n in i){var e=this.common.isShowDurationIcon(i[n]);if(i[n].name==o&&e)return!0}return!1}}});
;_.Module.define({path:"user/widget/Icons/IconsBookView",requires:["IconsBookTip","IconsBookCommon"],sub:{tabIconsContentCongfig:{},_collect_icon_title:{101:"\u96C6\u9F5032\u4E2A\u56FD\u65D7\u5370\u8BB0\u5956\u52B1\u3010\u8D34\u5427\u4E16\u754C\u676F\u3011\u5370\u8BB0",102:"\u96C6\u9F5012\u4E2A\u661F\u5EA7\u5370\u8BB0\u53EF\u4EE5\u83B7\u5F9712\u4E2A\u9EC4\u91D1\u7248\u661F\u5EA7\u5370\u8BB0",103:"",104:""},spriteImgSize:36,initial:function(){},_getTabPanelTpl:function(){var o=['<div id="icon_book_wrap" class="_j_icon_book_wrap">','<div  class="icon_book">','<div class="icon_book_tab">','<ul  class="icon_book_tab_head">',"#{tabHead}","</ul>",'<div id="tab_body"  class="icon_book_tab_body">',"#{tabContent}","</div>","</div>","</div>",'<div class="icon_book_close"></div>',"</div>"].join("");return o},getTabItem:function(o){var i=this,t=['<li id="tab_head_#{index}" data-categoryId="#{category_id}" class="tab_deactive">','<div class="head_inner #{separator_cls}">','<button type="button" class="tab_button" hidefocus="true"  > ','<a href="javascript:void(0)">#{title}</a></button></div></li>'].join(""),n=['<div id="tab_content_#{index}" class=" tab_body_item ">',"</div>"].join(""),a="",l="",c=0;for(var e in o)c++;var r=0;for(var e in o){var s={index:r,category_id:e,title:o[e].name,separator_cls:r==c-1?"":"space"};r++,a+=$.tb.format(t,s),l+=$.tb.format(n,s)}var _={tabHead:a,tabContent:l},d=i._getTabPanelTpl();return $.tb.format(d,_)},getTabContent:function(o,i,t){var n="",a="",l=this,c=0,e=0;if(o=o||{},o.normal&&!o.advanced){var r=o.normal||[],s=r.length;return c=5,e=1>=s/50?10:s%c==0?Math.floor(s/c):Math.floor(s/c)+1,n+=l._getPositionIconListHtml(r,e,i,t),a=l._getCommIconWrap(null,c,e,n),l.tabIconsContentCongfig.comm={row:c,col:10,total_col:e},a}if(o.advanced&&o.advanced){var r=o.normal||[],_=o.advanced||[],s=r.length,d=_.length,v="";return c=2,e=1>=s/20?10:s%c==0?Math.floor(s/c):Math.floor(s/c)+1,n+=l._getPositionIconListHtml(r,e,i,t),a=l._getCommIconWrap(null,c,e,n),l.tabIconsContentCongfig.comm={row:c,col:10,total_col:e},a+=l._getDownArrowHtml(),e=1>=d/20?10:s%2==0?Math.floor(d/2):Math.floor(d/2)+1,v+=l._getPositionIconListHtml(_,e,null,t),a+=l._getAdvancedIconWrap(null,c,e,v,t),l.tabIconsContentCongfig.adv={row:c,col:10,total_col:e},a}return a},_getCommIconWrap:function(o,i,t,n){var a={arrow_top:5==i?100:45,arrow_visiblity:t>10?"visible":"hidden",height_cls:5==i?"icon_wrap_5":"",icon_list:n,total_col:t},l=['<div class="icon_wrap #{height_cls}">','<div class="icon_wrap_scroll_arrow icon_wrap_left_arrow arrow_disable" style="visibility: #{arrow_visiblity}">','<div class="left_arrow arrow_block" style=" top:#{arrow_top}px;"></div></div>','<div class="icon_view"  total-col="#{total_col}">','<div class="icon_list_wrap" >','<ul class="icon_list" style="left: 0px;" >',"#{icon_list}","</ul>","</div>","</div>",'<div class="icon_wrap_scroll_arrow icon_wrap_right_arrow " style="visibility: #{arrow_visiblity}">','<div class=" right_arrow arrow_block "  style=" top:#{arrow_top}px;"></div></div>',"</div>"].join("");return $.tb.format(l,a)},_getAdvancedIconWrap:function(o,i,t,n,a){var l=this,c={title:l._collect_icon_title[a],arrow_visiblity:t>10?"visible":"hidden",icon_list:n,total_col:t},e=['<div class="collect_icon_wrap">','<div class="collect_icon_title"><span>#{title}</span></div>','<div class="collect_wrap">','<div class="icon_wrap_scroll_arrow icon_wrap_left_arrow arrow_disable" style="visibility: #{arrow_visiblity}">','<div class="  left_arrow arrow_block" style="top:45px;"></div></div>','<div class="icon_view" total-col="#{total_col}">','<div class="icon_list_wrap" >','<ul class="icon_list" style="left: 0px;" >',"#{icon_list}","</ul>","</div>","</div>",'<div class="icon_wrap_scroll_arrow icon_wrap_right_arrow  " style="visibility: #{arrow_visiblity}">','<div class=" right_arrow arrow_block "  style=" top:45px;"></div></div>',"</div>","</div>"].join("");return $.tb.format(e,c)},_getDownArrowHtml:function(){return'<div class="wrap_donw_arrow"></div>'},_getPositionIconListHtml:function(o,i,t,n){for(var a="",l=this,c=!1,e=o.length,r=0,s=0,_=0;e>_;_++){r=Math.floor(_/i),s=_%i;var d=55*r,v=55*s;c=t&&t==o[_].name?!0:!1;var b="";b=0==o[_].is_advanced?l._getCommonIconTpl(o[_],d,v,n,c):l._getAdvIconTpl(o[_],d,v,n),a+=b}return a},_getCommonIconTpl:function(o,i,t,n,a){var l=this,c=o.sprite[o.value].split(","),e="https://tb3.bdstatic.com/public/icon/"+n+"_"+l.spriteImgSize+".png",r=50,s=c[0],_=c[1],d=0,v=_*r,b="background: url("+e+"?stamp="+s+") no-repeat -"+v+"px -"+d+"px;",p={icon_top:i,icon_left:t,name:o.name,in_use:o.in_use,in_use_cls:1==o.in_use?"":" icon_not_use",selected_cls:a?" icon_selected":"",level:o.value,background:b,locked_cls:0==o.in_use?" icon_locked":""};l._judgeCommIconInSlot(o)&&(p.selected_cls="icon_selected");var u=["<li>",'<div id="icon_book_id_#{name}" data-id="#{name}" data-level="#{level}" class="icon_box_place #{in_use_cls}" style="top: #{icon_top}px; left: #{icon_left}px;">','<div class="icon_box icon_border "></div>','<div class="icon_box icon_icon" style="#{background}"></div>','<div class="j_icon_subscript icon_subscript #{selected_cls} #{locked_cls}" ></div>',"</div>","</li>"].join("");return $.tb.format(u,p)},_judgeCommIconInSlot:function(o){var i=this,t=o.name,n={};for(var a in n){if("1"==a&&$.isEmptyObject(n[a])){var l=this._getOldIconinfoInSlot();if(t==l)return!0}if(n[a].name==t){i.common=this.use("IconsBookCommon");var c=i.common.isShowDurationIcon(o);return c?!0:!1}}return!1},_getOldIconinfoInSlot:function(){var o=$(".j_icon_slot").first();if(o){var i=o.tbattr("data-slot");return i}return null},_getAdvIconTpl:function(o,i,t,n){var a=this,l=o.sprite[o.value].split(","),c=50,e=l[0],r=l[1],s=2*c,s=0,_=r*c,d="https://tb3.bdstatic.com/public/icon/"+n+"_"+a.spriteImgSize+".png",v="background: url("+d+"?stamp="+e+") no-repeat -"+_+"px -"+s+"px;",b=o.is_collected,p={icon_top:i,icon_left:t,name:o.name,in_use:o.in_use,clocked_cls:1==b?" ":" icon_locked",level:o.value,background:v},u=["<li>",'<div id="icon_book_id_#{name}" data-id="#{name}" data-level="#{level}" class="icon_box_place " style="top: #{icon_top}px; left: #{icon_left}px;">','<div class="icon_box icon_border "></div>','<div class="icon_box icon_icon" style="#{background}"></div>','<div class="icon_subscript #{clocked_cls}" ></div>',"</div>","</li>"].join("");return $.tb.format(u,p)},_judgeAdvIconLocked:function(o,i){var t=!1;switch(i=parseInt(i)){case 101:break;case 102:if(o){for(var n=0;n<o.length;n++)if(!o[n].in_use){t=!0;break}t=12==n&&0==t?!1:!0}else t=!0;break;case 103:break;case 104:}return t}}});
;_.Module.define({path:"user/widget/Icons/IconsBookMessagebox",requires:["IconCard","IconsBookCommon"],sub:{_icon_book_message_box:null,_icon_data:null,_is_show:!1,_is_open_yycurrency_open:function(){return this.globalSwitch=this.requireInstance("common/widget/GlobalSwitch"),this.globalSwitch.getSwitch()&&this.globalSwitch.getConvert()},_is_open_yycurrency:function(o){return this._is_open_yycurrency_open()?o.replace(/(\d*)T\u8C46/g,function(o,i){return(i/1e3||"")+"Y\u5E01"}):o},buildReqParams:function(o){return this._is_open_yycurrency_open()&&"object"==typeof o&&(o.pay_type=50),o},_option:{width:290},is_leave_close:!1,spriteImgSize:36,setLeaveClose:function(o){this.is_leave_close=o},initial:function(){this.common=this.use("IconsBookCommon")},showBox:function(o,i){var n=this;n._showBox(i),n.generatorBuySlot(o),n._bindEvents()},hideBox:function(){var o=this;o._is_show||o._icon_book_message_box&&(o._icon_book_message_box.closeCard(),o._icon_book_message_box=null)},_bindEvents:function(){var o=this,i=$(".icon_card_wrap");i.bind("mouseenter",function(){o.is_leave_close&&(o._is_show=!0)}),i.bind("mouseleave",function(){o.is_leave_close&&(o._is_show=!1,o.hideBox())})},generatorBuySlot:function(o){var i=this,n=i._getBuySlotTpl(o);$(".icon_book_msgbox_body").html(n),$(".icon_book_msgbox .ui_btn").one("click",function(){i.buySlot(o)})},showReplaceFirstSlotBox:function(o,i,n,s){var _=this;setTimeout(function(){s.closeTip()},0),_._showBox(i);var c=_._getReplaceFirstSlotTipTpl(o);$(".icon_book_msgbox_body").html(c),$(".icon_book_msgbox .ui_btn").click(function(){n.call(s,o)})},showBuyIconBox:function(o,i,n,s){var c=this;setTimeout(function(){s.closeTip()},0),c._showBox(i);var e=c._getBuyIconTpl(o);$(".icon_book_msgbox_body").html(e),$(".icon_book_msgbox .ui_btn").click(function(){var i=0,e=PageData.user.Parr_scores;if(e&&(i=e.scores_other+e.scores_money),i-o.icon_info.price<0){var t=c._hasNotEnoughTdou();return $(".icon_book_msgbox_body").html(t),void $(".j_tdou_not_enough").on("click",function(){_.Module.use("common/widget/TchargeDialog")})}n.call(s,o.icon_info,function(){var o=c._buyIconSuccess();$(".icon_book_msgbox_body").html(o)})})},buySlot:function(o){var i=this,n=0,s=$.getPageData("user.Parr_scores",{});s&&(n=s.scores_other+s.scores_money+s.scores_fetch);var c=o.price||o.icon_info.price;if(i._is_open_yycurrency_open()&&(c/=10),c>0&&0>n-c){var e=i._hasNotEnoughTdou();return $(".icon_book_msgbox_body").html(e),void $(".j_tdou_not_enough").on("click",function(){_.Module.use("common/widget/TchargeDialog")})}var t={ie:"utf-8",slot_no:o.add_slot_no||1};t.tbs=PageData.tbs,i.buildReqParams(t),i._ajax&&i._ajax.abort(),i._ajax=$.ajax({type:"post",url:"/icon/addslot",data:t,dataType:"json"}).success(function(o){if(o&&0===o.no)i.common.redirect(o.data,"\u5370\u8BB0\u4E2D\u5FC3\u5361\u7247",function(){var o=i._addSuccess();$(".icon_book_msgbox_body").html(o),setTimeout(function(){$.tb.location.reload()},2e3)});else if(o&&2270028===o.no)i.hasNotEnoughTdou();else if(o&&100000001===o.no)$.dialog.alert(o.error);else{var n='<div class="icon_book_error">\u672A\u77E5\u9519\u8BEF<a href="javascript:void(0)" id="icon_book_reload" class="icon_book_reload">\u5237\u65B0</a></div>';$(".icon_book_msgbox_body").html(n),$("#icon_book_reload").on("click",function(){return $.tb.location.reload(),!1})}})},_updateTdouAccount:function(o,i,n){var s=PageData.user.Parr_scores;s&&(s.scores_other=o,s.scores_money=i,s.scores_fetch=n,$(".j_userinfo_scores_num").html(o+i))},_showBox:function(o){var i=this;i.hideBox();var n=i._getTpl(),s={content:n,card_css:{width:i._option.width,zIndex:$.getcurzIndex()},auto_positon:!0,event_target:o,attr:"id='icon_book_message_box'",wrap:$("body")};i._icon_book_message_box=i.use("user/widget/Icons/IconCard",s),i._icon_book_message_box.showCard({type:"delayShow",time:200}),i._bindCloseEvent()},_bindCloseEvent:function(){var o=this;$(".icon_book_msgbox .icon_book_msgbox_close").click(function(){o._icon_book_message_box?(o._icon_book_message_box.closeCard(),o._icon_book_message_box=null):$("#icon_book_message_box").length>0&&$("#icon_book_message_box").remove(),$(".icon_wrap .j_icon_slot_refresh").removeClass("icon_slot_refresh")}),$(".icon_book_msgbox .icon_book_msgbox_close").hover(function(){$(this).addClass("icon_book_msgbox_close_hover")},function(){$(this).removeClass("icon_book_msgbox_close_hover")})},_getTpl:function(){var o=['<div class="icon_book_msgbox">','<div class="icon_book_msgbox_wrap">','<div class="icon_book_msgbox_body">',"</div>",'<div class="icon_book_msgbox_close"></div>',"</div>",'<div class="icon_book_down_arrow"></div>',"</div>"].join("");return o},_refreshSlotList:function(){var o=$(".j_icon_slot").length,i=28*o,n='<a href="javascript:void(0)" data-slot="'+(o+1)+'" data-name="" title="\u70B9\u51FB\u6DFB\u52A0\u5370\u8BB0" class="j_slot_null_icon j_icon_slot icon_slot_null_icon" style="top:0px;left:'+i+'px"><div class=" j_icon_slot_refresh"></div></a>';$(".icon_slot_wrap .icon_add_solt").css({left:28*(o+1)}),$(".icon_slot_wrap .icon_add_solt").before(n),8==$(".j_icon_slot").length&&$(".icon_add_solt").remove()},_addSuccess:function(){var o=['<div class="icon_msgbox_title"></div>','<div class="icon_msgbox_detail">\u606D\u559C\u60A8\u83B7\u5F97\u4E86\u4E00\u679A\u5370\u8BB0\u63D2\u69FD</div>'].join("");return o},_buyIconSuccess:function(){var o=['<div class="icon_msgbox_title">\u606D\u559C\u60A8\u83B7\u5F97\u4E86\u4E00\u679A\u65B0\u5370\u8BB0</div>','<div class="icon_msgbox_detail"></div>','<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m j_tdou_not_enough" style="height: 27px; border-radius: 3px;"><span><em>\u5FEB\u53BB\u56FE\u9274\u770B\u770B\u5427</em></span></a>',"</div>"].join("");return o},_replaceIconSuccess:function(){var o=['<div class="icon_msgbox_title">\u5370\u8BB0\u66FF\u6362\u6210\u529F</div>','<div class="icon_msgbox_detail"></div>','<div class="icon_msgbox_action">','<a  href="javascript:void(0)" class="ui_btn ui_btn_m j_replace_ok" style="height: 27px; border-radius: 3px;"><span><em>\u786E\u5B9A</em></span></a>',"</div>"].join("");return o},_hasNotEnoughTdou:function(){var o=['<div class="icon_msgbox_title">T\u8C46\u4E0D\u8DB3</div>','<div class="icon_msgbox_detail"></div>','<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m j_tdou_not_enough" style="height: 27px; border-radius: 3px;"><span><em>\u7ACB\u5373\u5145\u503C</em></span></a>',"</div>"].join("");return this._is_open_yycurrency(o)},_getBuySlotTpl:function(o){var i={price:o.price},n=['<div class="icon_msgbox_title">\u9700\u8981\u6D88\u8017#{price}T\u8C46\u5F00\u542F\u5370\u8BB0\u63D2\u69FD</div>','<div class="icon_msgbox_detail" style="padding-top:15px;">(\u5F00\u542F\u540E\u514D\u8D39\u66F4\u6362\u5370\u8BB0)</div>','<div class="icon_msgbox_action" style="padding-top: 25px;">','<a href="javascript:void(0)" class="ui_btn ui_btn_m" style="height: 27px; border-radius: 3px;"><span><em>\u5F00\u542F</em></span></a>',"</div>"].join("");return this._is_open_yycurrency($.tb.format(n,i))},_getReplaceFirstSlotTipTpl:function(o){var i=this,n=o.old_icon_info,s=o.icon_info,_=this.common.isShowDurationIcon(n),c=_?i._getIconBackground(n):"",e=i._getIconBackground(s),t={old_background:c,background:e},a=['<div class="icon_msgbox_title">\u70B9\u51FB\u66FF\u6362\u5F53\u524D\u5370\u8BB0</div>','<div class="icon_msgbox_icon_replace_detail">','<div class="msg_icon_replace_current" style="#{old_background}"></div>','<div class="msg_icon_replace_arrow"></div>','<div class="msg_icon_replace_new" style="#{background}"></div>',"</div>",'<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m" style="height: 27px; border-radius: 3px"><span><em>\u66FF\u6362</em></span></a>',"</div>"].join("");return $.tb.format(a,t)},_getIconBackground:function(o){var i=0,n=0,s="//tb1.bdstatic.com/tb/cms/com/icon/"+o.category_id+"_"+this.spriteImgSize+".png";if(o){var _=o.sprite[o.value].split(","),c=50,e=_[0],t=_[1];i=0,n=t*c;var a="background: url("+s+"?stamp="+e+") no-repeat -"+n+"px -"+i+"px;";return a}return""},_getBuyIconTpl:function(o){var i=this,n=i._getIconBackground(o.icon_info),s={price:o.icon_info.price,background:n},_=['<div class="icon_msgbox_title">\u9700\u8981\u6D88\u801710000T\u8C46\u8D2D\u4E70\u8BE5\u5370\u8BB0</div>','<div class="icon_msgbox_icon_buy">','<div class="msg_icon_buy_icon" style="#{background}}"></div>',"</div>",'<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m">',"<span><em>\u8D2D\u4E70</em></span>","</a>","</div>"].join("");return this._is_open_yycurrency($.tb.format(_,s))},hasNotEnoughTdou:function(o){var i=this;o||(o=$(".icon_wrap .j_icon_slot_refresh")),i._showBox(o);var n=i._hasNotEnoughTdou();$(".icon_book_msgbox_body").html(n),$(".j_tdou_not_enough").on("click",function(){_.Module.use("common/widget/TchargeDialog")})},replaceIconSuccess:function(o){var i=this,n=$(".icon_wrap .icon_slot_refresh");n&&(n=n.parent()),i._showBox(n);var s=i._replaceIconSuccess();if($(".icon_book_msgbox_body").html(s),$(".icon_book_msgbox_body .j_replace_ok").on("click",function(){$.tb.location.reload()}),$(".icon_book_msgbox .icon_book_msgbox_close").click(function(){$.tb.location.reload()}),o){var _=o.getControl();_&&_.closeIconBook()}}}});
;_.Module.define({path:"user/widget/Icons/IconsBookCommon",requires:["common/widget/Tdou/TdouViewPay"],sub:{initial:function(){},isDurationIcon:function(e){return e&&4==e.type?!0:!1},getIconExpired:function(e){var n=-1;if(!e)return n;var r=e.type,t=e.end_time,o=Env.server_time/1e3;return 4==r&&t>=o&&(n=((t-o)/86400).toFixed(1)),n},redirect:function(e,n,r){e=e||{},e.from=n,e.chargeType="platform";var t=this;t.payment=t.requireInstance("common/widget/Tdou/TdouViewPay",function(e){"encourage_paid"===e.command&&"success"===$.getPageData("data.error","error",e)&&r(e)}),t.payment.createMain(e)},isShowDurationIcon:function(e){if(!e)return!1;var n=e.type,r=e.end_time,t=Env.server_time/1e3;return 4!=n?!0:r>=t?!0:!1}}});
;_.Module.define({path:"user/widget/Icons/IconCard",sub:{_option:{},_j_card:null,_open_timer:null,_close_timer:null,_is_show:!1,_is_first_show:!0,_default_option:{content:"",arrow_dir:"down",arrow_pos:{},card_css:{width:170,"z-index":1001},arrow_req:!0,auto_positon:!1,event_target:null,offset:{x:0,y:0},card_leave_display:!1,card_hover_show:!0,card_leave_hide:!1,attr:"",wrap:$("body")},initial:function(t){var i=this;i._option=$.extend(!0,{},i._default_option,t),this._buildCard()},_buildCard:function(){var t=this._option,i=this._genericTpl(),e=t.wrap;this._j_card=$(i),this._j_card.find(".j_content").html(t.content),e.append(this._j_card),delete t.card_css.height,this._j_card.css(t.card_css),t.card_css.height=this._j_card.find(".j_content").outerHeight(!0),this._arrow=this._j_card.find(".j_ui_white_arrow"),void 0===t.arrow_pos.left&&(this._arrow_left=t.card_css.width/2-10,this._arrow.css({left:this._arrow_left})),this._arrow.css(t.arrow_pos),t.arrow_req||this._j_card.find(".j_ui_white_arrow").hide(),t.auto_positon&&this._autoPosition()},_autoPosition:function(){var t=this._option,i={},e=$(window).height(),_=$(window).width(),o=($(document).scrollLeft(),$(document).scrollTop()),r=(t.event_target.innerWidth(),t.event_target.innerHeight()),s="",a={x:t.event_target.offset().left-t.card_css.width/2+t.event_target.outerWidth(!0)/2,y:t.event_target.offset().top-t.card_css.height-10,width:this._j_card.innerWidth(),height:this._j_card.innerHeight()+this._arrow.innerHeight()};i.left=a.x,i.top=a.y;var n=t.arrow_pos.left||this._arrow_left,d=15,h=_;_<$(document).width()&&(h=$(document).width());var c=h-(t.card_css.width+d);i.left<d?(n+=i.left-d,i.left=d):i.left>c&&(n+=i.left-c,i.left=c),i.top<o?(s="up",i.top+=r+(a.height||0),i.top-=t.offset.y):(i.top+=i.top+r>o+e?-r-(a.height||0):0,s="down",i.top+=t.offset.y),this._arrow.removeClass("icon_white_down").removeClass("icon_white_up").addClass("icon_white_"+s).css({left:n}),this._j_card.css(i)},_genericTpl:function(){var t=this._option.attr,i=this._option.arrow_dir,e=['<div class="icon_card_wrap" '+t+' style="visibility: hidden">','<div class="j_content icon_card_content ">',"</div>",'<span class="j_ui_white_arrow arrow icon_white_'+i+'"></span>',"</div>"].join("");return e},showCard:function(t){var i=this;i._close_timer&&clearTimeout(i._close_timer),t&&"delayShow"==t.type?(i._open_timer&&clearTimeout(i._open_timer),i._open_timer=setTimeout(function(){i._showCardDo()},t.time)):i._showCardDo()},closeCard:function(t){var i=this;i._open_timer&&clearTimeout(i._open_timer),t&&"delayClose"==t.type?i._close_timer=setTimeout(function(){i._closeCardDo()},t.time):i._closeCardDo()},hideCard:function(t){var i=this;i._open_timer&&clearTimeout(i._open_timer),t&&"delayHide"==t.type?i._close_timer=setTimeout(function(){i._hideCardDo()},t.time):i._hideCardDo()},_showCardDo:function(){var t=this;t._is_first_show,this._j_card.css({visibility:"visible"})},_closeCardDo:function(){var t=this;this._j_card&&!this._is_show&&t._j_card.remove()},_hideCardDo:function(){var t=this;this._j_card&&!this._is_show&&t._j_card.css({visibility:"hidden"})},setContent:function(t){var i=this._option;if(null!==this._j_card){var e=this._j_card.find(".j_content");e.html(t),i.card_css.height=e.outerHeight(!0),this._j_card.css({height:i.card_css.height}),i.auto_positon&&this._autoPosition()}}}});_.Module.define({path:"common/widget/wallet_dialog",requires:["common/component/JsPager","common/widget/LoginDialog","common/widget/UserHead","user/widget/Icons"],sub:{isMember:!1,dialog:null,$content:null,$historyListWrapper:null,$historyEmpty:null,timestamp:+new Date,api:{expend:"/tbmall/mall/getConsumeOrder",expendYY:"/tbmall/mall/getYyConsumeOrder",income:"/tbmall/mall/getIncomeOrder",charge:"/tbmall/mall/getPayOrder",chargeYY:"/tbmall/mall/getYyPayOrder"},listPage:{expend:0,expendYY:0,income:0,charge:0,chargeYY:0},objGet:function(i,e,s){s=void 0===s?null:s,e=e.split(".");var t,a=i;for(t in e){if(!("object"==typeof a&&e[t]in a))return s;a=a[e[t]]}return a},objSet:function(i,e,s){return i[e]=s,i},_is_open_yycurrency_open:function(){return this.globalSwitch=this.requireInstance("common/widget/GlobalSwitch"),this.globalSwitch.getSwitch()&&this.globalSwitch.getConvert()},_is_open_yycurrency:function(i){return this._is_open_yycurrency_open()?i.replace(/(\d*)T\u8C46/g,function(i,e){return(e/100||"")+"Y\u5E01"}):i},initial:function(){var i=this;i.icon=i.requireInstance("user/widget/Icons"),i.globalSwitch=i.requireInstance("common/widget/GlobalSwitch"),i.openSwitch=+i.globalSwitch.getSwitch(),i.openConvert=+i.globalSwitch.getConvert(),i.initUi(),i.initHistory(),i.initEvent(),i.initTrack(),i.initYyStyle()},initYyStyle:function(){this._is_open_yycurrency_open()&&$(".icon-tbean").addClass("yy-icon")},show:function(i){var e=this;e.options=i||{},e.dialog.show(),e.$content.trigger("show")},hide:function(){this.dialog.hide()},initUi:function(){var i,e=this;$.ajax({url:e.api.expend,type:"GET",data:{pn:1,c:5,t:e.timestamp},dataType:"json",async:!1,success:function(s){if(0===s.no){var t=e.objGet(s,"data.user",{}),a=e.requireInstance("common/widget/UserHead"),n=e.objGet(t,"Parr_props.level",{}),o=e.objGet(n,"end_time",0),r=e.objGet(n,"props_id",0);t.scoresTotal=e.objGet(t,"Parr_scores.scores_total",0),e.isMember=r&&o>+new Date/1e3,t.isMember=e.isMember?"ismember":"isnotmember",t.memberLevel="ismember"===t.isMember?r:2,t.userIcon=e.icon.getPreIconHtml(t.mParr_props,t,!0),t.memberExpire="",t.isMember&&(o=new Date(1e3*o),t.memberExpire=[o.getFullYear(),o.getMonth()+1,o.getDate()].join("/")),t.homeUrl="/home/main?ie=utf-8&id="+encodeURIComponent(e.objGet(t,"portrait")),t.avatarStyle=a.getHeadFrameStyle(t,80).stylestr,t.avatarFrame=t.avatarStyle?"with":"not-with",t.avatar=a.getHeadUrl(t),t.iconinfo="";var d=["/tbmall/tshow?tab=detail&c=0","\u5C0A\u8D35\u8EAB\u4EFD, \u5C0A\u8D35\u6807\u8BC6","/tbmall/tshow?tab=detail&c=112","\u4E2A\u6027\u94ED\u724C, \u72EC\u4E00\u65E0\u4E8C","/tbmall/tshow?tab=detail&c=110","\u70AB\u9177\u88C5\u626E, \u95EA\u4EAE\u5934\u50CF","/tbmall/tshow?tab=detail&c=103","\u8DA3\u5473\u53D1\u5E16, \u4E2A\u6027\u6C34\u5370","/tbmall/tshow?tab=detail&c=108","\u9B54\u6CD5\u9053\u5177, \u7B7E\u5230\u795E\u5668"];for(i=0;i<d.length/2;i++)t.iconinfo+=_.template('<a href="<%= url %>" title="<%= title %>" target="_blank">     <span class="wd-icon-new hidden image-radius">NEW</span>     <span class="wd-icon image-round" style="background-position: <%= bgPosition %>">&nbsp;</span> </a>')({url:d[2*i],title:d[2*i+1],bgPosition:"-"+36*i+"px 0"});t.setpass=t.setpass?"\u4FEE\u6539\u5BC6\u7801":"\u8BBE\u7F6E\u652F\u4ED8\u5BC6\u7801",t.umoneyLimit="\u6B63\u5728\u67E5\u8BE2...",console.log("user",t);var c=_.template('<div class="wallet-dialog-main clearfix">     <% if (openSwitch && openConvert == 0) { %>     <div class="yy-notice-main">         \u7531\u4E8ET\u8C46\u4E1A\u52A1\u5347\u7EA7\uFF0CT\u8C46\u94B1\u5305\u5C06\u5347\u7EA7\u4E3AY\u5E01\u94B1\u5305\uFF0C\u8BE6\u60C5\u8BF7\u89C1         <span class="yy-notice-main-link">T\u8C46\u5347\u7EA7Y\u5E01\u516C\u544A</span>         <div class="yy-notice-main-btn">\u786E\u8BA4\u5151\u6362</div>     </div>     <% } %>     <div class="wd-userinfo-wrapper">         <div class="wd-userinfo <%= user.isMember %>">             <div class="wd-member">                 <div class="wd-avatar-wrapper wd-avatar-<%= user.avatarFrame %>-frame">                     <a class="wd-avatar" href="<%= user.homeUrl %>" style="<%= user.avatarStyle %>">                         <img src="<%= user.avatar %>" alt="avatar"/>                     </a>                 </div>                 <div class="wd-iconinfo-wrapper">                     <div class="wd-username-wrapper">                         <%= user.userIcon %>                         <span class="wd-username text-overflow"><%= user.show_nickname %></span>                         <span class="wd-welcome wd-<%= user.isMember %>">\u5C0A\u8D35\u4F1A\u5458, \u60A8\u597D!</span>                         <span class="wd-welcome wd-not-<%= user.isMember %>">\u8D34\u5427\u7528\u6237, \u60A8\u597D!</span>                     </div>                     <div class="wd-icon-wrapper"><%= user.iconinfo %></div>                     <div class="wd-memberinfo-wrapper">                         <div class="wd-member-icon image-radius">                             <i class="icon-vip<%= user.memberLevel %>-16"></i>                             <span class="wd-<%= user.isMember %>">\u7EED\u8D39\u8D85\u7EA7\u4F1A\u5458</span>                             <span class="wd-not-<%= user.isMember %>">\u5F00\u901A\u4F1A\u5458</span>                         </div>                         <div class="wd-member-intro">                             <span class="wd-<%= user.isMember %>">\u5230\u671F: <%= user.memberExpire %></span>                             <span class="wd-not-<%= user.isMember %>">\u5F00\u901A\u4F1A\u5458\u5373\u4EAB\u53D7\u4EE5\u4E0A\u7279\u6743</span>                         </div>                     </div>                 </div>             </div>             <div class="wd-tbean">                 <% if (openSwitch && openConvert) { %>                 <h2>\u6211\u7684Y\u5E01:</h2>                 <% } else { %>                 <h2>\u6211\u7684T\u8C46:</h2>                 <% } %>                 <div class="wd-tbeaninfo-wrapper">                     <div class="wd-tbean-num"><i class="icon-tbean"></i>                         <% if (openSwitch && openConvert) { %>                         <%= user.scoresTotal / 100 %>                         <% } else { %>                         <%= user.scoresTotal %>                         <% } %>                     </div>                     <button class="wd-btn-tbeanget image-radius">                         <% if (openSwitch && openConvert) { %>                         \u83B7\u53D6Y\u5E01                         <% } else { %>                         \u83B7\u53D6T\u8C46                         <% } %>                     </button>                     <a href="/tbmall/pass/set" target="_blank"><%= user.setpass %></a>                 </div>             </div>         </div>     </div>     <div class="wd-history-wrapper">         <div class="wd-fast-forward hidden"></div>         <div class="wd-history">             <div class="wd-history-type-wrapper">                 <% if (openSwitch && openConvert) { %>                 <div class="expend active" data-type="expend">T\u8C46\u652F\u51FA\u8BB0\u5F55</div>                 <div class="expendYY" data-type="expendYY">Y\u5E01\u652F\u51FA\u8BB0\u5F55</div>                 <div class="income" data-type="income">\u6536\u5165\u8BB0\u5F55</div>                 <div class="charge" data-type="charge">T\u8C46\u5145\u503C\u8BB0\u5F55</div>                 <div class="chargeYY" data-type="chargeYY">Y\u5E01\u5145\u503C\u8BB0\u5F55</div>                 <% } else { %>                 <div class="expend active" data-type="expend">\u652F\u51FA\u8BB0\u5F55</div>                 <div class="income" data-type="income">\u6536\u5165\u8BB0\u5F55</div>                 <div class="charge" data-type="charge">\u5145\u503C\u8BB0\u5F55</div>                 <% } %>             </div>             <div class="wd-list-wrapper">                 <div class="wd-list-empty">                     <div class="wd-empty-content">                         <div>                             <h2 class="wd-empty-title">\u60A8\u8FD8\u6CA1\u6709<span class="wd-empty-type">\u652F\u51FA\u8BB0\u5F55</span>\u54E6</h2>                         </div>                     </div>                 </div>                 <div class="wd-list-category expend active hidden">                     <div class="wd-history-list"></div>                     <div class="wd-history-page-wrapper">                     </div>                 </div>                 <% if (openSwitch && openConvert) { %>                 <div class="wd-list-category expendYY hidden">                     <div class="wd-history-list"></div>                     <div class="wd-history-page-wrapper">                     </div>                 </div>                 <% } %>                 <div class="wd-list-category income hidden">                     <div class="wd-history-list"></div>                     <div class="wd-history-page-wrapper">                     </div>                 </div>                 <div class="wd-list-category charge hidden">                     <div class="wd-history-list"></div>                     <div class="wd-history-page-wrapper">                     </div>                 </div>                 <% if (openSwitch && openConvert) { %>                 <div class="wd-list-category chargeYY hidden">                     <div class="wd-history-list"></div>                     <div class="wd-history-page-wrapper">                     </div>                 </div>                 <% } %>                 <div class="wd-history-more">                     <a href="javascript:">\u67E5\u770B\u66F4\u591A\u8BB0\u5F55>></a>                 </div>             </div>         </div>     </div> </div>')({user:t,openSwitch:+e.openSwitch,openConvert:+e.openConvert});e.dialog=new $.dialog({title:e._is_open_yycurrency("\u6211\u7684T\u8C46\u94B1\u5305"),html:c,show:!1,width:699}),e.dialog.element.addClass("wallet-dialog"),e.$content=e.dialog.element.find(".dialogJcontent"),e.$historyEmpty=e.$content.find(".wd-list-empty"),e.initPager("expend",e.objGet(s,"data.total_count",0),!0),e.parseExpendList(e.objGet(s,"data.order_list",0))}else 11e4===s.no&&(e.dialog.hide(),e.requireInstance("common/widget/LoginDialog",[]))}})},initUmoney:function(){var i=this,e='<a target="_blank" href="/f?ie=utf-8&kw=%B0%D9%B6%C8%D3%D0%C7%AE%CF%FB%B7%D1%BD%F0%C8%DA">',s="";$.get("/tbapp/umoney/queryQualification",{},function(t){0===t.no?0!==t.data.status?$.get("/tbapp/umoney/queryUserInfo",{},function(t){0===t.no&&(t=t.data.data,s=1===t.status?e+"\u7533\u8BF7</a>\u6210\u4E3A\u767E\u5EA6\u6709\u94B1\u7528\u6237, \u5C0A\u4EAB\u65E0\u9650\u7279\u6743":2===t.status?"\u60A8\u7684\u7533\u8BF7\u6B63\u5728\u529E\u7406\u4E2D":3===t.status?e+"\u767E\u5EA6\u6709\u94B1\u53EF\u7528\u989D\u5EA6: "+t.credit+"\u5143</a>":"\u5E10\u6237\u5DF2\u5931\u6548, \u8BF7\u91CD\u65B0"+e+"\u7533\u8BF7</a>",i.$content.find(".wd-umoney-limit").html(s))},"json"):i.$content.find(".wd-umoney-limit").html(e+"\u7533\u8BF7</a>\u6210\u4E3A\u767E\u5EA6\u6709\u94B1\u7528\u6237, \u5C0A\u4EAB\u65E0\u9650\u7279\u6743"):11e4===t.no&&(i.dialog.hide(),i.requireInstance("common/widget/LoginDialog",[]))})},initHistory:function(){var i=this;$.get(i.api.expendYY,{pn:1,c:5,t:i.timestamp},function(e){0===e.no?(i.initPager("expendYY",i.objGet(e,"data.total_count",0)),i.parseExpendYYList(i.objGet(e,"data.order_list",0))):11e4===e.no&&(i.dialog.hide(),i.requireInstance("common/widget/LoginDialog",[]))},"json"),$.get(i.api.income,{pn:1,c:5,t:i.timestamp},function(e){0===e.no?(i.initPager("income",i.objGet(e,"data.total_count",0)),i.parseIncomeList(i.objGet(e,"data.order_list",[]))):11e4===e.no&&(i.dialog.hide(),i.requireInstance("common/widget/LoginDialog",[]))},"json"),$.get(i.api.charge,{pn:1,c:5,t:i.timestamp,showMemberRecord:1},function(e){0===e.no?(i.initPager("charge",i.objGet(e,"data.total_count",0)),i.parseChargeList(i.objGet(e,"data.order_list",[]))):11e4===e.no&&(i.dialog.hide(),i.requireInstance("common/widget/LoginDialog",[]))},"json"),$.get(i.api.chargeYY,{pn:1,c:5,t:i.timestamp,showMemberRecord:1},function(e){0===e.no?(i.initPager("chargeYY",i.objGet(e,"data.total_count",0)),i.parseChargeYYList(i.objGet(e,"data.order_list",[]))):11e4===e.no&&(i.dialog.hide(),i.requireInstance("common/widget/LoginDialog",[]))},"json")},parseDateTime:function(i){i=1e3*parseInt(i,10)||0;for(var e=new Date(i),s=[e.getFullYear(),e.getMonth()+1,e.getDate(),e.getHours(),e.getMinutes()],t=0;t<s.length;t++)s[t]<10&&(s[t]="0"+s[t]);return[s[0],s[1],s[2]+" "+s[3]+": "+s[4]].join("-")},parseExpendList:function(i){var e,s,t=this,a="";for(e in i)s=i[e],s.isProp="hidden",s.createTime=t.parseDateTime(t.objGet(s,"create_time")),a+=_.template('<div class="wd-history-item">     <div class="first-line">         <span>\u8BA2\u5355\u53F7: </span>         <span><%= history.order_id %></span>         <span class="pull-right"><%= history.createTime %></span>     </div>     <div class="second-line">         <div>             <div class="text-overflow">                 <span>\u5151\u6362\u5546\u54C1&nbsp;</span>                 <span class="<%= history.isProp %> col-33">\u9053\u5177 - </span>                 <span class="bold col-33"><%= history.title %></span>             </div>         </div>         <div>             <div class="col-33">                 <span>\u6D88\u8D39 </span>                 <span class="col-fb"><%= history.scores %></span>                 <span> T\u8C46</span>             </div>         </div>         <div>             <div class="col-33">\u5151\u6362\u6210\u529F</div>         </div>     </div> </div>')({history:s});t.$content.find(".wd-list-category.expend>.wd-history-list").html(a)},parseExpendYYList:function(i){var e,s,t=this,a="";for(e in i)s=i[e],s.isProp="hidden",s.createTime=t.parseDateTime(t.objGet(s,"create_time")),a+=_.template('<div class="wd-history-item">     <div class="first-line">         <span>\u8BA2\u5355\u53F7: </span>         <span><%= history.order_id %></span>         <span class="pull-right"><%= history.createTime %></span>     </div>     <div class="second-line">         <div>             <div class="text-overflow">                 <span>\u5151\u6362\u5546\u54C1&nbsp;</span>                 <span class="<%= history.isProp %> col-33">\u9053\u5177 - </span>                 <span class="bold col-33"><%= history.title %></span>             </div>         </div>         <div>             <div class="col-33">                 <span>\u6D88\u8D39 </span>                 <span class="col-fb"><%= history.scores / 100 %></span>                 <span> Y\u5E01</span>             </div>         </div>         <div>             <div class="col-33">\u5151\u6362\u6210\u529F</div>         </div>     </div> </div>')({history:s});t.$content.find(".wd-list-category.expendYY>.wd-history-list").html(a)},parseIncomeList:function(i){var e,s,t=this,a="";for(e in i)s=i[e],s.createTime=t.parseDateTime(t.objGet(s,"create_time")),s.status="\u83B7\u53D6\u6210\u529F",a+=_.template('<div class="wd-history-item">     <div class="first-line">         <span>\u8BA2\u5355\u53F7: </span>         <span><%= history.order_id %></span>         <span class="pull-right"><%= history.createTime %></span>     </div>     <div class="second-line">         <div>             <div class="col-33">                 <span>\u901A\u8FC7&nbsp;</span>                 <% if (history.pay_usernickname || history.pay_username) { %>                     <span style="display: flex;"><span class="bold text-overflow nickname-income"><%= history.pay_usernickname || history.pay_username %></span>&nbsp;<%= history.title %></span>                 <% } else { %>                     <span class="bold"><%= history.title %></span>                 <% } %>             </div>         </div>         <div>             <div class="col-33">                 <span>\u83B7\u53D6 </span>                 <span class="col-fb"><%= history.scores %></span>                 <span> T\u8C46</span>             </div>         </div>         <div>             <div class="col-33"><%= history.status %></div>         </div>     </div> </div>')({history:s});t.$content.find(".wd-list-category.income>.wd-history-list").html(a)},parseChargeList:function(i){var e,s,t=this,a="";for(e in i)s=i[e],s.createTime=t.parseDateTime(t.objGet(s,"finish_time")),a+=_.template('<div class="wd-history-item">     <div class="first-line">         <span>\u8BA2\u5355\u53F7: </span>         <span><%= history.order_id %></span>         <span class="pull-right"><%= history.createTime %></span>     </div>     <div class="second-line">         <% if (history.scene_id == 100002) { %>         <div>             <div class="text-overflow">                 <span class="col-33 bold"><%= history.order_name %></span>             </div>         </div>         <div>             <div class="col-33">                 <span>\u6D88\u8D39</span>                 <span class="col-fb"><%= history.money %></span>                 <span> \u5143</span>             </div>         </div>         <div>             <div class="col-33">                 <span>\u83B7\u53D6 </span>                 <span class="col-fb"><%= history.scores %></span>                 <span> T\u8C46</span>             </div>         </div>         <div>             <% if (history.benefit_usernickname || history.benefit_username) { %>                 <div class="col-33">\u8D60\u9001&nbsp;<span class="bold text-overflow nickname"><%= history.benefit_usernickname || history.benefit_username %></span>&nbsp;\u6210\u529F</div>             <% } else { %>                 <div class="col-33">\u83B7\u53D6\u6210\u529F</div>             <% } %>         </div>         <%         } else if (history.scene_id == 1050001 || history.scene_id == 1050002) {         %>         <div>             <div class="text-overflow">                 <span class="col-33 bold"><%= history.order_name %></span>             </div>         </div>         <div>             <div class="col-33">                 <span>\u6D88\u8D39</span>                 <span class="col-fb"><%= history.money %></span>                 <span> \u5143</span>             </div>         </div>         <div>             <div class="col-33">                 <span class="col-fb"><%= history.time %></span>                 <span> \u4E2A\u6708</span>             </div>         </div>         <div>             <% if (history.benefit_usernickname || history.benefit_username) { %>                 <div class="col-33">\u8D60\u9001&nbsp;<span class="bold text-overflow nickname"><%= history.benefit_usernickname || history.benefit_username %></span>&nbsp;\u6210\u529F</div>             <% } else { %>                 <div class="col-33">\u83B7\u53D6\u6210\u529F</div>             <% } %>         </div>         <% } %>     </div> </div> ')({history:s});t.$content.find(".wd-list-category.charge>.wd-history-list").html(a)},parseChargeYYList:function(i){var e,s,t=this,a="";for(e in i)s=i[e],s.createTime=t.parseDateTime(t.objGet(s,"finish_time")),a+=_.template('<div class="wd-history-item">     <div class="first-line">         <span>\u8BA2\u5355\u53F7: </span>         <span><%= history.order_id %></span>         <span class="pull-right"><%= history.createTime %></span>     </div>     <div class="second-line">         <% if (history.scene_id == 100002) { %>         <div>             <div class="text-overflow">                 <span class="col-33 bold"><%= history.order_name %></span>             </div>         </div>         <div>             <div class="col-33">                 <span>\u6D88\u8D39</span>                 <span class="col-fb"><%= history.money %></span>                 <span> \u5143</span>             </div>         </div>         <div>             <div class="col-33">                 <span>\u83B7\u53D6 </span>                 <span class="col-fb"><%= history.scores / 100 %></span>                 <span> Y\u5E01</span>             </div>         </div>         <div>             <% if (history.benefit_usernickname || history.benefit_username) { %>                 <div class="col-33">\u8D60\u9001&nbsp;<span class="bold text-overflow nickname"><%= history.benefit_usernickname || history.benefit_username %></span>&nbsp;\u6210\u529F</div>             <% } else { %>                 <div class="col-33">\u83B7\u53D6\u6210\u529F</div>             <% } %>         </div>         <%         } else if (history.scene_id == 1050001 || history.scene_id == 1050002) {         %>         <div>             <div class="text-overflow">                 <span class="col-33 bold"><%= history.order_name %></span>             </div>         </div>         <div>             <div class="col-33">                 <span>\u6D88\u8D39</span>                 <span class="col-fb"><%= history.money %></span>                 <span> \u5143</span>             </div>         </div>         <div>             <div class="col-33">                 <span class="col-fb"><%= history.time %></span>                 <span> \u4E2A\u6708</span>             </div>         </div>         <div>             <% if (history.benefit_usernickname || history.benefit_username) { %>                 <div class="col-33">\u8D60\u9001&nbsp;<span class="bold text-overflow nickname"><%= history.benefit_usernickname || history.benefit_username %></span>&nbsp;\u6210\u529F</div>             <% } else { %>                 <div class="col-33">\u83B7\u53D6\u6210\u529F</div>             <% } %>         </div>         <% } %>     </div> </div> ')({history:s});t.$content.find(".wd-list-category.chargeYY>.wd-history-list").html(a)},initPager:function(i,e,s){var t=this,a=Math.ceil(e/5),n=t.$content.find(".wd-list-category."+i),o=n.find(".wd-history-page-wrapper");if(t.listPage[i]=a,0===a)o.remove(),s&&t.$historyEmpty.show().siblings().hide();else{var r=t.use("common/component/JsPager",{container:o,current:1,amount:4,total:a,classname:{wrapper:"wd-page-wrapper"}});r.bind("pageChange",function(e,s){r.initial({current:s}),t.routeParseData(i,s)}),s&&t.$historyEmpty.hide().siblings("."+i+", .wd-history-more").show()}},routeParseData:function(i,e){var s=this,t={pn:e,c:5,t:s.timestamp};"charge"===i&&(t.showMemberRecord=1),$.get(s.api[i],t,function(e){0===e.no?s["parse"+i.substr(0,1).toUpperCase()+i.substr(1)+"List"](s.objGet(e,"data.order_list")):11e4===e.no&&(s.dialog.hide(),s.requireInstance("common/widget/LoginDialog",[]))})},initEvent:function(){var i=this,e=i.$content.find(".wd-list-wrapper"),s=i.$content.find(".wd-fast-forward"),t=i.$content.find(".wd-history-more"),a=100;i.longHistory=!1,this.$content.on("click",".wd-history-more",function(){s.slideDown(a),t.slideUp(a),e.animate({height:410},a),i.longHistory=!0}).on("click",".wd-fast-forward",function(){var n=i.$content.find(".wd-list-type-wrapper").data("type");s.slideUp(a),0!==i.listPage[n]&&t.slideDown(a),e.animate({height:278},a),i.longHistory=!1}).on("click",".wd-history-type-wrapper>div:not(.active)",function(){var e=$(this),s=e.data("type");e.addClass("active").siblings(".active").removeClass("active"),0===i.listPage[s]?(i.$historyEmpty.show().siblings().hide(),i.$historyEmpty.find(".wd-empty-type").html(e.html())):($(".wd-list-category."+s).show().siblings().hide(),i.longHistory===!1&&t.show())}).on("click",".wd-umoney-show",function(){$(this).hide().prev().hide().next().next().show()}).on("click",".wd-member-icon",function(){i.requireInstance("common/widget/JoinVipDialog").getMemberDialog(129,1004001e3)}).on("click",".wd-btn-tbeanget",function(){i.requireInstance("common/widget/tcharge_dialog",[i.objSet({},"consumption_path",130)]),i.hide()}).on("click",".wd-list-empty a",function(){i.requireInstance("common/widget/tcharge_dialog",[i.objSet({},"consumption_path",131)]),i.hide()}).on("click",".yy-notice-main-link",function(){window.open("https://sv.baidu.com/cashliveui/tbeanExchange.html#/rule","_blank")}).on("click",".yy-notice-main-btn",function(){i._confirm_ajax&&i._icon_tip_ajax.abort();var e={};e.tbs=PageData.tbs,i._confirm_ajax=$.ajax({type:"post",url:"/mo/q/confirmConvertYY",data:e,dataType:"json"}).then(function(e){e&&0===e.no?$.tb.location.reload():i.showDialog("\u670D\u52A1\u5668\u7E41\u5FD9\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5\uFF5E")},function(){i.showDialog("\u7F51\u7EDC\u9519\u8BEF, \u8BF7\u7A0D\u5019\u518D\u8BD5")})})},showDialog:function(i){this._dialog&&this._dialog.close(),this._dialog=null,this._dialog=new $.dialog({title:"T\u8C46\u5347\u7EA7Y\u5E01\u516C\u544A",html:i})},initTrack:function(){var i="t\u8C46\u94B1\u5305",e=this.isMember?"":"\u975E";this.$content.on("show",function(){$.stats.track("t\u8C46\u94B1\u5305\u5F39\u51FA",i)}).on("click",".wd-member-icon",function(){$.stats.track(e+"\u4F1A\u5458\u7528\u6237\u8D2D\u4E70",i)}).on("click",".wd-btn-tbeanget",function(){$.stats.track(e+"\u4F1A\u5458\u83B7\u53D6t_button",i)}).on("click",".wd-list-empty a",function(){$.stats.track(e+"\u4F1A\u5458\u4FC3\u9500\u70B9\u51FB",i)})}}});F.module("common/widget/eventCenter",function(){var e=$({}),t=function(){var e;return e=("0000"+parseInt(Math.random()*Math.pow(36,4),10).toString(36)).slice(-4),function(t,n){var a,o,r,l,u,i,s,c,f;return a=navigator.userAgent.indexOf("MSIE ")>-1||navigator.userAgent.indexOf("Trident/")>-1,o="onstorage"in document&&a,r=function(e){var n;n=new Date,n.setTime(n.getTime()+1e3),document.cookie="tabHub_emit_"+t+"="+e+"; expires="+n.toUTCString()+"; path=/"},u=0,l=o?function(n){var a,o,l,i;for(c.lastValue=n,i="data:"+e+":"+c.lastValue,r(i),localStorage.setItem(t,i),a=0,o=s.length;o>a;a++)l=s[a],l.call(null,n);return u+=1}:function(n){var a,o,r;for(c.lastValue=n,localStorage.setItem(t,"data:"+e+":"+c.lastValue),a=0,o=s.length;o>a;a++)r=s[a],r.call(null,n);return u+=1},s=[],i=$.noop,o?$(document).on("storage.noop",i):$(window).on("storage.noop",i),n?(o&&r("readable:"+e),localStorage.setItem(t,"readable:"+e),$(document).ready(function(){return setTimeout(function(){return f(),u>0?void 0:(n(l),o?$(document).off("storage.noop"):$(window).off("storage.noop"))},100)})):$(document).ready(function(){setTimeout(function(){f(),$(document).off("storage.noop"),$(window).off("storage.noop")})}),f=function(){var n,l,u,i;return n=function(n){var a,o,r,l,u,i,f,d,g;if(u=n.originalEvent.key,f=localStorage.getItem(t),u===t&&f===n.originalEvent.newValue)switch(a=f.split(":"),r=a[0],o=a[2],r){case"readable":if(null!=c.lastValue)return localStorage.setItem(t,"data:"+e+":"+c.lastValue);break;case"data":if(null!=o){for(g=[],l=0,i=s.length;i>l;l++)d=s[l],g.push(d.call(null,o));return c.lastValue=o,g}}},i=function(n){var a,o,r,l,u,i,f,d,g,m;if(i=n.originalEvent.key,d=n.originalEvent.newValue,i===t){if(a=d.split(":"),l=a[0],r=a[1],o=a[2],r===e)return;switch(l){case"readable":if(null!=c.lastValue)return setTimeout(function(){var n;return n=localStorage.getItem(t),null!=n&&"readable"===n.split(":")[0]?localStorage.setItem(t,"data:"+e+":"+c.lastValue):void 0},0);break;case"data":if(null!=o){for(m=[],u=0,f=s.length;f>u;u++)g=s[u],m.push(g.call(null,o));return c.lastValue=o,m}}}},u=function(){var n,a,o,l,u,i,f,d,g;if(f=document.cookie.replace(RegExp("(?:(?:^|.*;\\s*)tabHub_emit_"+t+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1")){if(n=f.split(":"),l=n[0],o=n[1],a=n[2],o===e)return;if(null==f)return;switch(l){case"readable":if(null!=c.lastValue)return setTimeout(function(){var n,a;return n=localStorage.getItem(t),null!=n&&"readable"===n.split(":")[0]?(a="data:"+e+":"+c.lastValue,r(a),localStorage.setItem(t,a)):void 0},0);break;case"data":if(null!=a){for(g=[],u=0,i=s.length;i>u;u++)d=s[u],g.push(d.call(null,a));return c.lastValue=a,g}}}},o?($(document).on("storage."+t,u),$(window).on("unload",function(){return $(document).off("storage")})):(l=a?i:n,$(window).on("storage."+t,l),$(window).on("unload",function(){return $(window).off("storage")}))},c={destory:function(){return $(window).off("storage."+t)},onValue:function(e){return s.push(e),function(){var t;return t=$.inArray(e,s),-1!==t?s.splice(t,1):void 0}},lastValue:null,emit:l,guid:e}}}();return e.TabHub=t,e});window._.Module.define({
    requires:["common/widget/LcsUtil","common/widget/LogUtil","common/widget/DbUtil","common/widget/LcsConfig","common/widget/Codec","common/widget/Socket"],path:"common/widget/Codec",sub:{initial:function(t){if(this.cache={},"undefined"==typeof window.dcodeIO||!window.dcodeIO.ProtoBuf)throw new Error("ProtoBuf.js is not present");this.initParams(t),this.util=this.requireInstance("common/widget/LcsUtil",[])},initParams:function(t){this.options=$.extend({url:"//tb1.bdstatic.com/tb/static-common/lcs/protos",sheet:{1007:"protobuf.UpdatePCClientInfo",209001:"protobuf.CommitPcMsg",209003:"protobuf.PullPcMsg",205001:"protobuf.CommitPersonalMsg",202006:"protobuf.PushNotify"}},t||{})},getBuilder:function(t,o){var e=this,r=e.cache;if("object"==typeof r[t]){if(o in r[t])return r[t][o]}else r[t]={};var i=e.options.sheet[t];if(!i)return console.error("\u672A\u6CE8\u518C\u6216\u9519\u8BEF\u7684\u547D\u4EE4\u53F7!"),null;var n=i.split(".")[0],u=i.split(".")[1],s=u.charAt(0).toLowerCase()+u.substring(1),a=dcodeIO.ProtoBuf.loadProtoFile({root:this.options.url,file:s+"/"+s+o+".proto"}).build(n);return r[t][o]=a[u]},encode:function(t){var o=this,e=o.getBuilder(t.command,"Req"),r=new window.ArrayBuffer(0);if(e){var i=o.options.sheet[t.command].split(".")[1],n=new e.DataReq(t.data),u=new e[i+"ReqIdl"];u.data=n,r=u.toArrayBuffer()}return o.util.atob64(r)},decode:function(t){var o=this;try{var e=o.getBuilder(t.command,"Res"),r=o.util.b64toa(t.data64);if(!e)return{};var i=o.options.sheet[t.command].split(".")[1];return e[i+"ResIdl"].decode(r)}catch(n){return console.error(n),{}}},buildAck:function(t){for(var o=1,e=o+":"+t.sequenceId,r=new window.ArrayBuffer(e.length),i=new window.Uint8Array(r),n=0,u=e.length;u>n;n++)i[n]=e.charCodeAt(n);return self.util.atob64(r)},buildNull:function(){return this.util.atob64(new window.ArrayBuffer(0))}}});
;window._.Module.define({path:"common/widget/DbUtil",sub:{initial:function(){this.logUtil=this.requireInstance("common/widget/LogUtil",[])},get:function(t){var o=null;try{o=localStorage.getItem(t)}catch(e){this.logUtil.error("\u8BFB\u53D6localStorage\u5931\u8D25",t)}return o},set:function(t,o){try{localStorage.setItem(t,o)}catch(e){this.logUtil.error("\u65E0\u6CD5\u8BBE\u7F6ElocalStorage",t,o)}},remove:function(t){try{localStorage.removeItem(t)}catch(o){this.logUtil.error("\u65E0\u6CD5\u5220\u9664localStorage",t)}}}});
;window._.Module.define({path:"common/widget/LcsConfig",sub:{COMMAND_PING:10,COMMAND_ACK:4,COMMAND_OFFLINE:2,COMMAND_COMMIT:209001,COMMAND_COMMIT_PERSIONAL:205001,SYS_COMMANDS:101,PAGE_FLAG:"LCS_PAGE_FLAG",PAGE_FLAG_EXPIRE:"LCS_PAGE_FLAG_EXPIRE",RESPONSE_PREFIX:"LCSMSG",REQUEST_PREFIX:"LCSSEND",LCS_SEQUENCE:"LCS_SEQUENCE"}});
;window._.Module.define({path:"common/widget/Lcs",sub:{initial:function(){this.logUtil=this.requireInstance("common/widget/LogUtil",[]),this.dbUtil=this.requireInstance("common/widget/DbUtil",[]),this.config=this.requireInstance("common/widget/LcsConfig",[]),this.codec=this.requireInstance("common/widget/Codec",[]),this.util=this.requireInstance("common/widget/LcsUtil",[]),this.initParams()},initParams:function(){var e=this;e.splitRE=/\s+/g;var t=e.empty=function(){};e.settingSnap={host:["im","tieba","baidu","com"].join(".")+":8000",Appid:"tieba",Appkey:"appkey",Cuid:$.cookie("BAIDUID"),DeviceType:"20","Extension-Version":"2.2","LCS-Header-Version":"1",timeout:1e4,retry:3,onopen:t,onclose:function(t){e.whenclose(t)},onerror:t,onmessage:function(t){e.writeResponse(t)},sendPing:function(t){e.sendPing(t)}},e.messageSnap={command:0,data:{},contentType:"pb",dataType:"pb",timeout:6e3,retry:!1,beforeSend:t,success:t,error:t,complete:t},e.isSupport=e.util.checkSupport(),e.sentList={},e.waitingList=[],e.listenerList={},e.queryQueueInterval=0,e.checkExpireInterval=0,e.checkExpireGap=3e4,e.isPageClosing=!1,e.currentPageFlag=this.util.createNonce()},onstorage:function(e){var t=this;t.logUtil.log("StorageEvent",e.key,e.oldValue,e.newValue);var n=t.config,i=t.dbUtil,o=e.key,s=e.newValue;o!==n.PAGE_FLAG||null!==s||t.isPageClosing?0===o.indexOf(n.RESPONSE_PREFIX)&&null!==s?t.onmessage(s):0===o.indexOf(n.REQUEST_PREFIX)&&null!==s&&1===t.socket.state()&&t.socket.send(s):(i.set(n.PAGE_FLAG,t.currentPageFlag),setTimeout(function(){i.get(n.PAGE_FLAG)===t.currentPageFlag&&t.socket.connect()},250))},whenclose:function(e){var t=this,n=t.config,i=t.dbUtil;t.isPageClosing?t.logUtil.log("\u6B63\u5728\u300C\u9000\u51FA\u7ADE\u4E89\u300D..."):(t.isPageClosing=!0,t.logUtil.log("\u5F00\u59CB\u300C\u9000\u51FA\u7ADE\u4E89\u300D\uFF0C\u53EF\u80FD\u7684close\u4E8B\u4EF6\u5BF9\u8C61\uFF1A",e),window.clearInterval(t.checkExpireInterval),i.get(n.PAGE_FLAG)===t.currentPageFlag&&(i.remove(n.PAGE_FLAG),t.socket.disconnect(),t.logUtil.log("\u65AD\u5F00\u8FDE\u63A5\uFF0C\u91CA\u653E\u6807\u5FD7\u4F4D\uFF0C\u5F15\u53D1\u5176\u5B83tab\u7ADE\u4E89")))},checkExpire:function(){var e=this,t=e.config,n=e.dbUtil,i=(new Date).getTime();if(n.get(t.PAGE_FLAG)===e.currentPageFlag)n.set(t.PAGE_FLAG_EXPIRE,i+2*e.checkExpireGap);else{var o=n.get(t.PAGE_FLAG_EXPIRE);i>o&&(n.remove(t.PAGE_FLAG),e.logUtil.error("\u91CA\u653E[\u522B\u4EBA\u7684]\u6807\u5FD7\u4F4D\uFF0C\u5F15\u53D1\u7ADE\u4E89",o,i),e.socket.disconnect())}},parseArguments:function(e){var t=this,n={};return n=$.extend({},t.settingSnap,e||{}),n.onopen=function(n,i,o){i&&(t.logUtil.log("\u6536\u5230Seq-Id",i),t.sequenceId(i)),"function"==typeof e.onopen&&e.onopen(n,i,o)},$.each(["Appid","Appkey","Cuid","host"],function(e,t){if(!n[t])throw new TypeError("\u9700\u8981\u8BBE\u5B9A"+t)}),n},connect:function(e){var t=this;t.socket||(t.socket=t.requireInstance("common/widget/Socket",[t.parseArguments(e)]));var n=t.dbUtil,i=t.config;$(window).on("beforeunload unload pagehide",function(e){t.whenclose(e)}),window.addEventListener("storage",function(e){t.onstorage(e)},!0),t.checkExpireInterval=window.setInterval(function(){t.checkExpire()},t.checkExpireGap),n.get(i.PAGE_FLAG)||(n.set(i.PAGE_FLAG,t.currentPageFlag),t.socket.connect())},sequenceId:function(e){var t=this,n=t.dbUtil,i=t.config;if("number"==typeof e)n.set(i.LCS_SEQUENCE,e);else if(void 0===e){var o=+n.get(i.LCS_SEQUENCE)+1;return n.set(i.LCS_SEQUENCE,o),o}},sendPing:function(e){this.send({command:this.config.COMMAND_PING,success:function(){e()}})},send:function(e){var t=this;e=e||{},"number"!=typeof e.command&&t.logUtil.error("\u9519\u8BEF\u7684\u547D\u4EE4\u53F7");var n=$.extend({},t.messageSnap,e);t.sendMessage(n)},sendMessage:function(e){var t=this,n=t.codec,i=t.config;switch(e.command){case i.COMMAND_ACK:e.data64=n.buildAck(e);break;case i.COMMAND_PING:e.data64=n.buildNull(),e.sequenceId=t.sequenceId();break;case i.COMMAND_OFFLINE:e.data64=n.buildNull(),e.sequenceId=t.sequenceId();break;default:e.data64=n.encode(e),e.sequenceId=t.sequenceId()}e.sendTime=(new Date).getTime(),e.beforeSend(e),t.logUtil.log("[\u53D1\u9001\u6D88\u606F]",e),1===t.socket.state()?t.socket.send(JSON.stringify(e)):t.dbUtil.set(i.REQUEST_PREFIX,JSON.stringify(e)),e.command!==i.COMMAND_ACK&&(t.sentList[e.sequenceId]=e),t.startQueryQueue()},startQueryQueue:function(){var e=this;e.stopQueryQueue();var t=e.sentList;e.queryQueueInterval=window.setInterval(function(){0===e.waitingList.length&&$.isEmptyObject(t)&&e.stopQueryQueue(),e.logUtil.log("[\u8F6E\u8BE2]\u6B63\u5728\u68C0\u67E5\u5DF2\u53D1\u9001\u961F\u5217",e.sentList),$.each(e.sentList,function(n,i){i.timeout>0&&(new Date).getTime()-i.sendTime>i.timeout&&(i.retry?(e.logUtil.log("\u6709\u4E00\u6761\u6D88\u606F\u5DF2\u8D85\u65F6\uFF0C\u51C6\u5907\u91CD\u8BD5",i),i.retry=!1,e.send(i)):(e.logUtil.error("\u6709\u4E00\u6761\u6D88\u606F\u5DF2\u8D85\u65F6\uFF0C\u672A\u8BBE\u7F6E\u6216\u5DF2\u7ECF\u91CD\u8BD5\uFF0C\u51C6\u5907\u8C03\u7528error\u65B9\u6CD5",i),i.error(i),i.complete(i)),delete t[n])})},3e3)},stopQueryQueue:function(){window.clearInterval(this.queryQueueInterval)},on:function(e,t){var n=this;if(!$.isFunction(t))return n.logUtil.error("on\u65B9\u6CD5\u5FC5\u987B\u63D0\u4F9B\u56DE\u8C03\u65B9\u6CD5"),this;if("number"==typeof e)e=[e];else if("string"==typeof e)e=e.split(n.splitRE);else if(!$.isArray(e))return n.logUtil.error("\u4E0D\u80FD\u8BC6\u522B\u7684\u547D\u4EE4\u53F7"),this;var i=n.listenerList;return $.each(e,function(e,n){i[n]?i[n].push(t):i[n]=[t]}),this},off:function(e,t){var n=this;if("number"==typeof e)e=[e];else if("string"==typeof e)e=e.split(n.splitRE);else if(!$.isArray(e))return this;var i=n.listenerList;return"undefined"==typeof t?$.each(e,function(e,t){i[+t]=[]}):$.isFunction(t)&&$.each(e,function(e,n){var o=i[+n];if(o){var s=o.indexOf(t);s>-1&&o.splice(s,1)}}),this},writeResponse:function(e){this.onmessage(e),this.dbUtil.set(this.config.RESPONSE_PREFIX,e)},onmessage:function(e){var t=this,n=t.config,i=JSON.parse(e);i.needAck&&setTimeout(function(){t.send({command:t.config.COMMAND_ACK,sequenceId:i.sequenceId,timeout:1})},0),i.data=i.command<t.config.SYS_COMMANDS?{}:t.codec.decode(i);var o=t.sentList,s=t.listenerList,c=o[i.sequenceId],r=null;i.command===n.COMMAND_COMMIT_PERSIONAL&&(i.command=n.COMMAND_COMMIT);var a=!1;c&&c.command===i.command&&(t.logUtil.log("\u5DF2\u627E\u5230\u6D88\u606F\u53D1\u9001\u8005",i),c.response=i.data,c.success(i.data,c),c.complete(i.data,c),delete o[i.sequenceId],a=!0),s[i.command]&&(r=s[i.command],t.logUtil.log("\u5DF2\u627E\u5230\u6D88\u606F\u76D1\u542C\u8005\uFF0C\u5C06\u4F9D\u6B21\u6267\u884C\u56DE\u8C03",i),$.each(r,function(e,t){t(i.data,i)}),a=!0),a||t.logUtil.log("\u65E2\u4E0D\u662F\u6D88\u606F\u8FD4\u56DE(\u6216\u8005\u8FD4\u56DE\u5DF2\u8D85\u65F6)\uFF0C\u53C8\u6CA1\u4EBA\u642D\u7406",i)},isWebSocketInCurrentTab:function(){return 1===this.socket.state()}}});
;window._.Module.define({path:"common/widget/LcsUtil",sub:{initial:function(){this.chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"},atob64:function(n){for(var t=new window.Uint8Array(n),e=t.length,r="",i=this.chars,o=0;e>o;o+=3)r+=i[t[o]>>2],r+=i[(3&t[o])<<4|t[o+1]>>4],r+=i[(15&t[o+1])<<2|t[o+2]>>6],r+=i[63&t[o+2]];return e%3===2?r=r.substring(0,r.length-1)+"=":e%3===1&&(r=r.substring(0,r.length-2)+"=="),r},b64toa:function(n){if(!n)return new window.ArrayBuffer(0);var t=.75*n.length,e=n.length,r=0;"="===n[n.length-1]&&(t--,"="===n[n.length-2]&&t--);for(var i=this.chars,o=new window.ArrayBuffer(t),f=new window.Uint8Array(o),a=0,c=0,u=0,w=0,h=0;e>h;h+=4)a=i.indexOf(n[h]),c=i.indexOf(n[h+1]),u=i.indexOf(n[h+2]),w=i.indexOf(n[h+3]),f[r++]=a<<2|c>>4,f[r++]=(15&c)<<4|u>>2,f[r++]=(3&u)<<6|63&w;return o},createNonce:function(){for(var n=0,t="";32>n;n++)t+=String.fromCharCode(26*Math.random()+65);return t},getSocket:function(){return window.WebSocket||window.MozWebSocket},checkSupport:function(){return!!this.getSocket()}}});
;!function(e){"use strict";function t(e){var t=function(e,n,i){if("undefined"==typeof e&&(e=t.DEFAULT_CAPACITY),"undefined"==typeof n&&(n=t.DEFAULT_ENDIAN),"undefined"==typeof i&&(i=t.DEFAULT_NOASSERT),!i){if(e=0|e,0>e)throw new RangeError("Illegal capacity: 0 <= "+e);if("boolean"!=typeof n)throw new TypeError("Illegal littleEndian: Not a boolean");if("boolean"!=typeof i)throw new TypeError("Illegal noAssert: Not a boolean")}this.buffer=0===e?r:new ArrayBuffer(e),this.view=0===e?null:new DataView(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=e,this.littleEndian="undefined"!=typeof n?!!n:!1,this.noAssert=!!i};t.VERSION="3.1.0",t.LITTLE_ENDIAN=!0,t.BIG_ENDIAN=!1,t.DEFAULT_CAPACITY=16,t.DEFAULT_ENDIAN=t.BIG_ENDIAN,t.DEFAULT_NOASSERT=!1,t.Long=e||null;var r=new ArrayBuffer(0);t.allocate=function(e,r,n){return new t(e,r,n)},t.concat=function(e,r,n,i){("boolean"==typeof r||"string"!=typeof r)&&(i=n,n=r,r=void 0);for(var f,o=0,s=0,h=e.length;h>s;++s)t.isByteBuffer(e[s])||(e[s]=t.wrap(e[s],r)),f=e[s].limit-e[s].offset,f>0&&(o+=f);if(0===o)return new t(0,n,i);var a,l=new t(o,n,i),u=new Uint8Array(l.buffer);for(s=0;h>s;)a=e[s++],f=a.limit-a.offset,0>=f||(u.set(new Uint8Array(a.buffer).subarray(a.offset,a.limit),l.offset),l.offset+=f);return l.limit=l.offset,l.offset=0,l},t.isByteBuffer=function(e){return e&&e instanceof t},t.type=function(){return ArrayBuffer},t.wrap=function(e,r,n,f){if("string"!=typeof r&&(f=n,n=r,r=void 0),"string"==typeof e)switch("undefined"==typeof r&&(r="utf8"),r){case"base64":return t.fromBase64(e,n);case"hex":return t.fromHex(e,n);case"binary":return t.fromBinary(e,n);case"utf8":return t.fromUTF8(e,n);case"debug":return t.fromDebug(e,n);default:throw new TypeError("Unsupported encoding: "+r)}if(null===e||"object"!=typeof e)throw new TypeError("Illegal buffer: null or non-object");var o;if(t.isByteBuffer(e))return o=t.prototype.clone.call(e),o.markedOffset=-1,o;if(e instanceof Uint8Array)o=new t(0,n,f),e.length>0&&(o.buffer=e.buffer,o.offset=e.byteOffset,o.limit=e.byteOffset+e.length,o.view=e.length>0?new DataView(e.buffer):null);else if(e instanceof ArrayBuffer)o=new t(0,n,f),e.byteLength>0&&(o.buffer=e,o.offset=0,o.limit=e.byteLength,o.view=e.byteLength>0?new DataView(e):null);else{if("[object Array]"!==Object.prototype.toString.call(e))throw new TypeError("Illegal buffer");for(o=new t(e.length,n,f),o.limit=e.length,i=0;i<e.length;++i)o.view.setUint8(i,e[i])}return o},t.prototype.writeInt8=function(e,t){var r="undefined"==typeof t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=1;var n=this.buffer.byteLength;return t>n&&this.resize((n*=2)>t?n:t),t-=1,this.view.setInt8(t,e),r&&(this.offset+=1),this},t.prototype.writeByte=t.prototype.writeInt8,t.prototype.readInt8=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+1>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r=this.view.getInt8(e);return t&&(this.offset+=1),r},t.prototype.readByte=t.prototype.readInt8,t.prototype.writeUint8=function(e,t){var r="undefined"==typeof t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=1;var n=this.buffer.byteLength;return t>n&&this.resize((n*=2)>t?n:t),t-=1,this.view.setUint8(t,e),r&&(this.offset+=1),this},t.prototype.readUint8=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+1>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r=this.view.getUint8(e);return t&&(this.offset+=1),r},t.prototype.writeInt16=function(e,t){var r="undefined"==typeof t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=2;var n=this.buffer.byteLength;return t>n&&this.resize((n*=2)>t?n:t),t-=2,this.view.setInt16(t,e,this.littleEndian),r&&(this.offset+=2),this},t.prototype.writeShort=t.prototype.writeInt16,t.prototype.readInt16=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+2>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+e+" (+2) <= "+this.buffer.byteLength)}var r=this.view.getInt16(e,this.littleEndian);return t&&(this.offset+=2),r},t.prototype.readShort=t.prototype.readInt16,t.prototype.writeUint16=function(e,t){var r="undefined"==typeof t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=2;var n=this.buffer.byteLength;return t>n&&this.resize((n*=2)>t?n:t),t-=2,this.view.setUint16(t,e,this.littleEndian),r&&(this.offset+=2),this},t.prototype.readUint16=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+2>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+e+" (+2) <= "+this.buffer.byteLength)}var r=this.view.getUint16(e,this.littleEndian);return t&&(this.offset+=2),r},t.prototype.writeInt32=function(e,t){var r="undefined"==typeof t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var n=this.buffer.byteLength;return t>n&&this.resize((n*=2)>t?n:t),t-=4,this.view.setInt32(t,e,this.littleEndian),r&&(this.offset+=4),this},t.prototype.writeInt=t.prototype.writeInt32,t.prototype.readInt32=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+4>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var r=this.view.getInt32(e,this.littleEndian);return t&&(this.offset+=4),r},t.prototype.readInt=t.prototype.readInt32,t.prototype.writeUint32=function(e,t){var r="undefined"==typeof t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var n=this.buffer.byteLength;return t>n&&this.resize((n*=2)>t?n:t),t-=4,this.view.setUint32(t,e,this.littleEndian),r&&(this.offset+=4),this},t.prototype.readUint32=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+4>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var r=this.view.getUint32(e,this.littleEndian);return t&&(this.offset+=4),r},e&&(t.prototype.writeInt64=function(t,r){var n="undefined"==typeof r;if(n&&(r=this.offset),!this.noAssert){if("number"==typeof t)t=e.fromNumber(t);else if(!(t&&t instanceof e))throw new TypeError("Illegal value: "+t+" (not an integer or Long)");if("number"!=typeof r||r%1!==0)throw new TypeError("Illegal offset: "+r+" (not an integer)");if(r>>>=0,0>r||r+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}"number"==typeof t&&(t=e.fromNumber(t)),r+=8;var i=this.buffer.byteLength;return r>i&&this.resize((i*=2)>r?i:r),r-=8,this.littleEndian?(this.view.setInt32(r,t.low,!0),this.view.setInt32(r+4,t.high,!0)):(this.view.setInt32(r,t.high,!1),this.view.setInt32(r+4,t.low,!1)),n&&(this.offset+=8),this},t.prototype.writeLong=t.prototype.writeInt64,t.prototype.readInt64=function(t){var r="undefined"==typeof t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+8>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+t+" (+8) <= "+this.buffer.byteLength)}var n=this.littleEndian?new e(this.view.getInt32(t,!0),this.view.getInt32(t+4,!0),!1):new e(this.view.getInt32(t+4,!1),this.view.getInt32(t,!1),!1);return r&&(this.offset+=8),n},t.prototype.readLong=t.prototype.readInt64,t.prototype.writeUint64=function(t,r){var n="undefined"==typeof r;if(n&&(r=this.offset),!this.noAssert){if("number"==typeof t)t=e.fromNumber(t);else if(!(t&&t instanceof e))throw new TypeError("Illegal value: "+t+" (not an integer or Long)");if("number"!=typeof r||r%1!==0)throw new TypeError("Illegal offset: "+r+" (not an integer)");if(r>>>=0,0>r||r+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}"number"==typeof t&&(t=e.fromNumber(t)),r+=8;var i=this.buffer.byteLength;return r>i&&this.resize((i*=2)>r?i:r),r-=8,this.littleEndian?(this.view.setInt32(r,t.low,!0),this.view.setInt32(r+4,t.high,!0)):(this.view.setInt32(r,t.high,!1),this.view.setInt32(r+4,t.low,!1)),n&&(this.offset+=8),this},t.prototype.readUint64=function(t){var r="undefined"==typeof t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+8>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+t+" (+8) <= "+this.buffer.byteLength)}var n=this.littleEndian?new e(this.view.getInt32(t,!0),this.view.getInt32(t+4,!0),!0):new e(this.view.getInt32(t+4,!1),this.view.getInt32(t,!1),!0);return r&&(this.offset+=8),n}),t.prototype.writeFloat32=function(e,t){var r="undefined"==typeof t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e)throw new TypeError("Illegal value: "+e+" (not a number)");if("number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var n=this.buffer.byteLength;return t>n&&this.resize((n*=2)>t?n:t),t-=4,this.view.setFloat32(t,e,this.littleEndian),r&&(this.offset+=4),this},t.prototype.writeFloat=t.prototype.writeFloat32,t.prototype.readFloat32=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+4>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var r=this.view.getFloat32(e,this.littleEndian);return t&&(this.offset+=4),r},t.prototype.readFloat=t.prototype.readFloat32,t.prototype.writeFloat64=function(e,t){var r="undefined"==typeof t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e)throw new TypeError("Illegal value: "+e+" (not a number)");if("number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=8;var n=this.buffer.byteLength;return t>n&&this.resize((n*=2)>t?n:t),t-=8,this.view.setFloat64(t,e,this.littleEndian),r&&(this.offset+=8),this},t.prototype.writeDouble=t.prototype.writeFloat64,t.prototype.readFloat64=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+8>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var r=this.view.getFloat64(e,this.littleEndian);return t&&(this.offset+=8),r},t.prototype.readDouble=t.prototype.readFloat64,t.MAX_VARINT32_BYTES=5,t.calculateVarint32=function(e){return e>>>=0,128>e?1:16384>e?2:1<<21>e?3:1<<28>e?4:5},t.zigZagEncode32=function(e){return((e|=0)<<1^e>>31)>>>0},t.zigZagDecode32=function(e){return e>>>1^-(1&e)|0},t.prototype.writeVarint32=function(e,r){var n="undefined"==typeof r;if(n&&(r=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof r||r%1!==0)throw new TypeError("Illegal offset: "+r+" (not an integer)");if(r>>>=0,0>r||r+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}var i,f=t.calculateVarint32(e);r+=f;var o=this.buffer.byteLength;return r>o&&this.resize((o*=2)>r?o:r),r-=f,this.view.setUint8(r,i=128|e),e>>>=0,e>=128?(i=e>>7|128,this.view.setUint8(r+1,i),e>=16384?(i=e>>14|128,this.view.setUint8(r+2,i),e>=1<<21?(i=e>>21|128,this.view.setUint8(r+3,i),e>=1<<28?(this.view.setUint8(r+4,e>>28&15),f=5):(this.view.setUint8(r+3,127&i),f=4)):(this.view.setUint8(r+2,127&i),f=3)):(this.view.setUint8(r+1,127&i),f=2)):(this.view.setUint8(r,127&i),f=1),n?(this.offset+=f,this):f},t.prototype.writeVarint32ZigZag=function(e,r){return this.writeVarint32(t.zigZagEncode32(e),r)},t.prototype.readVarint32=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+1>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r,n=0,i=0;do r=this.view.getUint8(e+n),5>n&&(i|=(127&r)<<7*n>>>0),++n;while(128===(128&r));return i=0|i,t?(this.offset+=n,i):{value:i,length:n}},t.prototype.readVarint32ZigZag=function(e){var r=this.readVarint32(e);return"object"==typeof r?r.value=t.zigZagDecode32(r.value):r=t.zigZagDecode32(r),r},e&&(t.MAX_VARINT64_BYTES=10,t.calculateVarint64=function(t){"number"==typeof t&&(t=e.fromNumber(t));var r=t.toInt()>>>0,n=t.shiftRightUnsigned(28).toInt()>>>0,i=t.shiftRightUnsigned(56).toInt()>>>0;return 0==i?0==n?16384>r?128>r?1:2:1<<21>r?3:4:16384>n?128>n?5:6:1<<21>n?7:8:128>i?9:10},t.zigZagEncode64=function(t){return"number"==typeof t?t=e.fromNumber(t,!1):t.unsigned!==!1&&(t=t.toSigned()),t.shiftLeft(1).xor(t.shiftRight(63)).toUnsigned()},t.zigZagDecode64=function(t){return"number"==typeof t?t=e.fromNumber(t,!1):t.unsigned!==!1&&(t=t.toSigned()),t.shiftRightUnsigned(1).xor(t.and(e.ONE).toSigned().negate()).toSigned()},t.prototype.writeVarint64=function(r,n){var i="undefined"==typeof n;if(i&&(n=this.offset),!this.noAssert){if("number"==typeof r)r=e.fromNumber(r);else if(!(r&&r instanceof e))throw new TypeError("Illegal value: "+r+" (not an integer or Long)");if("number"!=typeof n||n%1!==0)throw new TypeError("Illegal offset: "+n+" (not an integer)");if(n>>>=0,0>n||n+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}"number"==typeof r?r=e.fromNumber(r,!1):r.unsigned!==!1&&(r=r.toSigned());var f=t.calculateVarint64(r),o=r.toInt()>>>0,s=r.shiftRightUnsigned(28).toInt()>>>0,h=r.shiftRightUnsigned(56).toInt()>>>0;n+=f;var a=this.buffer.byteLength;switch(n>a&&this.resize((a*=2)>n?a:n),n-=f,f){case 10:this.view.setUint8(n+9,h>>>7&1);case 9:this.view.setUint8(n+8,9!==f?128|h:127&h);case 8:this.view.setUint8(n+7,8!==f?s>>>21|128:s>>>21&127);case 7:this.view.setUint8(n+6,7!==f?s>>>14|128:s>>>14&127);case 6:this.view.setUint8(n+5,6!==f?s>>>7|128:s>>>7&127);case 5:this.view.setUint8(n+4,5!==f?128|s:127&s);case 4:this.view.setUint8(n+3,4!==f?o>>>21|128:o>>>21&127);case 3:this.view.setUint8(n+2,3!==f?o>>>14|128:o>>>14&127);case 2:this.view.setUint8(n+1,2!==f?o>>>7|128:o>>>7&127);case 1:this.view.setUint8(n,1!==f?128|o:127&o)}return i?(this.offset+=f,this):f},t.prototype.writeVarint64ZigZag=function(e,r){return this.writeVarint64(t.zigZagEncode64(e),r)},t.prototype.readVarint64=function(t){var r="undefined"==typeof t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+1>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var n=t,i=0,f=0,o=0,s=0;if(s=this.view.getUint8(t++),i=127&s,128&s&&(s=this.view.getUint8(t++),i|=(127&s)<<7,128&s&&(s=this.view.getUint8(t++),i|=(127&s)<<14,128&s&&(s=this.view.getUint8(t++),i|=(127&s)<<21,128&s&&(s=this.view.getUint8(t++),f=127&s,128&s&&(s=this.view.getUint8(t++),f|=(127&s)<<7,128&s&&(s=this.view.getUint8(t++),f|=(127&s)<<14,128&s&&(s=this.view.getUint8(t++),f|=(127&s)<<21,128&s&&(s=this.view.getUint8(t++),o=127&s,128&s&&(s=this.view.getUint8(t++),o|=(127&s)<<7,128&s))))))))))throw new Error("Data must be corrupt: Buffer overrun");var h=e.from28Bits(i,f,o,!1);return r?(this.offset=t,h):{value:h,length:t-n}},t.prototype.readVarint64ZigZag=function(r){var n=this.readVarint64(r);return n&&n.value instanceof e?n.value=t.zigZagDecode64(n.value):n=t.zigZagDecode64(n),n}),t.prototype.writeCString=function(e,t){var r="undefined"==typeof t;r&&(t=this.offset);var n,i=e.length;if(!this.noAssert){if("string"!=typeof e)throw new TypeError("Illegal str: Not a string");for(n=0;i>n;++n)if(0===e.charCodeAt(n))throw new RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var o=t;i=f.calculateUTF16asUTF8(f.stringSource(e))[1],t+=i+1;var s=this.buffer.byteLength;return t>s&&this.resize((s*=2)>t?s:t),t-=i+1,f.encodeUTF16toUTF8(f.stringSource(e),function(e){this.view.setUint8(t++,e)}.bind(this)),this.view.setUint8(t++,0),r?(this.offset=t-o,this):i},t.prototype.readCString=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+1>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r,n=e,i=-1;return f.decodeUTF8toUTF16(function(){if(0===i)return null;if(e>=this.limit)throw RangeError("Illegal range: Truncated data, "+e+" < "+this.limit);return 0===(i=this.view.getUint8(e++))?null:i}.bind(this),r=f.stringDestination(),!0),t?(this.offset=e,r()):{string:r(),length:e-n}},t.prototype.writeIString=function(e,t){var r="undefined"==typeof t;if(r&&(t=this.offset),!this.noAssert){if("string"!=typeof e)throw new TypeError("Illegal str: Not a string");if("number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var n,i=t;n=f.calculateUTF16asUTF8(f.stringSource(e),this.noAssert)[1],t+=4+n;var o=this.buffer.byteLength;if(t>o&&this.resize((o*=2)>t?o:t),t-=4+n,this.view.setUint32(t,n,this.littleEndian),t+=4,f.encodeUTF16toUTF8(f.stringSource(e),function(e){this.view.setUint8(t++,e)}.bind(this)),t!==i+4+n)throw new RangeError("Illegal range: Truncated data, "+t+" == "+(t+4+n));return r?(this.offset=t,this):t-i},t.prototype.readIString=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+4>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var r,n=0,i=e;n=this.view.getUint32(e,this.littleEndian),e+=4;var o,s=e+n;return f.decodeUTF8toUTF16(function(){return s>e?this.view.getUint8(e++):null}.bind(this),o=f.stringDestination(),this.noAssert),r=o(),t?(this.offset=e,r):{string:r,length:e-i}},t.METRICS_CHARS="c",t.METRICS_BYTES="b",t.prototype.writeUTF8String=function(e,t){var r="undefined"==typeof t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var n,i=t;n=f.calculateUTF16asUTF8(f.stringSource(e))[1],t+=n;var o=this.buffer.byteLength;return t>o&&this.resize((o*=2)>t?o:t),t-=n,f.encodeUTF16toUTF8(f.stringSource(e),function(e){this.view.setUint8(t++,e)}.bind(this)),r?(this.offset=t,this):t-i},t.prototype.writeString=t.prototype.writeUTF8String,t.calculateUTF8Chars=function(e){return f.calculateUTF16asUTF8(f.stringSource(e))[0]},t.calculateUTF8Bytes=function(e){return f.calculateUTF16asUTF8(f.stringSource(e))[1]},t.prototype.readUTF8String=function(e,r,n){"number"==typeof r&&(n=r,r=void 0);var i="undefined"==typeof n;if(i&&(n=this.offset),"undefined"==typeof r&&(r=t.METRICS_CHARS),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal length: "+e+" (not an integer)");if(e|=0,"number"!=typeof n||n%1!==0)throw new TypeError("Illegal offset: "+n+" (not an integer)");if(n>>>=0,0>n||n+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}var o,s=0,h=n;if(r===t.METRICS_CHARS){if(o=f.stringDestination(),f.decodeUTF8(function(){return e>s&&n<this.limit?this.view.getUint8(n++):null}.bind(this),function(e){++s,f.UTF8toUTF16(e,o)}.bind(this)),s!==e)throw new RangeError("Illegal range: Truncated data, "+s+" == "+e);return i?(this.offset=n,o()):{string:o(),length:n-h}}if(r===t.METRICS_BYTES){if(!this.noAssert){if("number"!=typeof n||n%1!==0)throw new TypeError("Illegal offset: "+n+" (not an integer)");if(n>>>=0,0>n||n+e>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+n+" (+"+e+") <= "+this.buffer.byteLength)}var a=n+e;if(f.decodeUTF8toUTF16(function(){return a>n?this.view.getUint8(n++):null}.bind(this),o=f.stringDestination(),this.noAssert),n!==a)throw new RangeError("Illegal range: Truncated data, "+n+" == "+a);return i?(this.offset=n,o()):{string:o(),length:n-h}}throw new TypeError("Unsupported metrics: "+r)},t.prototype.readString=t.prototype.readUTF8String,t.prototype.writeVString=function(e,r){var n="undefined"==typeof r;if(n&&(r=this.offset),!this.noAssert){if("string"!=typeof e)throw new TypeError("Illegal str: Not a string");if("number"!=typeof r||r%1!==0)throw new TypeError("Illegal offset: "+r+" (not an integer)");if(r>>>=0,0>r||r+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}var i,o,s=r;i=f.calculateUTF16asUTF8(f.stringSource(e),this.noAssert)[1],o=t.calculateVarint32(i),r+=o+i;var h=this.buffer.byteLength;if(r>h&&this.resize((h*=2)>r?h:r),r-=o+i,r+=this.writeVarint32(i,r),f.encodeUTF16toUTF8(f.stringSource(e),function(e){this.view.setUint8(r++,e)}.bind(this)),r!==s+i+o)throw new RangeError("Illegal range: Truncated data, "+r+" == "+(r+i+o));return n?(this.offset=r,this):r-s},t.prototype.readVString=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+1>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r,n=this.readVarint32(e),i=e;e+=n.length,n=n.value;var o=e+n,s=f.stringDestination();return f.decodeUTF8toUTF16(function(){return o>e?this.view.getUint8(e++):null}.bind(this),s,this.noAssert),r=s(),t?(this.offset=e,r):{string:r,length:e-i}},t.prototype.append=function(e,r,n){("number"==typeof r||"string"!=typeof r)&&(n=r,r=void 0);var i="undefined"==typeof n;if(i&&(n=this.offset),!this.noAssert){if("number"!=typeof n||n%1!==0)throw new TypeError("Illegal offset: "+n+" (not an integer)");if(n>>>=0,0>n||n+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}e instanceof t||(e=t.wrap(e,r));var f=e.limit-e.offset;if(0>=f)return this;n+=f;var o=this.buffer.byteLength;return n>o&&this.resize((o*=2)>n?o:n),n-=f,new Uint8Array(this.buffer,n).set(new Uint8Array(e.buffer).subarray(e.offset,e.limit)),e.offset+=f,i&&(this.offset+=f),this},t.prototype.appendTo=function(e,t){return e.append(this,t),this},t.prototype.assert=function(e){return this.noAssert=!e,this},t.prototype.capacity=function(){return this.buffer.byteLength},t.prototype.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},t.prototype.clone=function(e){var r=new t(0,this.littleEndian,this.noAssert);if(e){var n=new ArrayBuffer(this.buffer.byteLength);new Uint8Array(n).set(this.buffer),r.buffer=n,r.view=new DataView(n)}else r.buffer=this.buffer,r.view=this.view;return r.offset=this.offset,r.markedOffset=this.markedOffset,r.limit=this.limit,r},t.prototype.compact=function(e,t){if("undefined"==typeof e&&(e=this.offset),"undefined"==typeof t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!==0)throw new TypeError("Illegal end: Not an integer");if(t>>>=0,0>e||e>t||t>this.buffer.byteLength)throw new RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}if(0===e&&t===this.buffer.byteLength)return this;var n=t-e;if(0===n)return this.buffer=r,this.view=null,this.markedOffset>=0&&(this.markedOffset-=e),this.offset=0,this.limit=0,this;var i=new ArrayBuffer(n);return new Uint8Array(i).set(new Uint8Array(this.buffer).subarray(e,t)),this.buffer=i,this.view=new DataView(i),this.markedOffset>=0&&(this.markedOffset-=e),this.offset=0,this.limit=n,this},t.prototype.copy=function(e,r){if("undefined"==typeof e&&(e=this.offset),"undefined"==typeof r&&(r=this.limit),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof r||r%1!==0)throw new TypeError("Illegal end: Not an integer");if(r>>>=0,0>e||e>r||r>this.buffer.byteLength)throw new RangeError("Illegal range: 0 <= "+e+" <= "+r+" <= "+this.buffer.byteLength)}if(e===r)return new t(0,this.littleEndian,this.noAssert);var n=r-e,i=new t(n,this.littleEndian,this.noAssert);return i.offset=0,i.limit=n,i.markedOffset>=0&&(i.markedOffset-=e),this.copyTo(i,0,e,r),i},t.prototype.copyTo=function(e,r,n,i){var f,o;if(!this.noAssert&&!t.isByteBuffer(e))throw new TypeError("Illegal target: Not a ByteBuffer");if(r=(o="undefined"==typeof r)?e.offset:0|r,n=(f="undefined"==typeof n)?this.offset:0|n,i="undefined"==typeof i?this.limit:0|i,0>r||r>e.buffer.byteLength)throw new RangeError("Illegal target range: 0 <= "+r+" <= "+e.buffer.byteLength);if(0>n||i>this.buffer.byteLength)throw new RangeError("Illegal source range: 0 <= "+n+" <= "+this.buffer.byteLength);var s=i-n;return 0===s?e:(e.ensureCapacity(r+s),new Uint8Array(e.buffer).set(new Uint8Array(this.buffer).subarray(n,i),r),f&&(this.offset+=s),o&&(e.offset+=s),this)},t.prototype.ensureCapacity=function(e){var t=this.buffer.byteLength;return e>t?this.resize((t*=2)>e?t:e):this},t.prototype.fill=function(e,t,r){var n="undefined"==typeof t;if(n&&(t=this.offset),"string"==typeof e&&e.length>0&&(e=e.charCodeAt(0)),"undefined"==typeof t&&(t=this.offset),"undefined"==typeof r&&(r=this.limit),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!==0)throw new TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof r||r%1!==0)throw new TypeError("Illegal end: Not an integer");if(r>>>=0,0>t||t>r||r>this.buffer.byteLength)throw new RangeError("Illegal range: 0 <= "+t+" <= "+r+" <= "+this.buffer.byteLength)}if(t>=r)return this;for(;r>t;)this.view.setUint8(t++,e);return n&&(this.offset=t),this},t.prototype.flip=function(){return this.limit=this.offset,this.offset=0,this},t.prototype.mark=function(e){if(e="undefined"==typeof e?this.offset:e,!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=e,this},t.prototype.order=function(e){if(!this.noAssert&&"boolean"!=typeof e)throw new TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!e,this},t.prototype.LE=function(e){return this.littleEndian="undefined"!=typeof e?!!e:!0,this},t.prototype.BE=function(e){return this.littleEndian="undefined"!=typeof e?!e:!1,this},t.prototype.prepend=function(e,r,n){("number"==typeof r||"string"!=typeof r)&&(n=r,r=void 0);var i="undefined"==typeof n;if(i&&(n=this.offset),!this.noAssert){if("number"!=typeof n||n%1!==0)throw new TypeError("Illegal offset: "+n+" (not an integer)");if(n>>>=0,0>n||n+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}e instanceof t||(e=t.wrap(e,r));var f=e.limit-e.offset;if(0>=f)return this;var o,s=f-n;if(s>0){var h=new ArrayBuffer(this.buffer.byteLength+s);o=new Uint8Array(h),o.set(new Uint8Array(this.buffer).subarray(n,this.buffer.byteLength),f),this.buffer=h,this.view=new DataView(h),this.offset+=s,this.markedOffset>=0&&(this.markedOffset+=s),this.limit+=s,n+=s}else o=new Uint8Array(this.buffer);return o.set(new Uint8Array(e.buffer).subarray(e.offset,e.limit),n-f),e.offset=e.limit,i&&(this.offset-=f),this},t.prototype.prependTo=function(e,t){return e.prepend(this,t),this},t.prototype.printDebug=function(e){"function"!=typeof e&&(e=console.log.bind(console)),e(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},t.prototype.remaining=function(){return this.limit-this.offset},t.prototype.reset=function(){return this.markedOffset>=0?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},t.prototype.resize=function(e){if(!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal capacity: "+e+" (not an integer)");if(e|=0,0>e)throw new RangeError("Illegal capacity: 0 <= "+e)}if(this.buffer.byteLength<e){var t=new ArrayBuffer(e);new Uint8Array(t).set(new Uint8Array(this.buffer)),this.buffer=t,this.view=new DataView(t)}return this},t.prototype.reverse=function(e,t){if("undefined"==typeof e&&(e=this.offset),"undefined"==typeof t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!==0)throw new TypeError("Illegal end: Not an integer");if(t>>>=0,0>e||e>t||t>this.buffer.byteLength)throw new RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}return e===t?this:(Array.prototype.reverse.call(new Uint8Array(this.buffer).subarray(e,t)),this.view=new DataView(this.buffer),this)},t.prototype.skip=function(e){if(!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal length: "+e+" (not an integer)");e|=0}var t=this.offset+e;if(!this.noAssert&&(0>t||t>this.buffer.byteLength))throw new RangeError("Illegal length: 0 <= "+this.offset+" + "+e+" <= "+this.buffer.byteLength);
return this.offset=t,this},t.prototype.slice=function(e,t){if("undefined"==typeof e&&(e=this.offset),"undefined"==typeof t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!==0)throw new TypeError("Illegal end: Not an integer");if(t>>>=0,0>e||e>t||t>this.buffer.byteLength)throw new RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}var r=this.clone();return r.offset=e,r.limit=t,r},t.prototype.toBuffer=function(e){var t=this.offset,n=this.limit;if(t>n){var i=t;t=n,n=i}if(!this.noAssert){if("number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: Not an integer");if(t>>>=0,"number"!=typeof n||n%1!==0)throw new TypeError("Illegal limit: Not an integer");if(n>>>=0,0>t||t>n||n>this.buffer.byteLength)throw new RangeError("Illegal range: 0 <= "+t+" <= "+n+" <= "+this.buffer.byteLength)}if(!e&&0===t&&n===this.buffer.byteLength)return this.buffer;if(t===n)return r;var f=new ArrayBuffer(n-t);return new Uint8Array(f).set(new Uint8Array(this.buffer).subarray(t,n),0),f},t.prototype.toArrayBuffer=t.prototype.toBuffer,t.prototype.toString=function(e){if("undefined"==typeof e)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch(e){case"utf8":return this.toUTF8();case"base64":return this.toBase64();case"hex":return this.toHex();case"binary":return this.toBinary();case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw new Error("Unsupported encoding: "+e)}};var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n+="",t.prototype.toBase64=function(e,t){if("undefined"==typeof e&&(e=this.offset),"undefined"==typeof t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!==0)throw new TypeError("Illegal end: Not an integer");if(t>>>=0,0>e||e>t||t>this.buffer.byteLength)throw new RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}if(e===t)return"";for(var r,i,f,o,s,h,a,l,u,g="";t>e;)r=this.view.getUint8(e++),i=(o=t>e)?this.view.getUint8(e++):0,f=(s=t>e)?this.view.getUint8(e++):0,h=r>>2,a=(3&r)<<4|i>>4,l=(15&i)<<2|f>>6,u=63&f,s||(u=64,o||(l=64)),g+=n.charAt(h)+n.charAt(a)+n.charAt(l)+n.charAt(u);return g},t.fromBase64=function(e,r,i){if(!i){if("string"!=typeof e)throw new TypeError("Illegal str: Not a string");if(e.length%4!==0)throw new TypeError("Illegal str: Length not a multiple of 4")}var f,o,s=e.length,h=0;for(f=e.length-1;f>=0&&"="===e.charAt(f);--f)h++;if(h>2)throw new TypeError("Illegal str: Suffix is too large");if(0===s)return new t(0,r,i);var a,l,u,g,y,p,w,b=new t(s/4*3-h,r,i);for(f=0,o=0;s>f;){if(a=n.indexOf(e.charAt(f++)),l=(y=s>f)?n.indexOf(e.charAt(f++)):0,u=(p=s>f)?n.indexOf(e.charAt(f++)):0,g=(w=s>f)?n.indexOf(e.charAt(f++)):0,!i&&(0>a||0>l||0>u||0>g))throw new TypeError("Illegal str: Contains non-base64 characters");b.view.setUint8(o++,a<<2|l>>4),64!==u&&(b.view.setUint8(o++,l<<4&240|u>>2,o),64!==g&&b.view.setUint8(o++,u<<6&192|g))}return b.limit=o,b},t.btoa=function(e){return t.fromBinary(e).toBase64()},t.atob=function(e){return t.fromBase64(e).toBinary()},t.prototype.toBinary=function(e,t){if(e="undefined"==typeof e?this.offset:e,t="undefined"==typeof t?this.limit:t,!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!==0)throw new TypeError("Illegal end: Not an integer");if(t>>>=0,0>e||e>t||t>this.buffer.byteLength)throw new RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}if(e===t)return"";for(var r=[];t>e;)r.push(this.view.getUint8(e++));return String.fromCharCode.apply(String,r)},t.fromBinary=function(e,r,n){if(!n&&"string"!=typeof e)throw new TypeError("Illegal str: Not a string");for(var i,f=0,o=e.length,s=new t(o,r,n);o>f;){if(i=e.charCodeAt(f),!n&&i>255)throw new TypeError("Illegal charCode at "+f+": 0 <= "+i+" <= 255");s.view.setUint8(f++,i)}return s.limit=o,s},t.prototype.toDebug=function(e){for(var t,r=-1,n=this.buffer.byteLength,i="",f="",o="";n>r;){if(-1!==r&&(t=this.view.getUint8(r),i+=16>t?"0"+t.toString(16).toUpperCase():t.toString(16).toUpperCase(),e&&(f+=t>32&&127>t?String.fromCharCode(t):".")),++r,e&&r>0&&r%16===0&&r!==n){for(;i.length<51;)i+=" ";o+=i+f+"\n",i=f=""}i+=r===this.offset&&r===this.limit?r===this.markedOffset?"!":"|":r===this.offset?r===this.markedOffset?"[":"<":r===this.limit?r===this.markedOffset?"]":">":r===this.markedOffset?"'":e||0!==r&&r!==n?" ":""}if(e&&" "!==i){for(;i.length<51;)i+=" ";o+=i+f+"\n"}return e?o:i},t.fromDebug=function(e,r,n){for(var i,f,o=e.length,s=new t((o+1)/3|0,r,n),h=0,a=0,l=!1,u=!1,g=!1,y=!1,p=!1;o>h;){switch(i=e.charAt(h++)){case"!":if(!n){if(u||g||y){p=!0;break}u=g=y=!0}s.offset=s.markedOffset=s.limit=a,l=!1;break;case"|":if(!n){if(u||y){p=!0;break}u=y=!0}s.offset=s.limit=a,l=!1;break;case"[":if(!n){if(u||g){p=!0;break}u=g=!0}s.offset=s.markedOffset=a,l=!1;break;case"<":if(!n){if(u){p=!0;break}u=!0}s.offset=a,l=!1;break;case"]":if(!n){if(y||g){p=!0;break}y=g=!0}s.limit=s.markedOffset=a,l=!1;break;case">":if(!n){if(y){p=!0;break}y=!0}s.limit=a,l=!1;break;case"'":if(!n){if(g){p=!0;break}g=!0}s.markedOffset=a,l=!1;break;case" ":l=!1;break;default:if(!n&&l){p=!0;break}if(f=parseInt(i+e.charAt(h++),16),!n&&(isNaN(f)||0>f||f>255))throw new TypeError("Illegal str: Not a debug encoded string");s.view.setUint8(a++,f),l=!0}if(p)throw new TypeError("Illegal str: Invalid symbol at "+h)}if(!n){if(!u||!y)throw new TypeError("Illegal str: Missing offset or limit");if(a<s.buffer.byteLength)throw new TypeError("Illegal str: Not a debug encoded string (is it hex?) "+a+" < "+o)}return s},t.prototype.toHex=function(e,t){if(e="undefined"==typeof e?this.offset:e,t="undefined"==typeof t?this.limit:t,!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!==0)throw new TypeError("Illegal end: Not an integer");if(t>>>=0,0>e||e>t||t>this.buffer.byteLength)throw new RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}for(var r,n=new Array(t-e);t>e;)r=this.view.getUint8(e++),16>r?n.push("0",r.toString(16)):n.push(r.toString(16));return n.join("")},t.fromHex=function(e,r,n){if(!n){if("string"!=typeof e)throw new TypeError("Illegal str: Not a string");if(e.length%2!==0)throw new TypeError("Illegal str: Length not a multiple of 2")}for(var i,f=e.length,o=new t(f/2|0,r),s=0,h=0;f>s;s+=2){if(i=parseInt(e.substring(s,s+2),16),!n&&(!isFinite(i)||0>i||i>255))throw new TypeError("Illegal str: Contains non-hex characters");o.view.setUint8(h++,i)}return o.limit=h,o};var f=function(){var e={};return e.encodeUTF8=function(e,t){var r=null;for("number"==typeof e&&(r=e,e=function(){return null});null!==r||null!==(r=e());)128>r?t(127&r):2048>r?(t(r>>6&31|192),t(63&r|128)):65536>r?(t(r>>12&15|224),t(r>>6&63|128),t(63&r|128)):(t(r>>18&7|240),t(r>>12&63|128),t(r>>6&63|128),t(63&r|128)),r=null},e.decodeUTF8=function(e,t){for(var r,n,i,f,o=function(e){e=e.slice(0,e.indexOf(null));var t=Error(e.toString());throw t.name="TruncatedError",t.bytes=e,t};null!==(r=e());)if(0===(128&r))t(r);else if(192===(224&r))null===(n=e())&&o([r,n]),t((31&r)<<6|63&n);else if(224===(240&r))(null===(n=e())||null===(i=e()))&&o([r,n,i]),t((15&r)<<12|(63&n)<<6|63&i);else{if(240!==(248&r))throw RangeError("Illegal starting byte: "+r);(null===(n=e())||null===(i=e())||null===(f=e()))&&o([r,n,i,f]),t((7&r)<<18|(63&n)<<12|(63&i)<<6|63&f)}},e.UTF16toUTF8=function(e,t){for(var r,n=null;;){if(null===(r=null!==n?n:e()))break;r>=55296&&57343>=r&&null!==(n=e())&&n>=56320&&57343>=n?(t(1024*(r-55296)+n-56320+65536),n=null):t(r)}null!==n&&t(n)},e.UTF8toUTF16=function(e,t){var r=null;for("number"==typeof e&&(r=e,e=function(){return null});null!==r||null!==(r=e());)65535>=r?t(r):(r-=65536,t((r>>10)+55296),t(r%1024+56320)),r=null},e.encodeUTF16toUTF8=function(t,r){e.UTF16toUTF8(t,function(t){e.encodeUTF8(t,r)})},e.decodeUTF8toUTF16=function(t,r){e.decodeUTF8(t,function(t){e.UTF8toUTF16(t,r)})},e.assertByte=function(e){if("number"!=typeof e||e!==e)throw TypeError("Illegal byte: "+typeof e);if(-128>e||e>255)throw RangeError("Illegal byte: "+e);return e},e.assertCharCode=function(e){if("number"!=typeof e||e!==e)throw TypeError("Illegal char code: "+typeof e);if(0>e||e>65535)throw RangeError("Illegal char code: "+e);return e},e.assertCodePoint=function(e){if("number"!=typeof e||e!==e)throw TypeError("Illegal code point: "+typeof e);if(0>e||e>1114111)throw RangeError("Illegal code point: "+e);return e},e.calculateCodePoint=function(e){return 128>e?1:2048>e?2:65536>e?3:4},e.calculateUTF8=function(t){for(var r,n=0;null!==(r=t());)n+=e.calculateCodePoint(r);return n},e.calculateUTF16asUTF8=function(t){var r=0,n=0;return e.UTF16toUTF8(t,function(t){++r,n+=e.calculateCodePoint(t)}),[r,n]},e}(),o=String.fromCharCode;return f.stringSource=function(e){var t=0;return function(){return t<e.length?e.charCodeAt(t++):null}},f.stringDestination=function(){var e=[],t=[];return function(){return 0===arguments.length?t.join("")+o.apply(String,e):(e.length+arguments.length>1024&&(t.push(o.apply(String,e)),e.length=0),void Array.prototype.push.apply(e,arguments))}},t.prototype.toUTF8=function(e,t){if("undefined"==typeof e&&(e=this.offset),"undefined"==typeof t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!==0)throw new TypeError("Illegal end: Not an integer");if(t>>>=0,0>e||e>t||t>this.buffer.byteLength)throw new RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}var r,n=this;try{f.decodeUTF8toUTF16(function(){return t>e?n.view.getUint8(e++):null},r=f.stringDestination())}catch(i){if(e!==t)throw new RangeError("Illegal range: Truncated data, "+e+" != "+t)}return r()},t.fromUTF8=function(e,r,n){if(!n&&"string"!=typeof e)throw new TypeError("Illegal str: Not a string");var i=new t(f.calculateUTF16asUTF8(f.stringSource(e),!0)[1],r,n),o=0;return f.encodeUTF16toUTF8(f.stringSource(e),function(e){i.view.setUint8(o++,e)}),i.limit=o,i},t}"undefined"!=typeof module&&module.exports?module.exports=t(require("long")):"undefined"!=typeof define&&define.amd?define("ByteBuffer",["Math/Long"],function(e){return t(e)}):(e.dcodeIO||(e.dcodeIO={}),e.dcodeIO.ByteBuffer=t(e.dcodeIO.Long))}(this);
;!function(t){"use strict";var i=function(t,i,r){t&&"object"==typeof t&&(i=t.high,r=t.unsigned,t=t.low),this.low=0|t,this.high=0|i,this.unsigned=!!r},r={},e={};i.fromInt=function(t,n){var o,s;return n?(t>>>=0,t>=0&&256>t&&(s=e[t])?s:(o=new i(t,0>(0|t)?-1:0,!0),t>=0&&256>t&&(e[t]=o),o)):(t=0|t,t>=-128&&128>t&&(s=r[t])?s:(o=new i(t,0>t?-1:0,!1),t>=-128&&128>t&&(r[t]=o),o))},i.fromNumber=function(t,r){return r=!!r,isNaN(t)||!isFinite(t)?i.ZERO:!r&&-h>=t?i.MIN_SIGNED_VALUE:r&&0>=t?i.MIN_UNSIGNED_VALUE:!r&&t+1>=h?i.MAX_SIGNED_VALUE:r&&t>=s?i.MAX_UNSIGNED_VALUE:0>t?i.fromNumber(-t,!1).negate():new i(t%o|0,t/o|0,r)},i.fromBits=function(t,r,e){return new i(t,r,e)},i.from28Bits=function(t,r,e,n){return i.fromBits(t|r<<28,r>>>4|e<<24,n)},i.fromString=function(t,r,e){if(0==t.length)throw new Error("number format error: empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return i.ZERO;if("number"==typeof r&&(e=r,r=!1),e=e||10,2>e||e>36)throw new Error("radix out of range: "+e);if("-"==t.charAt(0))return i.fromString(t.substring(1),r,e).negate();if(t.indexOf("-")>=0)throw new Error('number format error: interior "-" character: '+t);for(var n=i.fromNumber(Math.pow(e,8)),o=i.ZERO,s=0;s<t.length;s+=8){var h=Math.min(8,t.length-s),u=parseInt(t.substring(s,s+h),e);if(8>h){var f=i.fromNumber(Math.pow(e,h));o=o.multiply(f).add(i.fromNumber(u))}else o=o.multiply(n),o=o.add(i.fromNumber(u))}return o.unsigned=r,o};var n=65536,o=n*n,s=o*o,h=s/2,u=i.fromInt(1<<24);i.ZERO=i.fromInt(0),i.UZERO=i.fromInt(0,!0),i.ONE=i.fromInt(1),i.UONE=i.fromInt(1,!0),i.NEG_ONE=i.fromInt(-1),i.MAX_SIGNED_VALUE=i.fromBits(-1,2147483647,!1),i.MAX_UNSIGNED_VALUE=i.fromBits(-1,-1,!0),i.MAX_VALUE=i.MAX_SIGNED_VALUE,i.MIN_SIGNED_VALUE=i.fromBits(0,-2147483648,!1),i.MIN_UNSIGNED_VALUE=i.fromBits(0,0,!0),i.MIN_VALUE=i.MIN_SIGNED_VALUE,i.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},i.prototype.toNumber=function(){return this.unsigned?(this.high>>>0)*o+(this.low>>>0):this.high*o+(this.low>>>0)},i.prototype.toString=function(t){if(t=t||10,2>t||t>36)throw new Error("radix out of range: "+t);if(this.isZero())return"0";var r;if(this.isNegative()){if(this.equals(i.MIN_SIGNED_VALUE)){var e=i.fromNumber(t),n=this.div(e);return r=n.multiply(e).subtract(this),n.toString(t)+r.toInt().toString(t)}return"-"+this.negate().toString(t)}var o=i.fromNumber(Math.pow(t,6));r=this;for(var s="";;){var h=r.div(o),u=r.subtract(h.multiply(o)).toInt(),f=u.toString(t);if(r=h,r.isZero())return f+s;for(;f.length<6;)f="0"+f;s=""+f+s}},i.prototype.getHighBits=function(){return this.high},i.prototype.getHighBitsUnsigned=function(){return this.high>>>0},i.prototype.getLowBits=function(){return this.low},i.prototype.getLowBitsUnsigned=function(){return this.low>>>0},i.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(i.MIN_SIGNED_VALUE)?64:this.negate().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,r=31;r>0&&0==(t&1<<r);r--);return 0!=this.high?r+33:r+1},i.prototype.isZero=function(){return 0==this.high&&0==this.low},i.prototype.isNegative=function(){return!this.unsigned&&this.high<0},i.prototype.isOdd=function(){return 1==(1&this.low)},i.prototype.isEven=function(){return 0==(1&this.low)},i.prototype.equals=function(t){return this.unsigned!=t.unsigned&&this.high>>>31!=t.high>>>31?!1:this.high==t.high&&this.low==t.low},i.prototype.notEquals=function(t){return!this.equals(t)},i.prototype.lessThan=function(t){return this.compare(t)<0},i.prototype.lessThanOrEqual=function(t){return this.compare(t)<=0},i.prototype.greaterThan=function(t){return this.compare(t)>0},i.prototype.greaterThanOrEqual=function(t){return this.compare(t)>=0},i.prototype.compare=function(t){if(this.equals(t))return 0;var i=this.isNegative(),r=t.isNegative();return i&&!r?-1:!i&&r?1:this.unsigned?t.high>>>0>this.high>>>0||t.high==this.high&&t.low>>>0>this.low>>>0?-1:1:this.subtract(t).isNegative()?-1:1},i.prototype.negate=function(){return!this.unsigned&&this.equals(i.MIN_SIGNED_VALUE)?i.MIN_SIGNED_VALUE:this.not().add(i.ONE)},i.prototype.add=function(t){var r=this.high>>>16,e=65535&this.high,n=this.low>>>16,o=65535&this.low,s=t.high>>>16,h=65535&t.high,u=t.low>>>16,f=65535&t.low,g=0,a=0,p=0,l=0;return l+=o+f,p+=l>>>16,l&=65535,p+=n+u,a+=p>>>16,p&=65535,a+=e+h,g+=a>>>16,a&=65535,g+=r+s,g&=65535,i.fromBits(p<<16|l,g<<16|a,this.unsigned)},i.prototype.subtract=function(t){return this.add(t.negate())},i.prototype.multiply=function(t){if(this.isZero())return i.ZERO;if(t.isZero())return i.ZERO;if(this.equals(i.MIN_VALUE))return t.isOdd()?i.MIN_VALUE:i.ZERO;if(t.equals(i.MIN_VALUE))return this.isOdd()?i.MIN_VALUE:i.ZERO;if(this.isNegative())return t.isNegative()?this.negate().multiply(t.negate()):this.negate().multiply(t).negate();if(t.isNegative())return this.multiply(t.negate()).negate();if(this.lessThan(u)&&t.lessThan(u))return i.fromNumber(this.toNumber()*t.toNumber(),this.unsigned);var r=this.high>>>16,e=65535&this.high,n=this.low>>>16,o=65535&this.low,s=t.high>>>16,h=65535&t.high,f=t.low>>>16,g=65535&t.low,a=0,p=0,l=0,N=0;return N+=o*g,l+=N>>>16,N&=65535,l+=n*g,p+=l>>>16,l&=65535,l+=o*f,p+=l>>>16,l&=65535,p+=e*g,a+=p>>>16,p&=65535,p+=n*f,a+=p>>>16,p&=65535,p+=o*h,a+=p>>>16,p&=65535,a+=r*g+e*f+n*h+o*s,a&=65535,i.fromBits(l<<16|N,a<<16|p,this.unsigned)},i.prototype.div=function(t){if(t.isZero())throw new Error("division by zero");if(this.isZero())return this.unsigned?i.UZERO:i.ZERO;var r,e,n;if(this.equals(i.MIN_SIGNED_VALUE)){if(t.equals(i.ONE)||t.equals(i.NEG_ONE))return i.MIN_SIGNED_VALUE;if(t.equals(i.MIN_SIGNED_VALUE))return i.ONE;var o=this.shiftRight(1);return r=o.div(t).shiftLeft(1),r.equals(i.ZERO)?t.isNegative()?i.ONE:i.NEG_ONE:(e=this.subtract(t.multiply(r)),n=r.add(e.div(t)))}if(t.equals(i.MIN_SIGNED_VALUE))return this.unsigned?i.UZERO:i.ZERO;if(this.isNegative())return t.isNegative()?this.negate().div(t.negate()):this.negate().div(t).negate();if(t.isNegative())return this.div(t.negate()).negate();for(n=i.ZERO,e=this;e.greaterThanOrEqual(t);){r=Math.max(1,Math.floor(e.toNumber()/t.toNumber()));for(var s=Math.ceil(Math.log(r)/Math.LN2),h=48>=s?1:Math.pow(2,s-48),u=i.fromNumber(r,this.unsigned),f=u.multiply(t);f.isNegative()||f.greaterThan(e);)r-=h,u=i.fromNumber(r,this.unsigned),f=u.multiply(t);u.isZero()&&(u=i.ONE),n=n.add(u),e=e.subtract(f)}return n},i.prototype.modulo=function(t){return this.subtract(this.div(t).multiply(t))},i.prototype.not=function(){return i.fromBits(~this.low,~this.high,this.unsigned)},i.prototype.and=function(t){return i.fromBits(this.low&t.low,this.high&t.high,this.unsigned)},i.prototype.or=function(t){return i.fromBits(this.low|t.low,this.high|t.high,this.unsigned)},i.prototype.xor=function(t){return i.fromBits(this.low^t.low,this.high^t.high,this.unsigned)},i.prototype.shiftLeft=function(t){if(t&=63,0==t)return this;var r=this.low;if(32>t){var e=this.high;return i.fromBits(r<<t,e<<t|r>>>32-t,this.unsigned)}return i.fromBits(0,r<<t-32,this.unsigned)},i.prototype.shiftRight=function(t){if(t&=63,0==t)return this;var r=this.high;if(32>t){var e=this.low;return i.fromBits(e>>>t|r<<32-t,r>>t,this.unsigned)}return i.fromBits(r>>t-32,r>=0?0:-1,this.unsigned)},i.prototype.shiftRightUnsigned=function(t){if(t&=63,0==t)return this;var r=this.high;if(32>t){var e=this.low;return i.fromBits(e>>>t|r<<32-t,r>>>t,this.unsigned)}return 32==t?i.fromBits(r,0,this.unsigned):i.fromBits(r>>>t-32,0,this.unsigned)},i.prototype.toSigned=function(){var t=this.clone();return t.unsigned=!1,t},i.prototype.toUnsigned=function(){var t=this.clone();return t.unsigned=!0,t},i.prototype.clone=function(){return new i(this.low,this.high,this.unsigned)},"undefined"!=typeof module&&module.exports?module.exports=i:"undefined"!=typeof define&&define.amd?define("Math/Long",[],function(){return i}):(t.dcodeIO||(t.dcodeIO={}),t.dcodeIO.Long=i)}(this);
;!function(e){"use strict";function t(e){if(!e||!e.VERSION||e.VERSION.split(".")[0]<3)throw Error("ProtoBuf.js requires ByteBuffer.js >=3");var t={};return t.VERSION="3.1.0",t.WIRE_TYPES={},t.WIRE_TYPES.VARINT=0,t.WIRE_TYPES.BITS64=1,t.WIRE_TYPES.LDELIM=2,t.WIRE_TYPES.STARTGROUP=3,t.WIRE_TYPES.ENDGROUP=4,t.WIRE_TYPES.BITS32=5,t.PACKABLE_WIRE_TYPES=[t.WIRE_TYPES.VARINT,t.WIRE_TYPES.BITS64,t.WIRE_TYPES.BITS32],t.TYPES={int32:{name:"int32",wireType:t.WIRE_TYPES.VARINT},uint32:{name:"uint32",wireType:t.WIRE_TYPES.VARINT},sint32:{name:"sint32",wireType:t.WIRE_TYPES.VARINT},int64:{name:"int64",wireType:t.WIRE_TYPES.VARINT},uint64:{name:"uint64",wireType:t.WIRE_TYPES.VARINT},sint64:{name:"sint64",wireType:t.WIRE_TYPES.VARINT},bool:{name:"bool",wireType:t.WIRE_TYPES.VARINT},"double":{name:"double",wireType:t.WIRE_TYPES.BITS64},string:{name:"string",wireType:t.WIRE_TYPES.LDELIM},bytes:{name:"bytes",wireType:t.WIRE_TYPES.LDELIM},fixed32:{name:"fixed32",wireType:t.WIRE_TYPES.BITS32},sfixed32:{name:"sfixed32",wireType:t.WIRE_TYPES.BITS32},fixed64:{name:"fixed64",wireType:t.WIRE_TYPES.BITS64},sfixed64:{name:"sfixed64",wireType:t.WIRE_TYPES.BITS64},"float":{name:"float",wireType:t.WIRE_TYPES.BITS32},"enum":{name:"enum",wireType:t.WIRE_TYPES.VARINT},message:{name:"message",wireType:t.WIRE_TYPES.LDELIM},group:{name:"group",wireType:t.WIRE_TYPES.STARTGROUP}},t.ID_MIN=1,t.ID_MAX=536870911,t.ByteBuffer=e,t.Long=e.Long||null,t.convertFieldsToCamelCase=!1,t.Util=function(){Object.create||(Object.create=function(e){function t(){}if(arguments.length>1)throw new Error("Object.create implementation only accepts the first parameter.");return t.prototype=e,new t});var e={};e.IS_NODE=!1;try{e.IS_NODE="function"==typeof require&&"function"==typeof require("fs").readFileSync&&"function"==typeof require("path").resolve}catch(t){}return e.XHR=function(){for(var e=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],t=null,n=0;n<e.length;n++){try{t=e[n]()}catch(i){continue}break}if(!t)throw new Error("XMLHttpRequest is not supported");return t},e.fetch=function(t,n){if(n&&"function"!=typeof n&&(n=null),e.IS_NODE)if(n)require("fs").readFile(t,function(e,t){n(e?null:""+t)});else try{return require("fs").readFileSync(t)}catch(i){return null}else{var r=e.XHR();if(r.open("GET",t,n?!0:!1),r.setRequestHeader("Accept","text/plain"),"function"==typeof r.overrideMimeType&&r.overrideMimeType("text/plain"),!n)return r.send(null),200==r.status||0==r.status&&"string"==typeof r.responseText?r.responseText:null;if(r.onreadystatechange=function(){4==r.readyState&&n(200==r.status||0==r.status&&"string"==typeof r.responseText?r.responseText:null)},4==r.readyState)return;r.send(null)}},e.isArray=function(e){return e?e instanceof Array?!0:Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e):!1},e}(),t.Lang={OPEN:"{",CLOSE:"}",OPTOPEN:"[",OPTCLOSE:"]",OPTEND:",",EQUAL:"=",END:";",STRINGOPEN:'"',STRINGCLOSE:'"',STRINGOPEN_SQ:"'",STRINGCLOSE_SQ:"'",COPTOPEN:"(",COPTCLOSE:")",DELIM:/[\s\{\}=;\[\],'"\(\)]/g,RULE:/^(?:required|optional|repeated)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0x[0-9a-fA-F]+|0[0-7]+|([0-9]*\.[0-9]+([Ee][+-]?[0-9]+)?))$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0x[0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^[0-9]*\.[0-9]+([Ee][+-]?[0-9]+)?$/,ID:/^(?:[1-9][0-9]*|0|0x[0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0x[0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/['"]([^'"\\]*(\\.[^"\\]*)*)['"]/g,BOOL:/^(?:true|false)$/i},t.DotProto=function(e,t){var n={},i=function(e){this.source=""+e,this.index=0,this.line=1,this.stack=[],this.readingString=!1,this.stringEndsWith=t.STRINGCLOSE};i.prototype._readString=function(){t.STRING.lastIndex=this.index-1;var e;if(null!==(e=t.STRING.exec(this.source))){var n=e[1];return this.index=t.STRING.lastIndex,this.stack.push(this.stringEndsWith),n}throw new Error("Illegal string value at line "+this.line+", index "+this.index)},i.prototype.next=function(){if(this.stack.length>0)return this.stack.shift();if(this.index>=this.source.length)return null;if(this.readingString)return this.readingString=!1,this._readString();var e,n;do{for(e=!1;t.WHITESPACE.test(n=this.source.charAt(this.index));)if(this.index++,"\n"===n&&this.line++,this.index===this.source.length)return null;if("/"===this.source.charAt(this.index))if("/"===this.source.charAt(++this.index)){for(;"\n"!==this.source.charAt(this.index);)if(this.index++,this.index==this.source.length)return null;this.index++,this.line++,e=!0}else{if("*"!==this.source.charAt(this.index))throw new Error("Invalid comment at line "+this.line+": /"+this.source.charAt(this.index)+" ('/' or '*' expected)");for(n="";n+(n=this.source.charAt(this.index))!=="*/";)if(this.index++,"\n"===n&&this.line++,this.index===this.source.length)return null;this.index++,e=!0}}while(e);if(this.index===this.source.length)return null;var i=this.index;t.DELIM.lastIndex=0;var r=t.DELIM.test(this.source.charAt(i));if(r)i++;else for(i++;i<this.source.length&&!t.DELIM.test(this.source.charAt(i));)i++;var s=this.source.substring(this.index,this.index=i);return s===t.STRINGOPEN?(this.readingString=!0,this.stringEndsWith=t.STRINGCLOSE):s===t.STRINGOPEN_SQ&&(this.readingString=!0,this.stringEndsWith=t.STRINGCLOSE_SQ),s},i.prototype.peek=function(){if(0===this.stack.length){var e=this.next();if(null===e)return null;this.stack.push(e)}return this.stack[0]},i.prototype.toString=function(){return"Tokenizer("+this.index+"/"+this.source.length+" at line "+this.line+")"},n.Tokenizer=i;var r=function(e){this.tn=new i(e)};return r.prototype.parse=function(){for(var e,t={name:"[ROOT]","package":null,messages:[],enums:[],imports:[],options:{},services:[]},n=!0;e=this.tn.next();)switch(e){case"package":if(!n)throw new Error("Illegal package definition at line "+this.tn.line+": Must be declared before the first message or enum");if(null!==t["package"])throw new Error("Illegal package definition at line "+this.tn.line+": Package already declared");t["package"]=this._parsePackage(e);break;case"import":if(!n)throw new Error("Illegal import definition at line "+this.tn.line+": Must be declared before the first message or enum");t.imports.push(this._parseImport(e));break;case"message":this._parseMessage(t,null,e),n=!1;break;case"enum":this._parseEnum(t,e),n=!1;break;case"option":if(!n)throw new Error("Illegal option definition at line "+this.tn.line+": Must be declared before the first message or enum");this._parseOption(t,e);break;case"service":this._parseService(t,e);break;case"extend":this._parseExtend(t,e);break;case"syntax":this._parseIgnoredStatement(t,e);break;default:throw new Error("Illegal top level declaration at line "+this.tn.line+": "+e)}return delete t.name,t},r.prototype._parseNumber=function(e){var n=1;if("-"==e.charAt(0)&&(n=-1,e=e.substring(1)),t.NUMBER_DEC.test(e))return n*parseInt(e,10);if(t.NUMBER_HEX.test(e))return n*parseInt(e.substring(2),16);if(t.NUMBER_OCT.test(e))return n*parseInt(e.substring(1),8);if(t.NUMBER_FLT.test(e))return n*parseFloat(e);throw new Error("Illegal number value at line "+this.tn.line+": "+(0>n?"-":"")+e)},r.prototype._parseId=function(e,n){var i=-1,r=1;if("-"==e.charAt(0)&&(r=-1,e=e.substring(1)),t.NUMBER_DEC.test(e))i=parseInt(e);else if(t.NUMBER_HEX.test(e))i=parseInt(e.substring(2),16);else{if(!t.NUMBER_OCT.test(e))throw new Error("Illegal ID value at line "+this.tn.line+": "+(0>r?"-":"")+e);i=parseInt(e.substring(1),8)}if(i=r*i|0,!n&&0>i)throw new Error("Illegal ID range at line "+this.tn.line+": "+(0>r?"-":"")+e);return i},r.prototype._parsePackage=function(e){if(e=this.tn.next(),!t.TYPEREF.test(e))throw new Error("Illegal package name at line "+this.tn.line+": "+e);var n=e;if(e=this.tn.next(),e!=t.END)throw new Error("Illegal end of package definition at line "+this.tn.line+": "+e+" ('"+t.END+"' expected)");return n},r.prototype._parseImport=function(e){if(e=this.tn.next(),"public"===e&&(e=this.tn.next()),e!==t.STRINGOPEN&&e!==t.STRINGOPEN_SQ)throw new Error("Illegal begin of import value at line "+this.tn.line+": "+e+" ('"+t.STRINGOPEN+"' or '"+t.STRINGOPEN_SQ+"' expected)");var n=this.tn.next();if(e=this.tn.next(),e!==this.tn.stringEndsWith)throw new Error("Illegal end of import value at line "+this.tn.line+": "+e+" ('"+this.tn.stringEndsWith+"' expected)");if(e=this.tn.next(),e!==t.END)throw new Error("Illegal end of import definition at line "+this.tn.line+": "+e+" ('"+t.END+"' expected)");return n},r.prototype._parseOption=function(e,n){n=this.tn.next();var i=!1;if(n==t.COPTOPEN&&(i=!0,n=this.tn.next()),!t.TYPEREF.test(n)&&!/google\.protobuf\./.test(n))throw new Error("Illegal option name in message "+e.name+" at line "+this.tn.line+": "+n);var r=n;if(n=this.tn.next(),i){if(n!==t.COPTCLOSE)throw new Error("Illegal custom option name delimiter in message "+e.name+", option "+r+" at line "+this.tn.line+": "+n+" ('"+t.COPTCLOSE+"' expected)");r="("+r+")",n=this.tn.next(),t.FQTYPEREF.test(n)&&(r+=n,n=this.tn.next())}if(n!==t.EQUAL)throw new Error("Illegal option operator in message "+e.name+", option "+r+" at line "+this.tn.line+": "+n+" ('"+t.EQUAL+"' expected)");var s;if(n=this.tn.next(),n===t.STRINGOPEN||n===t.STRINGOPEN_SQ){if(s=this.tn.next(),n=this.tn.next(),n!==this.tn.stringEndsWith)throw new Error("Illegal end of option value in message "+e.name+", option "+r+" at line "+this.tn.line+": "+n+" ('"+this.tn.stringEndsWith+"' expected)")}else if(t.NUMBER.test(n))s=this._parseNumber(n,!0);else{if(!t.TYPEREF.test(n))throw new Error("Illegal option value in message "+e.name+", option "+r+" at line "+this.tn.line+": "+n);s=n}if(n=this.tn.next(),n!==t.END)throw new Error("Illegal end of option in message "+e.name+", option "+r+" at line "+this.tn.line+": "+n+" ('"+t.END+"' expected)");e.options[r]=s},r.prototype._parseIgnoredStatement=function(e,n){for(var i;;){if(i=this.tn.next(),null===i)throw new Error("Unexpected EOF in "+e.name+", "+n+" (ignored) at line "+this.tn.line);if(i===t.END)break}},r.prototype._parseService=function(e){var n=this.tn.next();if(!t.NAME.test(n))throw new Error("Illegal service name at line "+this.tn.line+": "+n);var i=n,r={name:i,rpc:{},options:{}};if(n=this.tn.next(),n!==t.OPEN)throw new Error("Illegal OPEN after service "+i+" at line "+this.tn.line+": "+n+" ('"+t.OPEN+"' expected)");do if(n=this.tn.next(),"option"===n)this._parseOption(r,n);else if("rpc"===n)this._parseServiceRPC(r,n);else if(n!==t.CLOSE)throw new Error("Illegal type for service "+i+" at line "+this.tn.line+": "+n);while(n!==t.CLOSE);e.services.push(r)},r.prototype._parseServiceRPC=function(e,n){var i=n;if(n=this.tn.next(),!t.NAME.test(n))throw new Error("Illegal RPC method name in service "+e.name+" at line "+this.tn.line+": "+n);var r=n,s={request:null,response:null,options:{}};if(n=this.tn.next(),n!==t.COPTOPEN)throw new Error("Illegal start of request type in RPC service "+e.name+"#"+r+" at line "+this.tn.line+": "+n+" ('"+t.COPTOPEN+"' expected)");if(n=this.tn.next(),!t.TYPEREF.test(n))throw new Error("Illegal request type in RPC service "+e.name+"#"+r+" at line "+this.tn.line+": "+n);if(s.request=n,n=this.tn.next(),n!=t.COPTCLOSE)throw new Error("Illegal end of request type in RPC service "+e.name+"#"+r+" at line "+this.tn.line+": "+n+" ('"+t.COPTCLOSE+"' expected)");if(n=this.tn.next(),"returns"!==n.toLowerCase())throw new Error("Illegal request/response delimiter in RPC service "+e.name+"#"+r+" at line "+this.tn.line+": "+n+" ('returns' expected)");if(n=this.tn.next(),n!=t.COPTOPEN)throw new Error("Illegal start of response type in RPC service "+e.name+"#"+r+" at line "+this.tn.line+": "+n+" ('"+t.COPTOPEN+"' expected)");if(n=this.tn.next(),s.response=n,n=this.tn.next(),n!==t.COPTCLOSE)throw new Error("Illegal end of response type in RPC service "+e.name+"#"+r+" at line "+this.tn.line+": "+n+" ('"+t.COPTCLOSE+"' expected)");if(n=this.tn.next(),n===t.OPEN){do if(n=this.tn.next(),"option"===n)this._parseOption(s,n);else if(n!==t.CLOSE)throw new Error("Illegal start of option in RPC service "+e.name+"#"+r+" at line "+this.tn.line+": "+n+" ('option' expected)");while(n!==t.CLOSE);this.tn.peek()===t.END&&this.tn.next()}else if(n!==t.END)throw new Error("Illegal method delimiter in RPC service "+e.name+"#"+r+" at line "+this.tn.line+": "+n+" ('"+t.END+"' or '"+t.OPEN+"' expected)");"undefined"==typeof e[i]&&(e[i]={}),e[i][r]=s},r.prototype._parseMessage=function(e,n,i){var r={},s="group"===i;if(i=this.tn.next(),!t.NAME.test(i))throw new Error("Illegal "+(s?"group":"message")+" name"+(e?" in message "+e.name:"")+" at line "+this.tn.line+": "+i);if(r.name=i,s){if(i=this.tn.next(),i!==t.EQUAL)throw new Error("Illegal id assignment after group "+r.name+" at line "+this.tn.line+": "+i+" ('"+t.EQUAL+"' expected)");i=this.tn.next();try{n.id=this._parseId(i)}catch(o){throw new Error("Illegal field id value for group "+r.name+"#"+n.name+" at line "+this.tn.line+": "+i)}r.isGroup=!0}if(r.fields=[],r.enums=[],r.messages=[],r.options={},i=this.tn.next(),i===t.OPTOPEN&&n&&(this._parseFieldOptions(r,n,i),i=this.tn.next()),i!==t.OPEN)throw new Error("Illegal OPEN after "+(s?"group":"message")+" "+r.name+" at line "+this.tn.line+": "+i+" ('"+t.OPEN+"' expected)");for(;;){if(i=this.tn.next(),i===t.CLOSE){i=this.tn.peek(),i===t.END&&this.tn.next();break}if(t.RULE.test(i))this._parseMessageField(r,i);else if("enum"===i)this._parseEnum(r,i);else if("message"===i)this._parseMessage(r,null,i);else if("option"===i)this._parseOption(r,i);else if("extensions"===i)r.extensions=this._parseExtensions(r,i);else{if("extend"!==i)throw new Error("Illegal token in message "+r.name+" at line "+this.tn.line+": "+i+" (type or '"+t.CLOSE+"' expected)");this._parseExtend(r,i)}}return e.messages.push(r),r},r.prototype._parseMessageField=function(e,n){var i={},r=null;if(i.rule=n,i.options={},n=this.tn.next(),"group"===n){if(r=this._parseMessage(e,i,n),!/^[A-Z]/.test(r.name))throw new Error("Group names must start with a capital letter");i.type=r.name,i.name=r.name.toLowerCase(),n=this.tn.peek(),n===t.END&&this.tn.next()}else{if(!t.TYPE.test(n)&&!t.TYPEREF.test(n))throw new Error("Illegal field type in message "+e.name+" at line "+this.tn.line+": "+n);if(i.type=n,n=this.tn.next(),!t.NAME.test(n))throw new Error("Illegal field name in message "+e.name+" at line "+this.tn.line+": "+n);if(i.name=n,n=this.tn.next(),n!==t.EQUAL)throw new Error("Illegal field id assignment in message "+e.name+"#"+i.name+" at line "+this.tn.line+": "+n+" ('"+t.EQUAL+"' expected)");n=this.tn.next();try{i.id=this._parseId(n)}catch(s){throw new Error("Illegal field id value in message "+e.name+"#"+i.name+" at line "+this.tn.line+": "+n)}if(n=this.tn.next(),n===t.OPTOPEN&&(this._parseFieldOptions(e,i,n),n=this.tn.next()),n!==t.END)throw new Error("Illegal field delimiter in message "+e.name+"#"+i.name+" at line "+this.tn.line+": "+n+" ('"+t.END+"' expected)")}e.fields.push(i)},r.prototype._parseFieldOptions=function(e,n,i){for(var r=!0;;){if(i=this.tn.next(),i===t.OPTCLOSE)break;if(i===t.OPTEND){if(r)throw new Error("Illegal start of message field options in message "+e.name+"#"+n.name+" at line "+this.tn.line+": "+i);i=this.tn.next()}this._parseFieldOption(e,n,i),r=!1}},r.prototype._parseFieldOption=function(e,n,i){var r=!1;if(i===t.COPTOPEN&&(i=this.tn.next(),r=!0),!t.TYPEREF.test(i))throw new Error("Illegal field option in message "+e.name+"#"+n.name+" at line "+this.tn.line+": "+i);var s=i;if(i=this.tn.next(),r){if(i!==t.COPTCLOSE)throw new Error("Illegal custom field option name delimiter in message "+e.name+"#"+n.name+" at line "+this.tn.line+": "+i+" (')' expected)");s="("+s+")",i=this.tn.next(),t.FQTYPEREF.test(i)&&(s+=i,i=this.tn.next())}if(i!==t.EQUAL)throw new Error("Illegal field option operation in message "+e.name+"#"+n.name+" at line "+this.tn.line+": "+i+" ('=' expected)");var o;if(i=this.tn.next(),i===t.STRINGOPEN||i===t.STRINGOPEN_SQ){if(o=this.tn.next(),i=this.tn.next(),i!=this.tn.stringEndsWith)throw new Error("Illegal end of field value in message "+e.name+"#"+n.name+", option "+s+" at line "+this.tn.line+": "+i+" ('"+this.tn.stringEndsWith+"' expected)")}else if(t.NUMBER.test(i,!0))o=this._parseNumber(i,!0);else if(t.BOOL.test(i))o="true"===i.toLowerCase();else{if(!t.TYPEREF.test(i))throw new Error("Illegal field option value in message "+e.name+"#"+n.name+", option "+s+" at line "+this.tn.line+": "+i);o=i}n.options[s]=o},r.prototype._parseEnum=function(e,n){var i={};if(n=this.tn.next(),!t.NAME.test(n))throw new Error("Illegal enum name in message "+e.name+" at line "+this.tn.line+": "+n);if(i.name=n,n=this.tn.next(),n!==t.OPEN)throw new Error("Illegal OPEN after enum "+i.name+" at line "+this.tn.line+": "+n);for(i.values=[],i.options={};;){if(n=this.tn.next(),n===t.CLOSE){n=this.tn.peek(),n===t.END&&this.tn.next();break}if("option"==n)this._parseOption(i,n);else{if(!t.NAME.test(n))throw new Error("Illegal enum value name in enum "+i.name+" at line "+this.tn.line+": "+n);this._parseEnumValue(i,n)}}e.enums.push(i)},r.prototype._parseEnumValue=function(e,n){var i={};if(i.name=n,n=this.tn.next(),n!==t.EQUAL)throw new Error("Illegal enum value operator in enum "+e.name+" at line "+this.tn.line+": "+n+" ('"+t.EQUAL+"' expected)");n=this.tn.next();try{i.id=this._parseId(n,!0)}catch(r){throw new Error("Illegal enum value id in enum "+e.name+" at line "+this.tn.line+": "+n)}if(e.values.push(i),n=this.tn.next(),n===t.OPTOPEN){var s={options:{}};this._parseFieldOptions(e,s,n),n=this.tn.next()}if(n!==t.END)throw new Error("Illegal enum value delimiter in enum "+e.name+" at line "+this.tn.line+": "+n+" ('"+t.END+"' expected)")},r.prototype._parseExtensions=function(n,i){var r=[];if(i=this.tn.next(),r.push("min"===i?e.ID_MIN:"max"===i?e.ID_MAX:this._parseNumber(i)),i=this.tn.next(),"to"!==i)throw"Illegal extensions delimiter in message "+n.name+" at line "+this.tn.line+" ('to' expected)";if(i=this.tn.next(),r.push("min"===i?e.ID_MIN:"max"===i?e.ID_MAX:this._parseNumber(i)),i=this.tn.next(),i!==t.END)throw new Error("Illegal extension delimiter in message "+n.name+" at line "+this.tn.line+": "+i+" ('"+t.END+"' expected)");return r},r.prototype._parseExtend=function(e,n){if(n=this.tn.next(),!t.TYPEREF.test(n))throw new Error("Illegal extended message name at line "+this.tn.line+": "+n);var i={};if(i.ref=n,i.fields=[],n=this.tn.next(),n!==t.OPEN)throw new Error("Illegal OPEN in extend "+i.name+" at line "+this.tn.line+": "+n+" ('"+t.OPEN+"' expected)");for(;;){if(n=this.tn.next(),n===t.CLOSE){n=this.tn.peek(),n==t.END&&this.tn.next();break}if(!t.RULE.test(n))throw new Error("Illegal token in extend "+i.name+" at line "+this.tn.line+": "+n+" (rule or '"+t.CLOSE+"' expected)");this._parseMessageField(i,n)}return e.messages.push(i),i},r.prototype.toString=function(){return"Parser"},n.Parser=r,n}(t,t.Lang),t.Reflect=function(t){function n(e,i){var r=i.readVarint32(),s=7&r,o=r>>3;switch(s){case t.WIRE_TYPES.VARINT:do r=i.readUint8();while(128===(128&r));break;case t.WIRE_TYPES.BITS64:i.offset+=8;break;case t.WIRE_TYPES.LDELIM:r=i.readVarint32(),i.offset+=r;break;case t.WIRE_TYPES.STARTGROUP:n(o,i);break;case t.WIRE_TYPES.ENDGROUP:if(o===e)return!1;throw new Error("Illegal GROUPEND after unknown group: "+o+" ("+e+" expected)");case t.WIRE_TYPES.BITS32:i.offset+=4;break;default:throw new Error("Illegal wire type in unknown group "+e+": "+s)}return!0}function i(e,n){if(e&&"number"==typeof e.low&&"number"==typeof e.high&&"boolean"==typeof e.unsigned&&e.low===e.low&&e.high===e.high)return new t.Long(e.low,e.high,"undefined"==typeof n?e.unsigned:n);if("string"==typeof e)return t.Long.fromString(e,n||!1,10);if("number"==typeof e)return t.Long.fromNumber(e,n||!1);throw new Error("not convertible to Long")}var r={},s=function(e,t){this.parent=e,this.name=t,this.className};s.prototype.fqn=function(){for(var e=this.name,t=this;;){if(t=t.parent,null==t)break;e=t.name+"."+e}return e},s.prototype.toString=function(e){var t=e?this.className+" ":"";return t+this.fqn()},s.prototype.build=function(){throw new Error(this.toString(!0)+" cannot be built directly")},r.T=s;var o=function(e,t,n){s.call(this,e,t),this.className="Namespace",this.children=[],this.options=n||{}};o.prototype=Object.create(s.prototype),o.prototype.getChildren=function(e){if(e=e||null,null==e)return this.children.slice();for(var t=[],n=0;n<this.children.length;n++)this.children[n]instanceof e&&t.push(this.children[n]);return t},o.prototype.addChild=function(e){var t;if(t=this.getChild(e.name))if(t instanceof a.Field&&t.name!==t.originalName&&!this.hasChild(t.originalName))t.name=t.originalName;else{if(!(e instanceof a.Field&&e.name!==e.originalName)||this.hasChild(e.originalName))throw new Error("Duplicate name in namespace "+this.toString(!0)+": "+e.name);e.name=e.originalName}this.children.push(e)},o.prototype.hasChild=function(e){return this._indexOf(e)>-1},o.prototype.getChild=function(e){var t=this._indexOf(e);return t>-1?this.children[t]:null},o.prototype._indexOf=function(e){for(var t="number"==typeof e?"id":"name",n=0;n<this.children.length;n++)if("undefined"!=typeof this.children[n][t]&&this.children[n][t]==e)return n;return-1},o.prototype.resolve=function(e,t){var n=e.split("."),i=this,s=0;if(""==n[s]){for(;null!=i.parent;)i=i.parent;s++}var o;do{do{if(o=i.getChild(n[s]),!o||!(o instanceof r.T)||t&&o instanceof r.Message.Field){i=null;break}i=o,s++}while(s<n.length);if(null!=i)break;if(null!==this.parent)return this.parent.resolve(e,t)}while(null!=i);return i},o.prototype.build=function(){for(var e,t={},n=this.getChildren(),i=0;i<n.length;i++)e=n[i],e instanceof o&&(t[e.name]=e.build());return Object.defineProperty&&Object.defineProperty(t,"$options",{value:this.buildOpt(),enumerable:!1,configurable:!1,writable:!1}),t},o.prototype.buildOpt=function(){for(var e={},t=Object.keys(this.options),n=0;n<t.length;n++){var i=t[n],r=this.options[t[n]];e[i]=r}return e},o.prototype.getOption=function(e){return"undefined"==typeof e?this.options:"undefined"!=typeof this.options[e]?this.options[e]:null},r.Namespace=o;var a=function(e,n,i,r){o.call(this,e,n,i),this.className="Message",this.extensions=[t.ID_MIN,t.ID_MAX],this.clazz=null,this.isGroup=!!r};a.prototype=Object.create(o.prototype),a.prototype.build=function(n){if(this.clazz&&!n)return this.clazz;for(var i=function(t,n){function i(t,n){var r={};for(var s in t)t.hasOwnProperty(s)&&(null===t[s]||"object"!=typeof t[s]?r[s]=t[s]:t[s]instanceof e?n&&(r[s]=t.toBuffer()):r[s]=i(t[s],n));return r}var r=n.getChildren(t.Reflect.Message.Field),s=function(n){t.Builder.Message.call(this);var i,s;for(i=0;i<r.length;i++)s=r[i],this[s.name]=s.repeated?[]:null;for(i=0;i<r.length;i++)if(s=r[i],"undefined"!=typeof s.options["default"])try{this.$set(s.name,s.options["default"])}catch(o){throw new Error("[INTERNAL] "+o)}if(1!=arguments.length||"object"!=typeof n||"function"==typeof n.encode||t.Util.isArray(n)||n instanceof e||n instanceof ArrayBuffer||t.Long&&n instanceof t.Long)for(i=0;i<arguments.length;i++)i<r.length&&this.$set(r[i].name,arguments[i]);else{var a=Object.keys(n);for(i=0;i<a.length;i++)this.$set(a[i],n[a[i]])}};s.prototype=Object.create(t.Builder.Message.prototype),s.prototype.add=function(e,i,r){var s=n.getChild(e);if(!s)throw new Error(this+"#"+e+" is undefined");if(!(s instanceof t.Reflect.Message.Field))throw new Error(this+"#"+e+" is not a field: "+s.toString(!0));if(!s.repeated)throw new Error(this+"#"+e+" is not a repeated field");null===this[s.name]&&(this[s.name]=[]),this[s.name].push(r?i:s.verifyValue(i,!0))},s.prototype.$add=s.prototype.add,s.prototype.set=function(e,i,r){var s=n.getChild(e);if(!s)throw new Error(this+"#"+e+" is not a field: undefined");if(!(s instanceof t.Reflect.Message.Field))throw new Error(this+"#"+e+" is not a field: "+s.toString(!0));this[s.name]=r?i:s.verifyValue(i)},s.prototype.$set=s.prototype.set,s.prototype.get=function(e){var i=n.getChild(e);if(!(i&&i instanceof t.Reflect.Message.Field))throw new Error(this+"#"+e+" is not a field: undefined");if(!(i instanceof t.Reflect.Message.Field))throw new Error(this+"#"+e+" is not a field: "+i.toString(!0));return this[i.name]},s.prototype.$get=s.prototype.get;for(var o=0;o<r.length;o++){var a=r[o];!function(e){var t=e.originalName.replace(/(_[a-zA-Z])/g,function(e){return e.toUpperCase().replace("_","")});t=t.substring(0,1).toUpperCase()+t.substring(1);var i=e.originalName.replace(/([A-Z])/g,function(e){return"_"+e});n.hasChild("set"+t)||(s.prototype["set"+t]=function(t){this.$set(e.name,t)}),n.hasChild("set_"+i)||(s.prototype["set_"+i]=function(t){this.$set(e.name,t)}),n.hasChild("get"+t)||(s.prototype["get"+t]=function(){return this.$get(e.name)}),n.hasChild("get_"+i)||(s.prototype["get_"+i]=function(){return this.$get(e.name)})}(a)}s.prototype.encode=function(t){var i=!1;t||(t=new e,i=!0);var r=t.littleEndian;try{return n.encode(this,t.LE()),(i?t.flip():t).LE(r)}catch(s){throw t.LE(r),s}},s.prototype.encodeDelimited=function(t){var i=!1;t||(t=new e,i=!0);try{var r=(new e).LE();return n.encode(this,r).flip(),t.writeVarint32(r.remaining()),t.append(r),i?t.flip():t}catch(s){throw s}},s.prototype.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toArrayBuffer()),e}},s.prototype.toArrayBuffer=s.prototype.encodeAB,s.prototype.encodeNB=function(){try{return this.encode().toBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBuffer()),e}},s.prototype.toBuffer=s.prototype.encodeNB,s.prototype.encode64=function(){try{return this.encode().toBase64()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBase64()),e}},s.prototype.toBase64=s.prototype.encode64,s.prototype.encodeHex=function(){try{return this.encode().toHex()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toHex()),e}},s.prototype.toHex=s.prototype.encodeHex,s.prototype.toRaw=function(e){return i(this,!!e)},s.decode=function(t,i){if(null===t)throw new Error("buffer must not be null");"string"==typeof t&&(t=e.wrap(t,i?i:"base64")),t=t instanceof e?t:e.wrap(t);var r=t.littleEndian;try{var s=n.decode(t.LE());return t.LE(r),s}catch(o){throw t.LE(r),o}},s.decodeDelimited=function(t,i){if(null===t)throw new Error("buffer must not be null");"string"==typeof t&&(t=e.wrap(t,i?i:"base64")),t=t instanceof e?t:e.wrap(t);var r=t.readVarint32(),s=n.decode(t.slice(t.offset,t.offset+r).LE());return t.offset+=r,s},s.decode64=function(e){return s.decode(e,"base64")},s.decodeHex=function(e){return s.decode(e,"hex")},s.prototype.toString=function(){return n.toString()};return Object.defineProperty&&Object.defineProperty(s,"$options",{value:n.buildOpt(),enumerable:!1,configurable:!1,writable:!1}),s}(t,this),r=this.getChildren(),s=0;s<r.length;s++)if(r[s]instanceof f)i[r[s].name]=r[s].build();else if(r[s]instanceof a)i[r[s].name]=r[s].build();else if(!(r[s]instanceof a.Field))throw new Error("Illegal reflect child of "+this.toString(!0)+": "+r[s].toString(!0));return this.clazz=i},a.prototype.encode=function(e,t){for(var n=this.getChildren(a.Field),i=null,r=0;r<n.length;r++){var s=e.$get(n[r].name);n[r].required&&null===s?null===i&&(i=n[r]):n[r].encode(s,t)}if(null!==i){var o=new Error("Missing at least one required field for "+this.toString(!0)+": "+i);throw o.encoded=t,o}return t},a.prototype.decode=function(e,i,r){i="number"==typeof i?i:-1;for(var s,o,a,l=e.offset,f=new this.clazz;e.offset<l+i||-1==i&&e.remaining()>0;){if(s=e.readVarint32(),o=7&s,a=s>>3,o===t.WIRE_TYPES.ENDGROUP){if(a!==r)throw new Error("Illegal group end indicator for "+this.toString(!0)+": "+a+" ("+(r?r+" expected":"not a group")+")");break}var p=this.getChild(a);if(p)p.repeated&&!p.options.packed?f.$add(p.name,p.decode(o,e),!0):f.$set(p.name,p.decode(o,e),!0);else switch(o){case t.WIRE_TYPES.VARINT:e.readVarint32();break;case t.WIRE_TYPES.BITS32:e.offset+=4;break;case t.WIRE_TYPES.BITS64:e.offset+=8;break;case t.WIRE_TYPES.LDELIM:var h=e.readVarint32();e.offset+=h;break;case t.WIRE_TYPES.STARTGROUP:for(;n(a,e););break;default:throw new Error("Illegal wire type for unknown field "+a+" in "+this.toString(!0)+"#decode: "+o)}}for(var u=this.getChildren(t.Reflect.Field),d=0;d<u.length;d++)if(u[d].required&&null===f[u[d].name]){var c=new Error("Missing at least one required field for "+this.toString(!0)+": "+u[d].name);throw c.decoded=f,c}return f},r.Message=a;var l=function(e,n,i,r,o,a){s.call(this,e,r),this.className="Message.Field",this.required="required"==n,this.repeated="repeated"==n,this.type=i,this.resolvedType=null,this.id=o,this.options=a||{},this.originalName=this.name,t.convertFieldsToCamelCase&&(this.name=this.name.replace(/_([a-zA-Z])/g,function(e,t){return t.toUpperCase()}))};l.prototype=Object.create(s.prototype),l.prototype.verifyValue=function(n,r){r=r||!1;var s=function(e,t){throw new Error("Illegal value for "+this.toString(!0)+": "+e+" ("+t+")")}.bind(this);if(null===n)return this.required&&s(typeof n,"required"),null;var o;if(this.repeated&&!r){t.Util.isArray(n)||(n=[n]);var a=[];for(o=0;o<n.length;o++)a.push(this.verifyValue(n[o],!0));return a}switch(!this.repeated&&t.Util.isArray(n)&&s(typeof n,"no array expected"),this.type){case t.TYPES.int32:case t.TYPES.sint32:case t.TYPES.sfixed32:return("number"!=typeof n||n===n&&n%1!==0)&&s(typeof n,"not an integer"),n>4294967295?0|n:n;case t.TYPES.uint32:case t.TYPES.fixed32:return("number"!=typeof n||n===n&&n%1!==0)&&s(typeof n,"not an integer"),0>n?n>>>0:n;case t.TYPES.int64:case t.TYPES.sint64:case t.TYPES.sfixed64:if(t.Long)try{return i(n,!1)}catch(l){s(typeof n,l.message)}case t.TYPES.uint64:case t.TYPES.fixed64:if(t.Long)try{return i(n,!0)}catch(l){s(typeof n,l.message)}case t.TYPES.bool:return"boolean"!=typeof n&&s(typeof n,"not a boolean"),n;case t.TYPES["float"]:case t.TYPES["double"]:return"number"!=typeof n&&s(typeof n,"not a number"),n;case t.TYPES.string:return"string"==typeof n||n&&n instanceof String||s(typeof n,"not a string"),""+n;case t.TYPES.bytes:return n&&n instanceof e?n:e.wrap(n);case t.TYPES["enum"]:var p=this.resolvedType.getChildren(f.Value);for(o=0;o<p.length;o++){if(p[o].name==n)return p[o].id;if(p[o].id==n)return p[o].id}s(n,"not a valid enum value");case t.TYPES.group:case t.TYPES.message:return n&&"object"==typeof n||s(typeof n,"object expected"),n instanceof this.resolvedType.clazz?n:new this.resolvedType.clazz(n)}throw new Error("[INTERNAL] Illegal value for "+this.toString(!0)+": "+n+" (undefined type "+this.type+")")},l.prototype.encode=function(n,i){if(n=this.verifyValue(n),null===this.type||"object"!=typeof this.type)throw new Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===n||this.repeated&&0==n.length)return i;try{if(this.repeated){var r;if(this.options.packed&&t.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){i.writeVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),i.ensureCapacity(i.offset+=1);var s=i.offset;for(r=0;r<n.length;r++)this.encodeValue(n[r],i);var o=i.offset-s,a=e.calculateVarint32(o);if(a>1){var l=i.slice(s,i.offset);s+=a-1,i.offset=s,i.append(l)}i.writeVarint32(o,s-a)}else for(r=0;r<n.length;r++)i.writeVarint32(this.id<<3|this.type.wireType),this.encodeValue(n[r],i)}else i.writeVarint32(this.id<<3|this.type.wireType),this.encodeValue(n,i)}catch(f){throw new Error("Illegal value for "+this.toString(!0)+": "+n+" ("+f+")")}return i},l.prototype.encodeValue=function(n,i){if(null!==n){switch(this.type){case t.TYPES.int32:0>n?i.writeVarint64(n):i.writeVarint32(n);break;case t.TYPES.uint32:i.writeVarint32(n);break;case t.TYPES.sint32:i.writeVarint32ZigZag(n);break;case t.TYPES.fixed32:i.writeUint32(n);break;case t.TYPES.sfixed32:i.writeInt32(n);break;case t.TYPES.int64:case t.TYPES.uint64:i.writeVarint64(n);
break;case t.TYPES.sint64:i.writeVarint64ZigZag(n);break;case t.TYPES.fixed64:i.writeUint64(n);break;case t.TYPES.sfixed64:i.writeInt64(n);break;case t.TYPES.bool:i.writeVarint32("string"==typeof n?"false"===n.toLowerCase()?0:!!n:n?1:0);break;case t.TYPES["enum"]:i.writeVarint32(n);break;case t.TYPES["float"]:i.writeFloat32(n);break;case t.TYPES["double"]:i.writeFloat64(n);break;case t.TYPES.string:i.writeVString(n);break;case t.TYPES.bytes:n.offset>n.length&&(i=i.clone().flip());var r=n.offset;i.writeVarint32(n.remaining()),i.append(n),n.offset=r;break;case t.TYPES.message:var s=(new e).LE();this.resolvedType.encode(n,s),i.writeVarint32(s.offset),i.append(s.flip());break;case t.TYPES.group:this.resolvedType.encode(n,i),i.writeVarint32(this.id<<3|t.WIRE_TYPES.ENDGROUP);break;default:throw new Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+n+" (unknown type)")}return i}},l.prototype.decode=function(e,n,i){var r,s;if(e!=this.type.wireType&&(i||e!=t.WIRE_TYPES.LDELIM||!this.repeated))throw new Error("Illegal wire type for field "+this.toString(!0)+": "+e+" ("+this.type.wireType+" expected)");if(e==t.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&!i){s=n.readVarint32(),s=n.offset+s;for(var o=[];n.offset<s;)o.push(this.decode(this.type.wireType,n,!0));return o}switch(this.type){case t.TYPES.int32:return 0|n.readVarint32();case t.TYPES.uint32:return n.readVarint32()>>>0;case t.TYPES.sint32:return 0|n.readVarint32ZigZag();case t.TYPES.fixed32:return n.readUint32()>>>0;case t.TYPES.sfixed32:return 0|n.readInt32();case t.TYPES.int64:return n.readVarint64();case t.TYPES.uint64:return n.readVarint64().toUnsigned();case t.TYPES.sint64:return n.readVarint64ZigZag();case t.TYPES.fixed64:return n.readUint64();case t.TYPES.sfixed64:return n.readInt64();case t.TYPES.bool:return!!n.readVarint32();case t.TYPES["enum"]:return n.readVarint32();case t.TYPES["float"]:return n.readFloat();case t.TYPES["double"]:return n.readDouble();case t.TYPES.string:return n.readVString();case t.TYPES.bytes:if(s=n.readVarint32(),n.remaining()<s)throw new Error("Illegal number of bytes for "+this.toString(!0)+": "+s+" required but got only "+n.remaining());return r=n.clone(),r.limit=r.offset+s,n.offset+=s,r;case t.TYPES.message:return s=n.readVarint32(),this.resolvedType.decode(n,s);case t.TYPES.group:return this.resolvedType.decode(n,-1,this.id)}throw new Error("[INTERNAL] Illegal wire type for "+this.toString(!0)+": "+e)},r.Message.Field=l;var f=function(e,t,n){o.call(this,e,t,n),this.className="Enum",this.object=null};f.prototype=Object.create(o.prototype),f.prototype.build=function(){for(var e={},t=this.getChildren(f.Value),n=0;n<t.length;n++)e[t[n].name]=t[n].id;return Object.defineProperty&&Object.defineProperty(e,"$options",{value:this.buildOpt(),enumerable:!1,configurable:!1,writable:!1}),this.object=e},r.Enum=f;var p=function(e,t,n){s.call(this,e,t),this.className="Enum.Value",this.id=n};p.prototype=Object.create(s.prototype),r.Enum.Value=p;var h=function(e,t,n){o.call(this,e,t,n),this.className="Service",this.clazz=null};h.prototype=Object.create(o.prototype),h.prototype.build=function(e){return this.clazz&&!e?this.clazz:this.clazz=function(e,t){var n=function(t){e.Builder.Service.call(this),this.rpcImpl=t||function(e,t,n){setTimeout(n.bind(this,new Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}};n.prototype=Object.create(e.Builder.Service.prototype),Object.defineProperty&&(Object.defineProperty(n,"$options",{value:t.buildOpt(),enumerable:!1,configurable:!1,writable:!1}),Object.defineProperty(n.prototype,"$options",{value:n.$options,enumerable:!1,configurable:!1,writable:!1}));for(var i=t.getChildren(e.Reflect.Service.RPCMethod),r=0;r<i.length;r++)!function(e){n.prototype[e.name]=function(n,i){try{n&&n instanceof e.resolvedRequestType.clazz||setTimeout(i.bind(this,new Error("Illegal request type provided to service method "+t.name+"#"+e.name)),0),this.rpcImpl(e.fqn(),n,function(n,r){if(n)return void i(n);try{r=e.resolvedResponseType.clazz.decode(r)}catch(s){}return r&&r instanceof e.resolvedResponseType.clazz?void i(null,r):void i(new Error("Illegal response type received in service method "+t.name+"#"+e.name))})}catch(r){setTimeout(i.bind(this,r),0)}},n[e.name]=function(t,i,r){new n(t)[e.name](i,r)},Object.defineProperty&&(Object.defineProperty(n[e.name],"$options",{value:e.buildOpt(),enumerable:!1,configurable:!1,writable:!1}),Object.defineProperty(n.prototype[e.name],"$options",{value:n[e.name].$options,enumerable:!1,configurable:!1,writable:!1}))}(i[r]);return n}(t,this)},r.Service=h;var u=function(e,t,n){s.call(this,e,t),this.className="Service.Method",this.options=n||{}};u.prototype=Object.create(s.prototype),u.prototype.buildOpt=o.prototype.buildOpt,r.Service.Method=u;var d=function(e,t,n,i,r){u.call(this,e,t,r),this.className="Service.RPCMethod",this.requestName=n,this.responseName=i,this.resolvedRequestType=null,this.resolvedResponseType=null};return d.prototype=Object.create(u.prototype),r.Service.RPCMethod=d,r}(t),t.Builder=function(e,t,n){var i=function(){this.ns=new n.Namespace(null,""),this.ptr=this.ns,this.resolved=!1,this.result=null,this.files={},this.importRoot=null};return i.prototype.reset=function(){this.ptr=this.ns},i.prototype.define=function(e,i){if("string"!=typeof e||!t.TYPEREF.test(e))throw new Error("Illegal package name: "+e);var r,s=e.split(".");for(r=0;r<s.length;r++)if(!t.NAME.test(s[r]))throw new Error("Illegal package name: "+s[r]);for(r=0;r<s.length;r++)this.ptr.hasChild(s[r])||this.ptr.addChild(new n.Namespace(this.ptr,s[r],i)),this.ptr=this.ptr.getChild(s[r]);return this},i.isValidMessage=function(n){if("string"!=typeof n.name||!t.NAME.test(n.name))return!1;if("undefined"!=typeof n.values||"undefined"!=typeof n.rpc)return!1;var r;if("undefined"!=typeof n.fields){if(!e.Util.isArray(n.fields))return!1;var s,o=[];for(r=0;r<n.fields.length;r++){if(!i.isValidMessageField(n.fields[r]))return!1;if(s=parseInt(n.fields[r].id,10),o.indexOf(s)>=0)return!1;o.push(s)}o=null}if("undefined"!=typeof n.enums){if(!e.Util.isArray(n.enums))return!1;for(r=0;r<n.enums.length;r++)if(!i.isValidEnum(n.enums[r]))return!1}if("undefined"!=typeof n.messages){if(!e.Util.isArray(n.messages))return!1;for(r=0;r<n.messages.length;r++)if(!i.isValidMessage(n.messages[r])&&!i.isValidExtend(n.messages[r]))return!1}return"undefined"==typeof n.extensions||e.Util.isArray(n.extensions)&&2===n.extensions.length&&"number"==typeof n.extensions[0]&&"number"==typeof n.extensions[1]?!0:!1},i.isValidMessageField=function(e){if("string"!=typeof e.rule||"string"!=typeof e.name||"string"!=typeof e.type||"undefined"==typeof e.id)return!1;if(!(t.RULE.test(e.rule)&&t.NAME.test(e.name)&&t.TYPEREF.test(e.type)&&t.ID.test(""+e.id)))return!1;if("undefined"!=typeof e.options){if("object"!=typeof e.options)return!1;for(var n,i=Object.keys(e.options),r=0;r<i.length;r++)if("string"!=typeof(n=i[r])||"string"!=typeof e.options[n]&&"number"!=typeof e.options[n]&&"boolean"!=typeof e.options[n])return!1}return!0},i.isValidEnum=function(n){if("string"!=typeof n.name||!t.NAME.test(n.name))return!1;if("undefined"==typeof n.values||!e.Util.isArray(n.values)||0==n.values.length)return!1;for(var i=0;i<n.values.length;i++){if("object"!=typeof n.values[i])return!1;if("string"!=typeof n.values[i].name||"undefined"==typeof n.values[i].id)return!1;if(!t.NAME.test(n.values[i].name)||!t.NEGID.test(""+n.values[i].id))return!1}return!0},i.prototype.create=function(t){if(t&&(e.Util.isArray(t)||(t=[t]),0!=t.length)){var r,s,o,a,l,f=[];for(f.push(t);f.length>0;){if(t=f.pop(),!e.Util.isArray(t))throw new Error("Not a valid namespace definition: "+JSON.stringify(t));for(;t.length>0;){if(r=t.shift(),i.isValidMessage(r)){if(s=new n.Message(this.ptr,r.name,r.options,r.isGroup),r.fields&&r.fields.length>0)for(a=0;a<r.fields.length;a++){if(s.hasChild(r.fields[a].id))throw new Error("Duplicate field id in message "+s.name+": "+r.fields[a].id);if(r.fields[a].options){for(o=Object.keys(r.fields[a].options),l=0;l<o.length;l++){if("string"!=typeof o[l])throw new Error("Illegal field option name in message "+s.name+"#"+r.fields[a].name+": "+o[l]);if("string"!=typeof r.fields[a].options[o[l]]&&"number"!=typeof r.fields[a].options[o[l]]&&"boolean"!=typeof r.fields[a].options[o[l]])throw new Error("Illegal field option value in message "+s.name+"#"+r.fields[a].name+"#"+o[l]+": "+r.fields[a].options[o[l]])}o=null}s.addChild(new n.Message.Field(s,r.fields[a].rule,r.fields[a].type,r.fields[a].name,r.fields[a].id,r.fields[a].options))}if(o=[],"undefined"!=typeof r.enums&&r.enums.length>0)for(a=0;a<r.enums.length;a++)o.push(r.enums[a]);if(r.messages&&r.messages.length>0)for(a=0;a<r.messages.length;a++)o.push(r.messages[a]);if(r.extensions&&(s.extensions=r.extensions,s.extensions[0]<e.ID_MIN&&(s.extensions[0]=e.ID_MIN),s.extensions[1]>e.ID_MAX&&(s.extensions[1]=e.ID_MAX)),this.ptr.addChild(s),o.length>0){f.push(t),t=o,o=null,this.ptr=s,s=null;continue}o=null,s=null}else if(i.isValidEnum(r)){for(s=new n.Enum(this.ptr,r.name,r.options),a=0;a<r.values.length;a++)s.addChild(new n.Enum.Value(s,r.values[a].name,r.values[a].id));this.ptr.addChild(s),s=null}else if(i.isValidService(r)){s=new n.Service(this.ptr,r.name,r.options);for(a in r.rpc)r.rpc.hasOwnProperty(a)&&s.addChild(new n.Service.RPCMethod(s,a,r.rpc[a].request,r.rpc[a].response,r.rpc[a].options));this.ptr.addChild(s),s=null}else{if(!i.isValidExtend(r))throw new Error("Not a valid message, enum, service or extend definition: "+JSON.stringify(r));if(s=this.ptr.resolve(r.ref))for(a=0;a<r.fields.length;a++){if(s.hasChild(r.fields[a].id))throw new Error("Duplicate extended field id in message "+s.name+": "+r.fields[a].id);if(r.fields[a].id<s.extensions[0]||r.fields[a].id>s.extensions[1])throw new Error("Illegal extended field id in message "+s.name+": "+r.fields[a].id+" ("+s.extensions.join(" to ")+" expected)");s.addChild(new n.Message.Field(s,r.fields[a].rule,r.fields[a].type,r.fields[a].name,r.fields[a].id,r.fields[a].options))}else if(!/\.?google\.protobuf\./.test(r.ref))throw new Error("Extended message "+r.ref+" is not defined")}r=null}t=null,this.ptr=this.ptr.parent}return this.resolved=!1,this.result=null,this}},i.isValidImport=function(e){return!/google\/protobuf\//.test(e)},i.prototype["import"]=function(t,n){if("string"==typeof n){if(e.Util.IS_NODE){var r=require("path");n=r.resolve(n)}if(this.files[n])return this.reset(),this;this.files[n]=!0}if(t.imports&&t.imports.length>0){var s,o="/",a=!1;"object"==typeof n?(this.importRoot=n.root,a=!0,s=this.importRoot,n=n.file,(s.indexOf("\\")>=0||n.indexOf("\\")>=0)&&(o="\\")):"string"==typeof n?this.importRoot?s=this.importRoot:n.indexOf("/")>=0?(s=n.replace(/\/[^\/]*$/,""),""===s&&(s="/")):n.indexOf("\\")>=0?(s=n.replace(/\\[^\\]*$/,""),o="\\"):s=".":s=null;for(var l=0;l<t.imports.length;l++)if("string"==typeof t.imports[l]){if(!s)throw new Error("Cannot determine import root: File name is unknown");var f=s+o+t.imports[l];if(!i.isValidImport(f))continue;/\.proto$/i.test(f)&&!e.DotProto&&(f=f.replace(/\.proto$/,".json"));var p=e.Util.fetch(f);if(null===p)throw new Error("Failed to import '"+f+"' in '"+n+"': File not found");/\.json$/i.test(f)?this["import"](JSON.parse(p+""),f):this["import"](new e.DotProto.Parser(p+"").parse(),f)}else n?/\.(\w+)$/.test(n)?this["import"](t.imports[l],n.replace(/^(.+)\.(\w+)$/,function(e,t,n){return t+"_import"+l+"."+n})):this["import"](t.imports[l],n+"_import"+l):this["import"](t.imports[l]);a&&(this.importRoot=null)}return t.messages&&(t["package"]&&this.define(t["package"],t.options),this.create(t.messages),this.reset()),t.enums&&(t["package"]&&this.define(t["package"],t.options),this.create(t.enums),this.reset()),t.services&&(t["package"]&&this.define(t["package"],t.options),this.create(t.services),this.reset()),t["extends"]&&(t["package"]&&this.define(t["package"],t.options),this.create(t["extends"]),this.reset()),this},i.isValidService=function(e){return!("string"!=typeof e.name||!t.NAME.test(e.name)||"object"!=typeof e.rpc)},i.isValidExtend=function(n){if("string"!=typeof n.ref||!t.TYPEREF.test(n.name))return!1;var r;if("undefined"!=typeof n.fields){if(!e.Util.isArray(n.fields))return!1;var s,o=[];for(r=0;r<n.fields.length;r++){if(!i.isValidMessageField(n.fields[r]))return!1;if(s=parseInt(n.id,10),o.indexOf(s)>=0)return!1;o.push(s)}o=null}return!0},i.prototype.resolveAll=function(){var i;if(null!=this.ptr&&"object"!=typeof this.ptr.type){if(this.ptr instanceof n.Namespace)for(var r=this.ptr.getChildren(),s=0;s<r.length;s++)this.ptr=r[s],this.resolveAll();else if(this.ptr instanceof n.Message.Field)if(t.TYPE.test(this.ptr.type))this.ptr.type=e.TYPES[this.ptr.type];else{if(!t.TYPEREF.test(this.ptr.type))throw new Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(i=this.ptr.parent.resolve(this.ptr.type,!0),!i)throw new Error("Unresolvable type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(this.ptr.resolvedType=i,i instanceof n.Enum)this.ptr.type=e.TYPES["enum"];else{if(!(i instanceof n.Message))throw new Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);this.ptr.type=i.isGroup?e.TYPES.group:e.TYPES.message}}else if(this.ptr instanceof e.Reflect.Enum.Value);else{if(!(this.ptr instanceof e.Reflect.Service.Method))throw new Error("Illegal object type in namespace: "+typeof this.ptr+":"+this.ptr);if(!(this.ptr instanceof e.Reflect.Service.RPCMethod))throw new Error("Illegal service method type in "+this.ptr.toString(!0));if(i=this.ptr.parent.resolve(this.ptr.requestName),!(i&&i instanceof e.Reflect.Message))throw new Error("Illegal request type reference in "+this.ptr.toString(!0)+": "+this.ptr.requestName);if(this.ptr.resolvedRequestType=i,i=this.ptr.parent.resolve(this.ptr.responseName),!(i&&i instanceof e.Reflect.Message))throw new Error("Illegal response type reference in "+this.ptr.toString(!0)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=i}this.reset()}},i.prototype.build=function(e){if(this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),null==this.result&&(this.result=this.ns.build()),e){for(var t=e.split("."),n=this.result,i=0;i<t.length;i++){if(!n[t[i]]){n=null;break}n=n[t[i]]}return n}return this.result},i.prototype.lookup=function(e){return e?this.ns.resolve(e):this.ns},i.prototype.toString=function(){return"Builder"},i.Message=function(){},i.Service=function(){},i}(t,t.Lang,t.Reflect),t.loadProto=function(e,n,i){return("string"==typeof n||n&&"string"==typeof n.file&&"string"==typeof n.root)&&(i=n,n=null),t.loadJson(new t.DotProto.Parser(e+"").parse(),n,i)},t.protoFromString=t.loadProto,t.loadProtoFile=function(e,n,i){if(n&&"object"==typeof n?(i=n,n=null):n&&"function"==typeof n||(n=null),!n){var r=t.Util.fetch("object"==typeof e?e.root+"/"+e.file:e);return null!==r?t.protoFromString(r,i,e):null}t.Util.fetch("object"==typeof e?e.root+"/"+e.file:e,function(r){n(t.loadProto(r,i,e))})},t.protoFromFile=t.loadProtoFile,t.newBuilder=function(e,n){var i=new t.Builder;return"undefined"!=typeof e&&null!==e&&i.define(e,n),i},t.loadJson=function(e,n,i){return("string"==typeof n||n&&"string"==typeof n.file&&"string"==typeof n.root)&&(i=n,n=null),n&&"object"==typeof n||(n=t.newBuilder()),"string"==typeof e&&(e=JSON.parse(e)),n["import"](e,i),n.resolveAll(),n.build(),n},t.loadJsonFile=function(e,n,i){if(n&&"object"==typeof n?(i=n,n=null):n&&"function"==typeof n||(n=null),!n){var r=t.Util.fetch("object"==typeof e?e.root+"/"+e.file:e);return null!==r?t.loadJson(JSON.parse(r),i,e):null}t.Util.fetch("object"==typeof e?e.root+"/"+e.file:e,function(r){try{n(t.loadJson(JSON.parse(r),i,e))}catch(s){n(s)}})},t}"undefined"!=typeof module&&module.exports?module.exports=t(require("bytebuffer")):"function"==typeof define&&define.amd?define("ProtoBuf",["ByteBuffer"],t):(e.dcodeIO||(e.dcodeIO={}),e.dcodeIO.ProtoBuf=t(e.dcodeIO.ByteBuffer))}(this);
;(function(){"use strict";function t(t){throw t}function r(t,r){var e=t.split("."),i=c;!(e[0]in i)&&i.execScript&&i.execScript("var "+e[0]);for(var n;e.length&&(n=e.shift());)e.length||r===f?i=i[n]?i[n]:i[n]={}:i[n]=r}function e(t,r,e){var i,n="number"==typeof r?r:r=0,s="number"==typeof e?e:t.length;for(i=-1,n=7&s;n--;++r)i=i>>>8^d[255&(i^t[r])];for(n=s>>3;n--;r+=8)i=i>>>8^d[255&(i^t[r])],i=i>>>8^d[255&(i^t[r+1])],i=i>>>8^d[255&(i^t[r+2])],i=i>>>8^d[255&(i^t[r+3])],i=i>>>8^d[255&(i^t[r+4])],i=i>>>8^d[255&(i^t[r+5])],i=i>>>8^d[255&(i^t[r+6])],i=i>>>8^d[255&(i^t[r+7])];return(4294967295^i)>>>0}function i(){}function n(t){var r,e,i,n,s,a,h,o,u,f,c=t.length,p=0,y=Number.POSITIVE_INFINITY;for(o=0;c>o;++o)t[o]>p&&(p=t[o]),t[o]<y&&(y=t[o]);for(r=1<<p,e=new(l?Uint32Array:Array)(r),i=1,n=0,s=2;p>=i;){for(o=0;c>o;++o)if(t[o]===i){for(a=0,h=n,u=0;i>u;++u)a=a<<1|1&h,h>>=1;for(f=i<<16|o,u=a;r>u;u+=s)e[u]=f;++n}++i,n<<=1,s<<=1}return[e,p,y]}function s(r,e){switch(this.i=[],this.j=32768,this.d=this.f=this.c=this.n=0,this.input=l?new Uint8Array(r):r,this.o=!1,this.k=k,this.z=!1,(e||!(e={}))&&(e.index&&(this.c=e.index),e.bufferSize&&(this.j=e.bufferSize),e.bufferType&&(this.k=e.bufferType),e.resize&&(this.z=e.resize)),this.k){case m:this.a=32768,this.b=new(l?Uint8Array:Array)(32768+this.j+258);break;case k:this.a=0,this.b=new(l?Uint8Array:Array)(this.j),this.e=this.F,this.q=this.B,this.l=this.D;break;default:t(Error("invalid inflate mode"))}}function a(r,e){for(var i,n=r.f,s=r.d,a=r.input,h=r.c,o=a.length;e>s;)h>=o&&t(Error("input buffer is broken")),n|=a[h++]<<s,s+=8;return i=n&(1<<e)-1,r.f=n>>>e,r.d=s-e,r.c=h,i}function h(t,r){for(var e,i,n=t.f,s=t.d,a=t.input,h=t.c,o=a.length,u=r[0],f=r[1];f>s&&!(h>=o);)n|=a[h++]<<s,s+=8;return e=u[n&(1<<f)-1],i=e>>>16,t.f=n>>i,t.d=s-i,t.c=h,65535&e}function o(t){function r(t,r,e){var i,n,s,o=this.w;for(s=0;t>s;)switch(i=h(this,r)){case 16:for(n=3+a(this,2);n--;)e[s++]=o;break;case 17:for(n=3+a(this,3);n--;)e[s++]=0;o=0;break;case 18:for(n=11+a(this,7);n--;)e[s++]=0;o=0;break;default:o=e[s++]=i}return this.w=o,e}var e,i,s,o,u=a(t,5)+257,f=a(t,5)+1,c=a(t,4)+4,p=new(l?Uint8Array:Array)(N.length);for(o=0;c>o;++o)p[N[o]]=a(t,3);if(!l)for(o=c,c=p.length;c>o;++o)p[N[o]]=0;e=n(p),i=new(l?Uint8Array:Array)(u),s=new(l?Uint8Array:Array)(f),t.w=0,t.l(n(r.call(t,u,e,i)),n(r.call(t,f,e,s)))}function u(t){this.input=t,this.c=0,this.m=[],this.s=!1}var f=void 0,c=this,l="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;new(l?Uint8Array:Array)(256);var p;for(p=0;256>p;++p)for(var y=p,b=7,y=y>>>1;y;y>>>=1)--b;var g=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],d=l?new Uint32Array(g):g;i.prototype.getName=function(){return this.name},i.prototype.getData=function(){return this.data},i.prototype.H=function(){return this.I},r("Zlib.GunzipMember",i),r("Zlib.GunzipMember.prototype.getName",i.prototype.getName),r("Zlib.GunzipMember.prototype.getData",i.prototype.getData),r("Zlib.GunzipMember.prototype.getMtime",i.prototype.H);var v,w=[];for(v=0;288>v;v++)switch(!0){case 143>=v:w.push([v+48,8]);break;case 255>=v:w.push([v-144+400,9]);break;case 279>=v:w.push([v-256+0,7]);break;case 287>=v:w.push([v-280+192,8]);break;default:t("invalid literal: "+v)}var A=function(){function r(r){switch(!0){case 3===r:return[257,r-3,0];case 4===r:return[258,r-4,0];case 5===r:return[259,r-5,0];case 6===r:return[260,r-6,0];case 7===r:return[261,r-7,0];case 8===r:return[262,r-8,0];case 9===r:return[263,r-9,0];case 10===r:return[264,r-10,0];case 12>=r:return[265,r-11,1];case 14>=r:return[266,r-13,1];case 16>=r:return[267,r-15,1];case 18>=r:return[268,r-17,1];case 22>=r:return[269,r-19,2];case 26>=r:return[270,r-23,2];case 30>=r:return[271,r-27,2];case 34>=r:return[272,r-31,2];case 42>=r:return[273,r-35,3];case 50>=r:return[274,r-43,3];case 58>=r:return[275,r-51,3];case 66>=r:return[276,r-59,3];case 82>=r:return[277,r-67,4];case 98>=r:return[278,r-83,4];case 114>=r:return[279,r-99,4];case 130>=r:return[280,r-115,4];case 162>=r:return[281,r-131,5];case 194>=r:return[282,r-163,5];case 226>=r:return[283,r-195,5];case 257>=r:return[284,r-227,5];case 258===r:return[285,r-258,0];default:t("invalid length: "+r)}}var e,i,n=[];for(e=3;258>=e;e++)i=r(e),n[e]=i[2]<<24|i[1]<<16|i[0];return n}();l&&new Uint32Array(A);var m=0,k=1;s.prototype.g=function(){for(;!this.o;){var r=a(this,3);switch(1&r&&(this.o=!0),r>>>=1){case 0:var e=this.input,i=this.c,n=this.b,s=this.a,h=e.length,u=f,c=f,p=n.length,y=f;switch(this.d=this.f=0,i+1>=h&&t(Error("invalid uncompressed block header: LEN")),u=e[i++]|e[i++]<<8,i+1>=h&&t(Error("invalid uncompressed block header: NLEN")),c=e[i++]|e[i++]<<8,u===~c&&t(Error("invalid uncompressed block header: length verify")),i+u>e.length&&t(Error("input buffer is broken")),this.k){case m:for(;s+u>n.length;){if(y=p-s,u-=y,l)n.set(e.subarray(i,i+y),s),s+=y,i+=y;else for(;y--;)n[s++]=e[i++];this.a=s,n=this.e(),s=this.a}break;case k:for(;s+u>n.length;)n=this.e({t:2});break;default:t(Error("invalid inflate mode"))}if(l)n.set(e.subarray(i,i+u),s),s+=u,i+=u;else for(;u--;)n[s++]=e[i++];this.c=i,this.a=s,this.b=n;break;case 1:this.l(B,L);break;case 2:o(this);break;default:t(Error("unknown BTYPE: "+r))}}return this.q()};var U,E,z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],N=l?new Uint16Array(z):z,S=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],G=l?new Uint16Array(S):S,C=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],x=l?new Uint8Array(C):C,D=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],I=l?new Uint16Array(D):D,M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Z=l?new Uint8Array(M):M,j=new(l?Uint8Array:Array)(288);for(U=0,E=j.length;E>U;++U)j[U]=143>=U?8:255>=U?9:279>=U?7:8;var T,q,B=n(j),F=new(l?Uint8Array:Array)(30);for(T=0,q=F.length;q>T;++T)F[T]=5;var L=n(F);s.prototype.l=function(t,r){var e=this.b,i=this.a;this.r=t;for(var n,s,o,u,f=e.length-258;256!==(n=h(this,t));)if(256>n)i>=f&&(this.a=i,e=this.e(),i=this.a),e[i++]=n;else for(s=n-257,u=G[s],0<x[s]&&(u+=a(this,x[s])),n=h(this,r),o=I[n],0<Z[n]&&(o+=a(this,Z[n])),i>=f&&(this.a=i,e=this.e(),i=this.a);u--;)e[i]=e[i++-o];for(;8<=this.d;)this.d-=8,this.c--;this.a=i},s.prototype.D=function(t,r){var e=this.b,i=this.a;this.r=t;for(var n,s,o,u,f=e.length;256!==(n=h(this,t));)if(256>n)i>=f&&(e=this.e(),f=e.length),e[i++]=n;else for(s=n-257,u=G[s],0<x[s]&&(u+=a(this,x[s])),n=h(this,r),o=I[n],0<Z[n]&&(o+=a(this,Z[n])),i+u>f&&(e=this.e(),f=e.length);u--;)e[i]=e[i++-o];for(;8<=this.d;)this.d-=8,this.c--;this.a=i},s.prototype.e=function(){var t,r,e=new(l?Uint8Array:Array)(this.a-32768),i=this.a-32768,n=this.b;if(l)e.set(n.subarray(32768,e.length));else for(t=0,r=e.length;r>t;++t)e[t]=n[t+32768];if(this.i.push(e),this.n+=e.length,l)n.set(n.subarray(i,i+32768));else for(t=0;32768>t;++t)n[t]=n[i+t];return this.a=32768,n},s.prototype.F=function(t){var r,e,i,n,s=this.input.length/this.c+1|0,a=this.input,h=this.b;return t&&("number"==typeof t.t&&(s=t.t),"number"==typeof t.A&&(s+=t.A)),2>s?(e=(a.length-this.c)/this.r[2],n=258*(e/2)|0,i=n<h.length?h.length+n:h.length<<1):i=h.length*s,l?(r=new Uint8Array(i),r.set(h)):r=h,this.b=r},s.prototype.q=function(){var t,r,e,i,n,s=0,a=this.b,h=this.i,o=new(l?Uint8Array:Array)(this.n+(this.a-32768));if(0===h.length)return l?this.b.subarray(32768,this.a):this.b.slice(32768,this.a);for(r=0,e=h.length;e>r;++r)for(t=h[r],i=0,n=t.length;n>i;++i)o[s++]=t[i];for(r=32768,e=this.a;e>r;++r)o[s++]=a[r];return this.i=[],this.buffer=o},s.prototype.B=function(){var t,r=this.a;return l?this.z?(t=new Uint8Array(r),t.set(this.b.subarray(0,r))):t=this.b.subarray(0,r):(this.b.length>r&&(this.b.length=r),t=this.b),this.buffer=t},u.prototype.G=function(){return this.s||this.g(),this.m.slice()},u.prototype.g=function(){for(var r=this.input.length;this.c<r;){var n=new i,a=f,h=f,o=f,u=f,c=f,p=f,y=f,b=f,g=f,d=this.input,v=this.c;switch(n.u=d[v++],n.v=d[v++],(31!==n.u||139!==n.v)&&t(Error("invalid file signature:"+n.u+","+n.v)),n.p=d[v++],n.p){case 8:break;default:t(Error("unknown compression method: "+n.p))}if(n.h=d[v++],b=d[v++]|d[v++]<<8|d[v++]<<16|d[v++]<<24,n.I=new Date(1e3*b),n.O=d[v++],n.N=d[v++],0<(4&n.h)&&(n.J=d[v++]|d[v++]<<8,v+=n.J),0<(8&n.h)){for(y=[],p=0;0<(c=d[v++]);)y[p++]=String.fromCharCode(c);n.name=y.join("")}if(0<(16&n.h)){for(y=[],p=0;0<(c=d[v++]);)y[p++]=String.fromCharCode(c);n.K=y.join("")}0<(2&n.h)&&(n.C=65535&e(d,0,v),n.C!==(d[v++]|d[v++]<<8)&&t(Error("invalid header crc16"))),a=d[d.length-4]|d[d.length-3]<<8|d[d.length-2]<<16|d[d.length-1]<<24,d.length-v-4-4<512*a&&(u=a),h=new s(d,{index:v,bufferSize:u}),n.data=o=h.g(),v=h.c,n.L=g=(d[v++]|d[v++]<<8|d[v++]<<16|d[v++]<<24)>>>0,e(o,f,f)!==g&&t(Error("invalid CRC-32 checksum: 0x"+e(o,f,f).toString(16)+" / 0x"+g.toString(16))),n.M=a=(d[v++]|d[v++]<<8|d[v++]<<16|d[v++]<<24)>>>0,(4294967295&o.length)!==a&&t(Error("invalid input size: "+(4294967295&o.length)+" / "+a)),this.m.push(n),this.c=v}this.s=!0;var w,A,m,k=this.m,U=0,E=0;for(w=0,A=k.length;A>w;++w)E+=k[w].data.length;if(l)for(m=new Uint8Array(E),w=0;A>w;++w)m.set(k[w].data,U),U+=k[w].data.length;else{for(m=[],w=0;A>w;++w)m[w]=k[w].data;m=Array.prototype.concat.apply([],m)}return m},r("Zlib.Gunzip",u),r("Zlib.Gunzip.prototype.decompress",u.prototype.g),r("Zlib.Gunzip.prototype.getMembers",u.prototype.G)}).call(this);
;window._.Module.define({path:"common/widget/LogUtil",sub:{initial:function(){this.isDebug=$.cookie("lcs_debug")},log:function(){var o=this;o.isDebug&&console.log.apply(console,arguments)},error:function(){var o=this;o.isDebug&&console.error.apply(console,arguments)}}});
;window._.Module.define({path:"common/widget/Socket",sub:{initial:function(e){this.logUtil=this.requireInstance("common/widget/LogUtil",[]),this.util=this.requireInstance("common/widget/LcsUtil",[]),this.initParams(),this.setConfig(e)},initParams:function(){var e=this;e.setting={},e.ws=$.webSocket,e.pingTimer=0,e.timeoutTimer=0,e.receivedLastPong=!1,e.BrowserWebSocket=e.util.getSocket()},setConfig:function(e){var n=this;n.setting=e||{},$.each(["Cuid","Appid","Appkey","DeviceType","Extension-Version","LCS-Header-Version"],function(e,t){$.cookie(t,n.setting[t],{domain:".baidu.com",path:"/",expires:"Session"})})},state:function(){return this.ws instanceof WebSocket?this.ws.readyState:-1},connect:function(){var e=this;if(!e.BrowserWebSocket)return void e.onerror(null,"nosupport");e.disconnect(),window.clearInterval(e.pingTimer),window.clearTimeout(e.timeoutTimer);var n=e.ws=$.webSocket=new e.BrowserWebSocket("ws://"+e.setting.host,"chat");n.binaryType="arraybuffer",n.onopen=function(n){e.onopen(n)},n.onerror=function(n){e.onerror(n)},n.onclose=function(n){e.onclose(n)},n.onmessage=function(n){e.onmessage(n)};var t=e.setting.timeout;t>0&&(e.logUtil.log("\u8BBE\u7F6E\u4E86\u8D85\u65F6\u68C0\u67E5\uFF0C\u8D85\u65F6\u65F6\u957F\u4E3A",t,"\u6BEB\u79D2"),e.timeoutTimer=window.setTimeout(function(){e.reconnect()},t))},reconnect:function(){var e=this,n=e.setting;n.retry>0?(e.logUtil.log("[\u5F00\u59CB\u91CD\u8FDE]",n.retry),--n.retry,e.connect()):(e.logUtil.log("[\u5DF2\u8FBE\u5230\u6700\u5927\u91CD\u8FDE\u6B21\u6570]\u51C6\u5907\u91CA\u653E\u8FDE\u63A5"),n.onclose())},disconnect:function(){var e=this,n=e.ws;n instanceof WebSocket&&(n.onerror=n.onopen=n.onclose=n.onmessage=null,n.close())},ping:function(){var e=this;e.receivedLastPong?(e.receivedLastPong=!1,e.logUtil.log("[ping]\u6536\u5230\u4E0A\u6B21\u5FC3\u8DF3\u7684\u8FD4\u56DE\u7ED3\u679C\uFF0C\u51C6\u5907\u518D\u6B21\u53D1\u9001\u5FC3\u8DF3"),"function"==typeof e.setting.sendPing&&e.setting.sendPing(function(){e.receivedLastPong=!0})):(e.logUtil.log("[ping]\u6CA1\u6709\u6536\u5230\u4E0A\u6B21\u5FC3\u8DF3\u7684\u8FD4\u56DE\u7ED3\u679C\uFF0C\u51C6\u5907\u91CD\u8FDE"),e.reconnect())},onopen:function(e){var n=this;window.clearTimeout(n.timeoutTimer),n.logUtil.log("\u8FDE\u63A5\u6210\u529F\uFF01\u53D6\u6D88\u8D85\u65F6\u68C0\u67E5");var t=Number($.cookie("Seq-Id")),i=$.cookie("Configure");if($.cookie("Configure",null),$.cookie("Seq-Id",null),t||(t=parseInt((new Date).getTime()/1e3,10)),i)try{i=JSON.parse(i)}catch(o){i=null,n.logUtil.error("\u6536\u5230\u670D\u52A1\u7AEF\u8FD4\u56DEconf\u4F46\u65E0\u6CD5\u89E3\u6790",o)}else i={pingTime:900,pingTimeShort:300};if(i){n.logUtil.log("\u6536\u5230\u670D\u52A1\u7AEF\u8FD4\u56DEconf",i);var r=i.pingTimeShort;r>0&&"function"==typeof n.setting.sendPing&&(n.logUtil.log("\u51C6\u5907\u5FC3\u8DF3\u65B9\u6CD5\uFF0C\u95F4\u9694\u4E3A",r,"\u79D2"),n.receivedLastPong=!0,n.pingTimer=window.setInterval(function(){n.ping()},1e3*r))}n.setting.onopen(e,t,i)},onclose:function(e){var n=this;n.logUtil.log("[ONCLOSE]",e),window.clearTimeout(n.timeoutTimer),window.clearInterval(n.pingTimer),n.reconnect()},onerror:function(e,n){this.logUtil.log("[ONERROR]",e),this.setting.onerror(e,n)},unwrap:function(e){var n=this,t=new window.DataView(e,0,9),i=t.getUint8(0),o={command:t.getUint32(1),sequenceId:t.getUint32(5),compress:i>>7&1,encrypt:i>>6&1,needAck:i>>5&1,isPush:i>>4&1,extend:i>>0&1},r=e.slice(9);if(o.compress){var s=new window.Uint8Array(r);r=new window.Zlib.Gunzip(s).decompress().buffer}return o.extend||(o.data64=n.util.atob64(r)),o},wrap:function(e){var n=new window.ArrayBuffer(e.data.byteLength+9),t=new window.DataView(n),i=new window.Uint8Array(e.data),o=new window.Uint8Array(n),r=0,s=0,a=0,c=r<<0|a<<6|s<<7;return t.setUint8(0,c),t.setUint32(1,e.command),t.setUint32(5,e.sequenceId),o.set(i,9),n},onmessage:function(e){var n=this;if(e.data instanceof window.ArrayBuffer){var t=n.unwrap(e.data);n.logUtil.log("[\u6536\u5230\u6D88\u606F\u5E76\u89E3\u5305]",t),"function"==typeof n.setting.onmessage&&n.setting.onmessage(JSON.stringify(t))}else n.logUtil.error("\u6536\u5230\u975E\u4E8C\u8FDB\u5236\u6570\u636E\uFF0C\u65E0\u6CD5\u5904\u7406",e.data)},send:function(e){var n=this,t=n.ws;if(1!==t.readyState)return void n.logUtil.error("WebSocket\u72B6\u6001\u4E0D\u597D\uFF0C\u4E0D\u80FD\u53D1");try{var i=JSON.parse(e);i.data=n.util.b64toa(i.data64),t.send(n.wrap(i))}catch(o){n.logUtil.error("\u65E0\u6CD5\u89E3\u6790\u5F85\u53D1\u9001\u6570\u636E",e)}}}});_.Module.define({path:"common/widget/tb_lcs/Int64",sub:{initial:function(i){this.high=i.high,this.low=i.low},myToString:function(){return new dcodeIO.Long(this.low,this.high).toString()}}});
;_.Module.define({path:"common/widget/tb_lcs/LogUtil",sub:{error:function(){$.cookie("lcs_debug")&&"console"in window&&console.error(["[tbLcs]"].concat([].slice.apply(arguments)))},log:function(){$.cookie("lcs_debug")&&"console"in window&&console.log(["[tbLcs]"].concat([].slice.apply(arguments)))}}});
;var LAST_MSG_ID_SURVIVAL_TIME=6e5,LAST_MSG_ID_AUTO_DELAY_INTERVAL=3e4,LAST_MSG_ID_STORAGE_KEY="LCS_NOTIFY_LAST_MSG_ID_MAP_"+PageData.user.id;_.Module.define({requires:["LogUtil","Int64"],path:"common/widget/tb_lcs/LastMsgIdManager",sub:{initial:function(){this._logUtil=this.requireInstance("LogUtil",[])},_log:function(){this._logUtil.log.apply(this._logUtil,arguments)},getLastMsgId:function(t){return this._getLastMsgIdMap()?this._getLastMsgIdMap()[t]:void this._logUtil.error("lastMsgIdMap\u672A\u521D\u59CB\u5316\u6216\u5DF2\u5931\u6548\u3002\u53EF\u80FD\u5728debugger\u4E2D\u505C\u7559\u8FC7\u5BFC\u81F4$.Storage\u4E2D\u7684lastMsgIdMap\u672A\u53CA\u65F6\u88AB\u7EED\u7B7E\uFF0C\u53EF\u4EE5\u518D\u5F00\u542F\u4E00\u4E2Atab\u7531\u5176\u8D1F\u8D23\u5B9E\u65F6\u7EED\u7B7ElastMsgId~")},initialLastMsgIdMap:function(t){var s=this._getLastMsgIdMap()||{};for(var a in t)s[a]||(s[a]=t[a]);this._log("lastMsgIdMap \u521D\u59CB\u5316",s),this._setLastMsgIdMap(s)},updateLastMsgId:function(t,s){var a=this._getLastMsgIdMap();return a?(a[t]=s,this._log("lastMsgIdMap \u66F4\u65B0",a),void this._setLastMsgIdMap(a)):void this._logUtil.error("lastMsgIdMap\u672A\u521D\u59CB\u5316\uFF081007\u4E0A\u7EBF\u6210\u529F\u8FD4\u56DE\uFF09\u5373\u8BD5\u56FE\u8FDB\u884C\u66F4\u65B0\uFF08202003\u6536\u5230\u6D88\u606F\uFF1F\uFF09\uFF0C\u8FD9\u4E0D\u6B63\u5E38~")},hasInitialised:function(){return!!this._getLastMsgIdMap()},autoDelayExpire:function(){setInterval($.proxy(this._delayExpire,this),LAST_MSG_ID_AUTO_DELAY_INTERVAL)},_delayExpire:function(){this._log("lastMsgIdMap \u5C1D\u8BD5\u66F4\u65B0"),this._getLastMsgIdMap()&&(this._log("lastMsgIdMap \u66F4\u65B0"),this._setLastMsgIdMap(this._getLastMsgIdMap()))},_setLastMsgIdMap:function(t){var s=(new Date).getTime()+LAST_MSG_ID_SURVIVAL_TIME;$.tb.Storage.set(LAST_MSG_ID_STORAGE_KEY,$.json.encode(t),s),this._log("lastMsgIdMap set",this._getLastMsgIdMap())},_getLastMsgIdMap:function(){var t=$.json.decode($.tb.Storage.get(LAST_MSG_ID_STORAGE_KEY));for(var s in t)t[s]=this.requireInstance("Int64",[t[s]]);return t}}});
;_.Module.define({requires:["LogUtil","Int64"],path:"common/widget/tb_lcs/ProtoDataParser",sub:{initial:function(){this._logUtil=this.requireInstance("LogUtil",[])},getPid:function(r,t){var i;try{switch(r){case 209003:var e,a,o,s=t.data;if(!s)break;if(e=s.groupMsg,!$.isArray(e))break;if(a=e[0],!a)break;if(o=a.groupInfo,!o)break;i=o.groupType;break;case 202006:var u,g,n;if(u=t.multiMsg,!$.isArray(u))break;if(g=u[0],!g)break;if(n=g.data,!n)break;i=n.groupType;break;default:this._logUtil.error("\u672A\u77E5\u547D\u4EE4\u53F7: "+r+"\uFF0C\u65E0\u6CD5\u89E3\u6790\u51FApid(groupType)\u5B57\u6BB5\u7684\u4F4D\u7F6E\u3002\u8BF7\u5728imLcs._getPid\u4E2D\u589E\u52A0\u5BF9\u5E94\u547D\u4EE4\u53F7\u7684\u5904\u7406")}}catch(f){this._logUtil.error(f)}return i||this._logUtil.error("\u672A\u627E\u5230groupType, data:"+$.json.encode(t.data)),i},getMsgId:function(r,t){var i;try{switch(r){case 202006:var e,a,o;if(!t)return;if(e=t.multiMsg,!$.isArray(e))return;if(a=e[0],!a)return;if(o=a.data,!o)return;i=o.msgId;break;case 209003:var s,u,g,n,f;if(!t)return;if(s=t.data,!s)return;if(u=s.groupMsg,!$.isArray(u))return;if(g=u[0],!g)return;if(n=g.msgList,!$.isArray(n))return;if(f=n[n.length-1],!f)return;i=f.msgId}}catch(d){this._logUtil.error(d)}return this.requireInstance("Int64",[i])},getGroupId:function(r,t){var i;try{switch(r){case 209003:var e,a,o,s;if(!t)break;if(e=t.data,!e)break;if(a=e.groupMsg,!$.isArray(a))break;if(o=a[0],!o)break;if(s=o.groupInfo,!s)break;i=s.groupId;break;case 202006:var u,g,n;if(!t)break;if(u=t.multiMsg,!$.isArray(u))break;if(g=u[0],!g)break;if(n=g.data,!n)break;i=n.groupId;break;default:this._logUtil.error("\u672A\u77E5\u547D\u4EE4\u53F7: "+r+"\uFF0C\u65E0\u6CD5\u89E3\u6790\u51FAgroupId\u5B57\u6BB5\u7684\u4F4D\u7F6E\u3002\u8BF7\u5728imLcs._getGroupId\u4E2D\u589E\u52A0\u5BF9\u5E94\u547D\u4EE4\u53F7\u7684\u5904\u7406")}}catch(f){this._logUtil.error(f)}return i||this._logUtil.error("\u672A\u627E\u5230groupId, data:"+$.json.encode(t.data)),i}}});
;!function(){var e,o,t,n,r=1007,s=202006,a=209003,i=2,g=!1,d={},u=[];_.Module.define({requires:["LogUtil","ProtoDataParser","LastMsgIdManager","common/widget/Lcs","Int64"],path:"common/widget/TbLcs",sub:{initial:function(){g||(e=this.requireInstance("LogUtil",[]),t=this.requireInstance("ProtoDataParser",[]),o=this.requireInstance("LastMsgIdManager",[]),n=this.requireInstance("common/widget/Lcs",[]),this.isSupport=n.isSupport,o.autoDelayExpire(),this._listenNotify(),this._listenMessage(),this._listenInitialLastMsgId(),n.connect({onopen:$.proxy(this._online,this)}),g=!0)},on:function(e,o){n.on(e,o)},send:function(o){var t={command:o.command,data:o.data||void 0,success:o.success||$.noop,error:o.error||$.noop,contentType:o.contentType||"pb",dataType:o.dataType||"pb"};e.log("send",t),n.send(t)},onMessage:function(e,o){d[e]||(d[e]=[]),d[e].push(o)},onReady:function(t){var n=o.hasInitialised();e.log("onReady","callback:",t,"isReady:",n),n?t():u.push(t)},_listenInitialLastMsgId:function(){var t=this;t.on(r,function(n){e.log("on COMMAND_ONLINE",n);var r=n.data;if(r){var s=r.groupInfo;if($.isArray(s)){for(var a={},i=0;i<s.length;++i){var g=s[i];g&&(a[g.groupId]=t._createInt64(g.lastMsgId))}o.initialLastMsgIdMap(a)}}})},_listenNotify:function(){var o=this;o.on(s,function(r){if(e.log("on COMMAND_NOTIFY",r),n.isWebSocketInCurrentTab()){var a=t.getPid(s,r);a&&o._pullMessage(r)}})},_pullMessage:function(n){e.log("begin to pull message for notify: ",n);var r=this,i={},g={},d={};if(i.width=400,i.height=600,i.smallWidth=400,i.smallHeight=600,i.pushTimes=(new Date).getTime().toString(),g.groupId=t.getGroupId(s,n),!g.groupId)return void e.error("\u65E0groupId, \u505C\u6B62\u62C9\u6D88\u606F");var u=o.getLastMsgId(g.groupId);return u?(g.lastMsgId=u.myToString(),d.groupId=t.getGroupId(s,n),d.groupType=t.getPid(s,n),e.log("pull message, getGroupMsgReqData:",i),i.groupMids=[g],i.groupTypes=[d],void r.send({command:a,data:i})):void e.error("groupId "+g.groupId+"\u7684lastMsgId\u672A\u521D\u59CB\u5316\uFF0Cnotify\u88AB\u5FFD\u7565\uFF01\u8BF7\u8054\u7CFB\u540E\u7AEF@\u5982\u5175||@\u5251\u4E1C\u57281007\u547D\u4EE4\u4E2D\u8FD4\u56DE\u6B64groupId\u7684\u521D\u59CBlastMsgId\u503C")},_listenMessage:function(){var n=this;n.on(a,function(n){if(e.log("on COMMAND_MESSAGE",n),!n.error||0===n.error.errorno){var r=t.getMsgId(a,n);r&&o.updateLastMsgId(t.getGroupId(a,n),r);var s=d[t.getPid(a,n)];if($.isArray(s))for(var i=0;i<s.length;++i){var g,u=s[i];try{g=n.data.groupMsg[0]}catch(c){e.error(c)}g?(e.log("COMMAND_MESSAGE find and exec callback, curGroupMsg:",g),u(g)):e.error("curGroupMsg no content:",g,n)}}})},_online:function(){e.log("online","$.lcsFlash(lcsas.js) ready, begin to send COMMAND_ONLINE"),n.send({command:r,data:{bduss:"",secretKey:"",project:"MRD",groupId:0,device:$.json.encode({_client_type:20,pversion:"1.3.0"})},success:function(o){var t=o?o.error||{}:{};if(t.errorno+""=="0"){for(var r;u.pop();)(r=u.pop())();e.log("\u767B\u5F55\u6210\u529F")}else n.send({command:i}),e.log("\u767B\u5F55\u5931\u8D25")},error:function(){e.log("\u767B\u5F55\u5931\u8D25")},contentType:"pb",dataType:"pb"})},_createInt64:function(e){return this.requireInstance("Int64",[e])}}})}();_.Module.define({path:"common/widget/flashLcs",requires:[],sub:{initial:function(e){e=$.extend({onMessage:function(){}},e),this.requireInstance("common/widget/tbLcs").onMessage(8,function(n){var o;try{o=$.json.parseJSON(n.msgList[0].content),e.onMessage(o)}catch(s){window.console&&console.error(s)}})}}});_.Module.define({require:["common/widget/eventCenter"],path:"common/widget/newMessageSystem",requires:["common/widget/Userbar/DropDownList"],sub:{favUrl:{get:"/sysmsg/userpost/queryStoreUpdateNum",clear:"/sysmsg/userpost/clearStoreUpdateNum"},favData:{type:"favts",category_name:"\u6211\u7684\u6536\u85CF",unread_count:0,category_href:"&type=storethread"},notifyData:[],messageData:[{type:"",category_name:"\u67E5\u770B\u79C1\u4FE1",unread_count:0,category_href:"/im/pcmsg"}],msgType:{reply:"1",atme:"2",friendapply:"3",fans:"4"},setNotifyStorage:function(e){$.tb.Storage.set(this.localStorageKey,$.json.encode(e),this.expire)},initial:function(){this.$el=$(".userbar .u_news");var e=$('<div class="u_menu_item u_menu_news"><a href="#" class="u_news_wrap j_news" onclick="return false;">\u6D88\u606F<span></span><i class="i-arrow-down"></i></a></div>'),t=this.requireInstance("common/widget/Userbar/DropDownList",[this.$el,e]);this.$newsTips=e.find(".j_news span"),this.localStorageKey="notifyData"+PageData.user.id,this.expire=(new Date).getTime()+18e5,this.eventCenter=this.require("common/widget/eventCenter"),this.$el.append(e);var a=baidu.template("u_notify",{portrait:PageData.user.portrait});t.innerContent("top",a),this.$categoryList=this.$el.find(".j_category_list"),this.$systemNotifyList=this.$categoryList.eq(1),this.$systemMessageCountSpan=this.$el.find(".j_category_item_last .unread_num"),this.initLcs(),this.fetchNotifyList(),this.bindEvents()},initLcs:function(){TbCom.addEvent("User","infoComplete",function(){TbCom.process("UserMessage","init",null)})},fetchNotifyList:function(){var e=this,t=$.tb.Storage.get(this.localStorageKey),a=$("<a href="+document.referrer+"></a>")[0].host;return t&&document.referrer&&$.tb.location.getHost()===a?(t=$.json.decode(t),e.notifyData=t,void e.renderNotify(t,1)):void $.getJSON("/sysmsg/query/userunread",function(t){var a=t.data;0===t.errno&&(e.notifyData=a,e.renderNotify(a,1),e.setNotifyStorage(a))})},initMessagePanel:function(e){var t=this,a=[{type:"reply",category_name:"\u67E5\u770B\u56DE\u590D",unread_count:e[3]||0,category_href:"&type=replyme"},{type:"atme",category_name:"\u67E5\u770B@\u63D0\u5230\u6211",unread_count:e[8]||0,category_href:"&type=atme"},{type:"friendapply",category_name:"\u67E5\u770B\u597D\u53CB\u7533\u8BF7",unread_count:e[21]||0,category_href:"&type=friendapply"},{type:"fans",category_name:"\u67E5\u770B\u65B0\u7C89\u4E1D",unread_count:e[0]||0,category_href:"&type=fans"}];a.push(this.favData),$.each(a,function(e,t){var n="/i/sys/jump?u="+PageData.user.portrait+t.category_href;a[e].category_href=n}),a=[this.messageData[0]].concat(a),this.messageData=a,this.getFavNum(function(){t.renderNotify(t.messageData,0)})},renderNotify:function(e,t){0===t&&this.$categoryList.eq(t).html(baidu.template("u_notify_item",{list:e})).find(".j_cleardata").eq(0).tbattr("target","sixin"),this.renderNotifyTips()},renderNotifyTips:function(){var e=this.getTotalMessageCount(),t=this.getSystemMessageCount();this.$systemMessageCountSpan.html(t);var a=e>99?"99+":e;this.$newsTips.html("("+a+")"),t?this.$systemMessageCountSpan.show():this.$systemMessageCountSpan.hide(),e>0?this.$newsTips.show():this.$newsTips.hide()},getTotalMessageCount:function(){var e=0;return e=this.getNotifyMessageCount()+this.getSystemMessageCount()},getNotifyMessageCount:function(){var e=0;return $.each(this.messageData,function(t,a){e+=parseInt(a.unread_count,10)}),e},getSystemMessageCount:function(){var e=0;return $.each(this.notifyData,function(t,a){e+=parseInt(a.unread_count,10)}),e},bindEvents:function(){var e=this;e.eventCenter.bind("sysmsg.readmsg",function(t,a){for(var n=0,s=e.notifyData.length;s>n;n++){var i=e.notifyData[n];if(a.category_id==i.category_id){i.unread_count=parseInt(i.unread_count,10)-1,i.unread_count<0&&(i.unread_count=0),e.renderNotify(e.notifyData,1),this.setNotifyStorage(e.notifyData);break}}}),TbCom.on("msgsystem_initall",function(t){e.initMessagePanel(t)}),TbCom.on("msgsystem_message",function(t){t=t[1]||{};var a=t.type,n=t.content;a&&"undefined"!=typeof n&&("all_msg"!==a?(e.messageData[e.msgType[a]].unread_count=parseInt(n,10),e.renderNotify(e.messageData,0)):e.initMessagePanel(n.split(",")))}),TbCom.on("msgsystem_listencomplete",function(){}),e.$categoryList.on("click",".j_cleardata",function(t){var a=$(t.currentTarget),n=a.tbattr("data-type");return"favts"===n?void e.clearFavNum():void(n&&TbCom.process("UserMessage","clearData",n))});var t=this.eventCenter.TabHub,a=t("messageCount",function(){a.getUnreadDebounce()});a.getUnreadDebounce=_.debounce(function(){$.ajax({url:"/im/pcmsg/query/getAllUnread",dataType:"json",cache:!1,type:"GET"}).done(function(e){0===parseInt(e.errno)&&a.emit(e.unread)})},100),a.onValue(function(t){e.messageData[0].unread_count=parseInt(t,10),e.renderNotify(e.messageData,0),$(document).off("visibilitychange.message"),$(window).off("focus.message")}),this.eventCenter.data("tabHub.message",a),$.lcsFlash&&$.lcsFlash.on(202006,function(e){return 6===e.multiMsg[0].data.groupType?document.hasFocus()||document.hidden===!1?void a.getUnreadDebounce():void("undefined"!=typeof document.hidden?$(document).off("visibilitychange.message").one("visibilitychange.message",a.getUnreadDebounce):$(window).off("focus.message").one("focus.message",a.getUnreadDebounce)):void 0})},getFavNum:function(e){var t=this;$.get(this.favUrl.get,function(a){if(0===a.errno){t.favData.unread_count=a.num;var n=t.messageData[5];n&&(n.unread_count=a.num),t.renderNotify(t.messageData,0)}return $.isFunction(e)?void e.apply(t):void 0})},clearFavNum:function(){var e=this;$.get(this.favUrl.clear,function(t){if(0===t.errno){e.favData.unread_count=0;var a=e.messageData[5];a&&(a.unread_count=0),e.renderNotify(e.messageData,0)}})}}});_.Module.define({path:"common/widget/messenger",requires:["common/widget/messenger/messengerProcesser","common/widget/messenger/messengerTarget"],sub:{initial:function(e,n){if(!e)throw new Error("Messenger name must be asigned");var s=n||"[PROJECT_NAME]";this.name=e,this.prefix=s.toString(),this.supportPostMessage="postMessage"in window,this.origins=[],this.processer=this.requireInstance("common/widget/messenger/messengerProcesser"),this.targets={},this._initListen()},addTarget:function(e,n){this.targets[n]=this.requireInstance("common/widget/messenger/messengerTarget",[this.prefix,e,n])},registerCommand:function(e){this.processer.registerCommand(e)},registerOrigin:function(e){var n=0;for("string"==typeof e&&(e=[e]),n;n<e.length;n++)this.origins.push(e[n])},send:function(e){var n,s=this.targets;for(n in s)s.hasOwnProperty(n)&&s[n].send(e)},_warn:function(e){window.console&&window.console.warn&&window.console.warn(e)},_initListen:function(){var e=this,n=function(n){var s="";if("object"==typeof n){if(!n.data||"string"!=typeof n.data)return void(window.console&&console.warn("The received message is not type of string"));if(s=n.data,/^ignoredProject/.test(s))return;if(s.substring(0,e.prefix.length)!==e.prefix)return void(window.console&&console.warn("The msg type is not avaliable in project "+e.prefix));if(n.origin&&!e._checkOrigin(n.origin))return void(window.console&&console.warn("The post origin is not avaliable in project "+e.prefix))}else if(s=n,/^ignoredProject/.test(s))return;s=s.slice(e.prefix.length),s=e._escapeHTML(s);try{s=$.parseJSON(s)}catch(i){throw new Error("The JSON string is not valid")}var r=e.processer.process(s)||{};s.command&&s.shake&&s.shake_id&&e.send($.json.encode({command:s.command+"@"+s.shake_id+"@success",shake:!0,shake_id:s.shake_id,data:r}))};window.messenger=e,this.supportPostMessage?"addEventListener"in document?window.addEventListener("message",n,!1):"attachEvent"in document&&window.attachEvent("onmessage",n):window.navigator[this.prefix+this.name]=n},_escapeHTML:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\s/g,"&nbsp;").replace(/\\"/g,"&quot;")},_checkOrigin:function(e){var n=0,s=this.origins.length;for(n;s>n;n++)if(this.origins[n]===e)return!0;return!1}}});
;_.Module.define({path:"common/widget/messenger/messengerProcesser",requires:[],sub:{_failCommandCacheList:{},initial:function(){this.commandMap={common_login:$.proxy(this.common_login,this),common_register:$.proxy(this.common_register,this),exception_all:$.proxy(this.exception_all,this)}},registerCommand:function(o){this.checkExistCommand(o)&&(this.commandMap=$.extend(this.commandMap,o)),this.processFailCommand(o)},checkExistCommand:function(o){var n;for(n in o)if(o.hasOwnProperty(n)&&n in this.commandMap)return void(window.console&&console.warn('The command "'+n+'" is already exist'));return!0},processFailCommand:function(o){var n;for(n in o){var i=this._failCommandCacheList[n];o.hasOwnProperty(n)&&i&&this.process(i)}},process:function(o){if(!(o.command&&o.command in this.commandMap))return this._failCommandCacheList[o.command]=o,void(window.console&&console.warn("Please check or register the data processing command"));var n=this.commandMap[o.command];return n(o.data)},common_login:function(){PageData&&PageData.user&&!PageData.user.is_login&&this.requireInstanceAsync("common/widget/LoginDialog",[],function(){})},common_register:function(o){var n=o.return_url||"//tieba.baidu.com",i="https://passport.baidu.com/v2/?reg&tpl=tb&u="+n;window.open(i)},exception_all:function(){throw new Error("Processing data exception")}}});
;_.Module.define({path:"common/widget/messenger/messengerTarget",requires:[],sub:{initial:function(e,t,r){var i="";if(arguments.length<3?i="Target error: target and name are both requied":"object"!=typeof t?i="Target error: target itself must be window object":"string"!=typeof r&&(i="Target error: target name must be string type"),i)throw new Error(i);this.prefix=e,this.target=t,this.name=r},send:function(e){var t="postMessage"in window;if(t)this.target.postMessage(this.prefix+e,"*");else{var r=window.navigator[this.prefix+this.name];if("function"!=typeof r)throw new Error("Target error: target callback function is not defined");var i=$.tb.location,o={origin:i.getProtocol()+"//"+i.getHost(),data:this.prefix+e};r(o,window)}}}});_.Module.define({path:"common/widget/baseUserData",requires:[],sub:{initial:function(){},route:{getTdou:"//tieba.baidu.com/tbmall/getUserTd"},_item_cache_last_total_tdou:0,_parrScores:null,_parrProps:null,getUserName:function(){return PageData.user.user_nickname||PageData.user.name||PageData.user.name_url},getUserTdou:function(){var e=PageData.user,r=this._parrScores||e.Parr_scores;return r&&!$.isEmptyObject(r)?r.scores_money+r.scores_other:0},getShowName:function(){return PageData.user.name_show||PageData.user.user_name},isMemeber:function(){var e=this._parrProps||PageData.user.mParr_props||PageData.user.Parr_props,r=this._getMaxLevel(e);return!!r},getMemberLevel:function(){var e=this._parrProps||PageData.user.mParr_props||PageData.user.Parr_props,r=this._getMaxLevel(e);return r},getMemberIcon:function(){var e=this._parrProps||PageData.user.mParr_props||PageData.user.Parr_props,r=this._getMaxLevelExpire(e),a=this.getMemberIconByLevel(r);return a},getMemberIconByLevel:function(e){e&&(e=parseInt(e));var r="",a="",t="";switch(e){case-1:r=" icon-vip1-gray-18 base_member_icon",a="\u8D34\u5427\u4F1A\u5458",t="\u7EED\u8D39\u8D34\u5427\u4F1A\u5458";break;case 1:r=" icon-vip1-18 base_member_icon",a="\u7EED\u8D39\u8D34\u5427\u4F1A\u5458",t="\u5F00\u901A\u8D34\u5427\u4F1A\u5458";break;case-2:r=" icon-vip2-gray-18 base_member_icon",a="\u7EED\u8D39\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458",t="\u5F00\u901A\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458";break;case 2:r=" icon-vip2-18 base_member_icon",a="\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458",t="\u7EED\u8D39\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458";break;default:r="",a=""}var s={level:e,icon:r,title:a,action_title:t};return s},isLogin:function(){return PageData.user.is_login},needUpdateTdou:function(){var e=PageData.user.mParr_props||PageData.user.Parr_props,r=PageData.user.Parr_scores;return!(e&&r)},_getMaxLevel:function(e){var r=0,a=(new Date).getTime(),t=e||PageData.user.Parr_props;if(!t||!t.level)return 0;var s=t.level;return 1e3*s.end_time>a&&parseInt(s.props_id,10)>r&&(r=parseInt(s.props_id,10)),r},_getMaxLevelExpire:function(e){var r=0,a=(new Date).getTime(),t=e||PageData.user.Parr_props;if(!t||!t.level)return 0;var s=t.level;return parseInt(s.props_id,10)>r&&(r=parseInt(s.props_id,10),1e3*s.end_time<=a&&(r=0-r)),r},getTdou:function(e,r){var a=this;a._get_tdou_ajax&&a._get_tdou_ajax.abort(),a._get_tdou_ajax=$.ajax({type:"get",url:a.route.getTdou+"?"+new Date,data:{},cache:!1,dataType:"json"}).success(function(a){e.call(r,a)})},getUserTreasure:function(){return PageData.user.Parr_scores?PageData.user.Parr_scores.treasure_coin_total||0:0}}});_.Module.define({path:"common/widget/cashierDialog",requires:["common/widget/messenger"],sub:{sub_iframe_name:"cashier_dialog_iframe",windowId:"window_iframe_app_"+(new Date).getMilliseconds(),_iframe_dialog:null,initial:function(){this.dataProxy=this.requireInstance("common/widget/baseUserData"),this.member=this.dataProxy.getMemberIcon()},getTpl:function(){var e='<div class="cashier_dialog base_user_data"><div class="cashier_dialog_header"><div class="header_title"><span class="header_icon"></span>#{title}</div><div class="user_info"><span class="title_acc">\u8D26\u53F7\uFF1A<span class="#{member} j_member_icon"></span><a class="title_acc_name j_member_red">#{user_name}</a></span><span class="title_remain">T\u8C46\u4F59\u989D\uFF1A<span class="title_remain_num"><span class="user_tdou_icon"></span><span  class="j_tdou">#{tdou_num}<span></span></span></span></div><a class="header_close j_header_close"></a></div><div class="tdou_cashier_wrap" id="tdou_cashier_wrap"><iframe id="cashier_dialog_iframe" class="cashier_dialog_iframe" src="#{cashier_url}" frameborder="0" style="border: 0"></iframe></div></div>';return e},buildCashierIframe:function(e){return $.tb.format(this.getTpl(),e)},showDialog:function(e){var a=this;a._iframe_dialog&&$(".tdou_member_cashier_iframe_dialog").remove(),this.options=e||{},PageData.pay_fr=e.fr,PageData.pay_track=e.track;var i=e.cashier_url,s=this.member.action_title,t={user_name:this.dataProxy.getUserName(),tdou_num:0,member:this.member.icon,cashier_url:i,title:s||"\u5F00\u901A\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458"},r=a.buildCashierIframe(t),n={modal:!0,showTitle:!1,fixed:!0,width:726,height:564,hideOnclose:!1,holderClassName:"tdou_member_cashier_iframe_dialog",draggable:!0,html:r};a._iframe_dialog=new $.dialog(n),a._iframe_dialog.show(),a._setBody(),("ordinary_member_icon"==$.trim(this.member.icon)||"super_member_icon"==$.trim(this.member.icon))&&a._iframe_dialog.element.find(".j_member_red").addClass("member_red"),a.updateTdou(),a.wrap=a._iframe_dialog.element,PageData.tdou_dianquan_iframe_dialog=a._iframe_dialog,a.track("show"),a.bindEvent(),a.initMessager()},_setBody:function(){$("body").css({height:$(window).outerHeight(),overflow:"hidden"}),$(".dialogJmodal").css({height:$(window).outerHeight(),width:$(window).outerWidth(),position:"fixed",top:0,left:0})},bindEvent:function(){var e=this;e.wrap.find(".j_header_close").on("click",function(){e.closeMain()})},closeMain:function(){var e=PageData.tdou_dianquan_iframe_dialog;e&&e.close(),this._hideBody(),delete PageData.tdou_dianquan_iframe_dialog,this.track("\u5173\u95ED\u7A97\u53E3")},_hideBody:function(){$("body").css({height:"inherit",overflow:"auto"})},initMessager:function(){var e=this;if(!e.MessageInstance){e.MessageInstance=e.requireInstance("common/widget/messenger",[e.windowId,"tdou_pay"]);var a=window.document.getElementById(e.sub_iframe_name);e.MessageInstance.addTarget(a.contentWindow,e.sub_iframe_name);var i=["http://db.baidu.com","http://pay.baidu.com"];e.MessageInstance.registerOrigin(i),e.MessageInstance.registerCommand({encourage_dianquan_readystatechange:$.proxy(e.onReadyStateChange,this),encourage_dianquan_close:$.proxy(e.onClose,this)})}},sendMessage:function(e){var a=this;if(a.MessageInstance){var i="";"object"==typeof e&&(i=JSON.stringify(e)),a.MessageInstance.targets[a.sub_iframe_name].send(i)}},onReadyStateChange:function(e){if(e)switch(e.status){case 2e3:this.updateMember(e.data),this.track("\u652F\u4ED8\u6210\u529F");break;case 3e3:this.onClose();break;case 3001:this.onClose(),this.track("\u518D\u6B21\u8D2D\u4E70")}},onClose:function(){this.closeMain()},updateTdou:function(){var e=this;e.dataProxy.getTdou(function(e){if(e&&0===e.no){var a=e.data.Parr_scores,i=a?a.scores_money+a.scores_other:0;$(".tdou_member_cashier_iframe_dialog .j_tdou").html(i)}},this)},updateMember:function(e){var a=this,i=a.dataProxy.getMemberIconByLevel(e.user_level);$(".tdou_member_cashier_iframe_dialog .j_member_icon").addClass(i.icon);var s=e.user_level;s&&(s=parseInt(s),s>0&&$(".tdou_member_cashier_iframe_dialog .j_member_red").addClass("member_red"))},track:function(e){$.stats.track(PageData.pay_track||"memberpay","cashierDialog-"+PageData.pay_fr,PageData.product,e||"click")}}});_.Module.define({path:"common/widget/creative_bar",sub:{initial:function(e){this.$creativeWrapper=e.find(".u_creative"),this.$creative=$('<div class="u_menu_item"><a rel="noreferrer" href="/home/creative/index" target="_blank" track-locate="1">\u89C6\u9891\u53F7\u521B\u4F5C\u4E2D\u5FC3</a><i class="i-arrow-down"></i></div>'),this.$creativeWrapper.append(this.$creative),this.initDropDown();var t=$.tb.Storage.get("SHOW_TIEBA_CREATE_CASH_OUT");t||($.tb.Storage.set("SHOW_TIEBA_CREATE_CASH_OUT",1),this.guideToast())},guideToast:function(){this.$toastWrapper=$(['<div class="post_head_popup">','<div class="post_head_bubble">','<i class="triangle triangle-img"></i>','<span class="post_head_bubble_delete"></span>','<span class="post_head_bubble_content">',"\u521B\u4F5C\u6FC0\u52B1\u6765\u5566\uFF0C\u770B\u770B\u4F60\u7684\u6536\u76CA\u5427~","</span>","</div>","</div>"].join("")),this.bindCloseToast(),this.$creativeWrapper.append(this.$toastWrapper)},bindCloseToast:function(){var e=this;this.$toastWrapper.find(".post_head_bubble_delete").click(function(){e.$toastWrapper.hide()})},initDropDown:function(){var e=["<ul>","<li>",'<a rel="noreferrer" href="/home/creative/publish" target="_blank" track-locate="2">\u89C6\u9891\u4F5C\u54C1\u53D1\u5E03</a>',"</li>","<li>",'<a rel="noreferrer" href="/home/creative/work" target="_blank" track-locate="3">\u89C6\u9891\u4F5C\u54C1\u7BA1\u7406</a>',"</li>","<li>",'<a rel="noreferrer" href="/home/creative/data" target="_blank" track-locate="4">\u89C6\u9891\u4F5C\u54C1\u6570\u636E</a>',"</li>","</ul>"].join(""),t=this.use("common/widget/Userbar/DropDownList",this.$creativeWrapper,this.$creative);t.innerContent("top",e),this.$creativeWrapper.find("a[track-locate]").click(function(e){var t=$(e.target).attr("track-locate");$.stats.track(t,"\u5934\u90E8\u521B\u4F5C\u4E2D\u5FC3\u5165\u53E3","pb","click","pc_web")})}}});_.Module.define({path:"common/widget/qianbaoCashierDialog",requires:["common/widget/baseUserData"],sub:{iframeContainerId:"qianbao_cashier_payment_channel_wrap",qianbaoLbscashierUrl:"//zhifu.baidu.com/static/epic/fe_wallet_cashier/page/iframe/cashier.js?t="+(new Date).getTime(),services:{createOrder:"/tbmall/getPayUrl",getOrder:"/tbmall/getorder"},initial:function(){this.dataProxy=this.requireInstance("common/widget/baseUserData")},createMain:function(a,e,t){var i=this;PageData.qianbao_cashier=i,i.setLoading(),$.isFunction(t)&&t(i.$root),i.changeoPayAmount(a,e),i.qianbao_params_json=i.getParams(a)},buildCashier:function(a,e){var t=this;t.cashier?t.cashier.updateOrder(a):(1==e?t.cashier=new window.lbscashier({onmessage:t.onMessage,containerId:t.iframeContainerId,data:a,height:340}):2==e&&(t.cashier=new window.lbscashier({onmessage:t.onMessage,containerId:t.iframeContainerId,data:a,height:400})),$("#cashier-iframe").css({border:"none"}))},onMessage:function(a){var e=PageData.qianbao_cashier;if(!a)return void console.log("onmessage null");var t=a.type,i=a.data,s=a.option,o=s&&s.channel,n=!1;if("updateOrder"===t)e.clearPayLoading();else if("pay"===t)switch(i){case"submit":if("wechat"===o||"alipayqr"===o||"gameyeepay"===o||"mobileyeepay"===o)return;e.showPaymentTip(),e.track("pay-submit");break;case"addcard":break;case"success":e.track("pay-success");var r="wechat"===o||"alipayqr"===o||"gameyeepay"===o||"mobileyeepay"===o?!0:!1;r?(n=!0,e.checkQrcodePaymentResult()):e.showPaymentTip(r)}else if("qrcodeAlipay"===t)switch(i){case"success":e.showPaymentTip(),e.track("alipay-qrcode-success")}else if("qrcodeWechat"===t)switch(i){case"success":e.showPaymentTip(),e.track("wechat-qrcode-success")}n||e.clearLoading()},getSmallUser:function(){var a=PageData.user.id,e=a%2;return!e},showDialog:function(a,e,t,i){var s=this;1==t?$.stats.track("all","\u6253\u5F00\u4F1A\u5458\u6536\u94F6\u53F0","all","show"):2==t&&$.stats.track("all","\u6253\u5F00T\u8C46\u8BA2\u5355\u652F\u4ED8\u9875","all","show"),s.product=a.product,$.JsLoadManager.loadUrl(s.qianbaoLbscashierUrl,function(){s.buildDialog(e),s.createMain(a.qianbao_params,t,i)})},buildDialog:function(a){var e=this;if(e._iframe_dialog){if($(".qianbao_cashier_iframe_dialog").size()>0&&!$(".qianbao_cashier_iframe_dialog").is(":hidden"))return;$(".qianbao_cashier_iframe_dialog").remove()}var t={modal:!0,showTitle:!1,fixed:!0,width:717,height:638,hideOnclose:!1,holderClassName:"qianbao_cashier_iframe_dialog",draggable:!0,html:e.getDialogTpl(a)};e._iframe_dialog=new $.dialog(t),e._iframe_dialog.show(),e._setBody(),e.$root=e._iframe_dialog.element,e.track("show")},_setBody:function(){$("body").css({height:$(window).outerHeight(),overflow:"hidden"}),$(".dialogJmodal").css({height:$(window).outerHeight(),width:$(window).outerWidth(),position:"fixed",top:0,left:0})},_hideBody:function(){$("body").css({height:"inherit",overflow:"auto"})},getDialogTpl:function(a){var e=this,t="member"===e.product?'<div class="qianbao_cashier_agreement">\u8BF7\u52A1\u5FC5\u5BA1\u9605\u5E76\u63A5\u53D7<a href="https://tieba.baidu.com/tb/vip_eula.html">\u300A\u8D34\u5427\u4F1A\u5458\u670D\u52A1\u534F\u8BAE\u300B</a>\u6240\u6709\u6761\u6B3E\uFF0C\u5426\u5219\u60A8\u65E0\u6743\u4F7F\u7528\u672C\u670D\u52A1</div>':'<div class="qianbao_cashier_agreement">\u8BF7\u52A1\u5FC5\u5BA1\u9605\u5E76\u63A5\u53D7<a href="https://tieba.baidu.com/tb/tdouprecautions.html">\u300AT\u8C46\u8D2D\u4E70\u987B\u77E5\u300B</a>\u6240\u6709\u6761\u6B3E\uFF0C\u5426\u5219\u60A8\u65E0\u6743\u4F7F\u7528\u672C\u670D\u52A1\u3002<div class="protocol"><a target="_blank" href="https://tieba.baidu.com/tb/tdou_highpay_pc.html">\u5145\u503C\u653B\u7565</a>|<a target="_blank" href="https://tieba.baidu.com/tb/tdou_highpay_show.html">\u9650\u989D\u67E5\u8BE2</a></div></div>',i='<div class="qianbao_cashier_dialog j_qianbao_cashier_dialog"><!-- htmlcs-disable -->  <div class="loading j_qianbao_cashier_loading">      <table height="100%" width="100%">          <tbody><tr>              <td valign="middle" align="center">                  <img src="//tb2.bdstatic.com/tb/static-common/widget/qianbao_cashier_dialog/images/charging_f0da091.gif">                                  <p class="j_loading_text">\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019...</p>              </td>          </tr>          </tbody>      </table>  </div><!-- htmlcs-disable -->  <div class="qiaobao_pay_loading j_pay_loading">      <table height="100%" width="100%">          <tbody>          <tr>              <td valign="middle" align="center">                  <img src="//tb2.bdstatic.com/tb/static-common/widget/qianbao_cashier_dialog/images/charging_f0da091.gif">                  <p class="j_loading_text">\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019~</p>              </td>          </tr>          </tbody>      </table>  </div><div class="qianbao_cashier_payment_goods_wrap">#{goodsShowTpl}</div><div class="qianbao_cashier_payment_channel_wrap" id="'+e.iframeContainerId+'"></div>'+t+"</div>",s={goodsShowTpl:a};return i=$.tb.format(i,s)},qianbaoSecure:function(){var a={};a.templist=[];var e="passport.baidu.com";return a.set_pass_domain=function(a){switch(a){case"passport.baidu.com":case"wappass.baidu.com":case"passport.rdtest.baidu.com":case"passport.qatest.baidu.com":e=a}},a.pin=function(e,t){var i=window.Image?new Image:document.craeteElement("img"),s=function(a){s=function(){},t&&t(a)};i.onload=function(){s()},i.onerror=function(){s("failed")},a.templist.push(i),i.src=e},a}(),changeoPayAmount:function(a,e){var t=this,i=a;t.qianbao_params_json=t.getParams(a),t.buildCashier(i,e)},closeDialog:function(){var a=this,e=a._iframe_dialog;e&&e.close(),this._hideBody(),delete PageData.qianbao_cashier,clearTimeout(a.timerId),clearTimeout(a.checkPaymentId),a.track("\u5173\u95ED\u7A97\u53E3")},getParams:function(a){var e={};if(!a)return e;var t=/orderId=[^&]*/,i=t.exec(a);if(1==i.length){var s=i[0].split("=");e.orderId=s[1]||""}return e},getPageUrl:function(){var a=$.tb.location.getHref();return a=a.replace(/&customerId=.*|\?customerId=.*/g,"")},checkPaymentResult:function(){var a=this;a.getPaymentResult("ok",function(e){a.showPaymentSuccess(e)},function(e){a.showPaymentFailure(e)})},checkQrcodePaymentResult:function(){this.setLoading("check"),this.checkPaymentResult()},getPaymentResult:function(a,e,t){var i=this;i.setLoading();var s={order_id:i.qianbao_params_json.orderId},o={product:i.product,userName:i.dataProxy.getUserName()};i._checkPaymentResult&&i._checkPaymentResult.abort();var n=5,r=function(){n--,s.polling=5-n,clearTimeout(i.checkPaymentId),i._checkPaymentResult=$.ajax({type:"GET",url:i.services.getOrder,data:s,dataType:"json"}).success(function(s){var c=s.data.db_money||0;c/=100;var l=s.data.scores_total;if(!l){var d=s.data.given_scores||0;l=1e3*c+d+i.dataProxy.getUserTdou()}o=$.extend(o,{payAmount:c.toFixed(2),totalScores:l,payTdou:(s.data.given_scores||0)+(10*s.data.db_money||0)});var p=s.data.member_info;if(p){var _="yyyy-MM-dd",u=1e3*parseInt(p.create_time),m=1e3*parseInt(p.end_time);o=$.extend(o,{create_time:$.dateFormat(new Date(u),_),end_time:$.dateFormat(new Date(m),_)})}0==s.no?(i.clearLoading(),clearTimeout(i.checkPaymentId),e&&e(o),n=5):n>0&&"ok"===a?i.checkPaymentId=setTimeout(r,1e3):(i.clearLoading(),t&&t(o))})};i.checkPaymentId=setTimeout(r,1e3)},setLoading:function(a){var e=this,t=e.$root.find(".j_qianbao_cashier_loading");if(!t.is(":visible")){var i={loading:"\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019...",paying:"\u5F88\u52AA\u529B\u7684\u5145\u503C\u4E2D...",check:"\u67E5\u8BE2\u5145\u503C\u7ED3\u679C\u4E2D..."};t.show(),t.find(".j_loading_text").html(i[a]||i.loading)}},clearLoading:function(){var a=this,e=a.$root.find(".j_qianbao_cashier_loading");1==e.length&&e.hide()},showPaymentTip:function(a){var e=this,t=e.$root.find(".j_qianbao_payment_tip");1==t.length&&t.remove(),e.$root.find(".j_qianbao_cashier_dialog").append(baidu.template('<!-- htmlcs-disable -->  <section class="qianbao_payment_tip j_qianbao_payment_tip ">      <div class="tip_dialog">          <div class="tip_dialog_content">              <%if(isQuickPay){%>              <p class="description">\u60A8\u5DF2\u6210\u529F\u652F\u4ED8</p>              <%} else {%>              <p class="description">\u8BF7\u5728\u65B0\u6253\u5F00\u9875\u9762\u4E0A\u5B8C\u6210\u5145\u503C</p>              <%}%>              <p class="description-tips">\u4ED8\u6B3E\u5B8C\u6210\u524D\u8BF7\u4E0D\u8981\u5173\u95ED\u6216\u5237\u65B0\u6B64\u7A97\u53E3</p>              <div class="center">                  <a class="btn_default btn_sub btn-middle j_close qianbao_pay_tip_btn j_try_pay_again" style="margin-right: 20px;">\u5931\u8D25\uFF0C\u91CD\u65B0\u652F\u4ED8</a>                  <a class="btn_default btn-middle btn-encourage j_pay_ok qianbao_pay_tip_btn">\u652F\u4ED8\u6210\u529F</a>              </div>          </div>          <span class="tip_dialog_close j_close"></span>      </div>      <span class="middle-helper"></span>  </section>',{isQuickPay:a})),t=e.$root.find(".j_qianbao_payment_tip"),t.find(".j_close").on("click",function(){e.hidePaymentTip(),e.getPaymentResult("fail",function(a){e.showPaymentSuccess(a)},function(){e.trigger("event_tdou_qianbao_pay_again")})}),t.find(".j_pay_ok").on("click",function(){e.checkPaymentResult(),e.hidePaymentTip()})},hidePaymentTip:function(){var a=this,e=a.$root.find(".j_qianbao_payment_tip");e&&e.remove()},showPayLoading:function(){var a=this,e=a.$root.find(".j_pay_loading");e.show(),e.find(".j_loading_text").html("\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019...")},clearPayLoading:function(){var a=this,e=a.$root.find(".j_pay_loading");1==e.length&&e.hide()},showPaymentSuccess:function(a){var e=this,t=baidu.template('<!-- htmlcs-disable -->  <div class="qiaobao_pay_result_dialog j_qiaobao_pay_result_dialog">      <div class="result_title">          <span class="result_pic success_pic"></span>          <%if(product == \'tdou\'){%>          <span class="result_txt">\u83B7\u53D6\u6210\u529F\uFF01</span>          <p style="text-align:center">\u60A8\u53EF\u4EE5\u5728<span class="pay_amount">\u6211\u7684T\u8C46\u94B1\u5305</span>\u4E2D\u67E5\u770B\u8BE6\u7EC6\u4FE1\u606F</p>          <%}else if(product == \'member\'){%>          <span class="result_txt">\u5145\u503C\u6210\u529F\uFF01</span>          <%}%>      </div>        <%if(product == \'tdou\'){%>      <p><label>\u8D26\u53F7\uFF1A</label><%=userName%></p>      <p><label>\u83B7\u8D60T\u8C46\uFF1A</label><span class="pay_amount"><%=payTdou%></span>T\u8C46</p>      <p><label>\u652F\u4ED8\u91D1\u989D\uFF1A</label><span class="pay_amount"><%=payAmount%></span>\u5143</p>      <%}else if(product == \'member\'){%>      <p><label>\u4F1A\u5458\u8D77\u59CB\u65E5\u671F\uFF1A</label><span class="member_date"><%=create_time%></span></p>        <p><label>\u4F1A\u5458\u7ED3\u675F\u65E5\u671F\uFF1A</label><span class="member_date"><%=end_time%></span></p>      <%}%>        <div class="button_container">          <a class="btn_default btn-middle btn-encourage qianbao_pay_result_btn j_close ">              <%if(product == \'tdou\'){%>              \u7EE7\u7EED\u83B7\u53D6              <%}else if(product == \'member\' || product == \'packet\'){%>              \u7EE7\u7EED\u5145\u503C              <%}%>          </a>      </div>      <p style="text-align:center"><span class=" second j_second">5</span>\u79D2\u540E\u5173\u95ED\u7A97\u53E3</p>  </div>  ',a);e.updateUserInfo(a.totalScores),e.showPaymentResult(t)},showPaymentFailure:function(a){var e=this,t=baidu.template('<!-- htmlcs-disable -->  <div class="qiaobao_pay_result_dialog j_qiaobao_pay_result_dialog">      <div class="result_title">          <span class="result_pic fialed_pic"></span>          <%if(product == \'tdou\'){%>          <span class="result_txt">\u83B7\u53D6\u5931\u8D25\uFF01</span>          <%}else if(product == \'member\'){%>          <span class="result_txt">\u5145\u503C\u5931\u8D25\uFF01</span>          <%}else if(product == \'packet\'){%>          <span class="result_txt">\u5145\u503C\u5931\u8D25\uFF01</span>          <%}%>      </div>      <p><label>\u8D26\u53F7\uFF1A</label><%=userName%></p>      <p><label>\u83B7\u8D60T\u8C46\uFF1A</label><span class="pay_amount"><%=payTdou%></span>T\u8C46</p>      <p><label>\u652F\u4ED8\u91D1\u989D\uFF1A</label><span class="pay_amount"><%=payAmount%></span>\u5143</p>        <div class="button_container">          <a class="btn_default btn-middle btn-encourage qianbao_pay_result_btn j_repay ">              <%if(product == \'tdou\'){%>              \u91CD\u65B0\u83B7\u53D6              <%}else if(product == \'member\' || product == \'packet\'){%>              \u91CD\u65B0\u5145\u503C              <%}%>          </a>      </div>        <p style="text-align:center">          <span class="second j_second">5</span>\u79D2\u540E\u5173\u95ED\u7A97\u53E3          <a href="//tieba.baidu.com/hermes/feedback?category=pay">\u8FDB\u884C\u53CD\u9988</a>      </p>  </div>  ',a);e.showPaymentResult(t)},updateUserInfo:function(a){PageData.user.Parr_scores.scores_total=a,this.$root.find(".j_tdou").html(a)},showPaymentResult:function(a){var e=this;e.$root.find(".j_qianbao_cashier_dialog").append($(a));var t=e.$root.find(".j_qiaobao_pay_result_dialog .j_second"),i=5,s=function(){return i--,0==i?void e.closeDialog():(t.html(i),void(e.timerId=setTimeout(s,1e3)))};e.timerId=setTimeout(s,1e3),e.$root.on("click",".j_qiaobao_pay_result_dialog .j_close",function(){e.closeDialog()}).on("click",".j_qiaobao_pay_result_dialog .j_repay",function(){clearTimeout(e.timerId),e.$root.find(".qiaobao_pay_result_dialog").remove(),e.trigger("event_tdou_qianbao_pay_again")})},track:function(a,e,t){var i=this;$.stats.track(a,e||"qianbaoCashierDialog-"+i.product,PageData.product+"-"+(t||"qianbao-cashier-"+i.product),"click")}}});_.Module.define({path:"common/widget/baseDialogUserBar",requires:["common/widget/baseUserData","common/widget/Icons"],sub:{tpl:'<div class="base_dialog_user_bar base_user_data">      <%if(!is_tdou_info_display){%>          <div class="header_title_member">              <span>\u73A9\u8D34\u5427 \u4EAB\u7279\u6743</span>          </div>      <%}else{%>            <div class="header_title">              <span class="header_icon"></span>              <span>                  <%=title%>              </span>          </div>          <div class="user_info">              <span class="title_acc">\u8D26\u53F7\uFF1A                  <%= userIcon %>                      <a class="title_acc_name <%=member_red%> ">                          <%=user_name%>                      </a>              </span>              <span class="tdou_remain">T\u8C46\u4F59\u989D\uFF1A                  <span class="tdou_remain_num">                      <span class="user_tdou_icon"></span>                      <span class="j_tdou">                          <%=tdou_num%>                      </span>                  </span>              </span>          </div>      <%}%>            <a class="header_close j_header_close"></a>  </div>',initial:function(){this.dataProxy=this.requireInstance("common/widget/baseUserData"),this.member=this.dataProxy.getMemberIcon(),this.icon=this.requireInstance("user/widget/Icons")},getUserBarTemplate:function(e){var a=this,s="",r=!0;e&&"getmember"==e?(s=a.member.action_title,r=!1):s="\u83B7\u53D6T\u8C46";var t="";("ordinary_member_icon"==$.trim(a.member.icon)||"super_member_icon"==$.trim(a.member.icon))&&(t=" member_red ");var i=this.icon.getPreIconHtml($.getPageData("user.mParr_props"),$.getPageData("user"),!0),n={user_name:a.dataProxy.getUserName(),tdou_num:a.dataProxy.getUserTdou(),member:a.member.icon,member_red:t,title:s,is_tdou_info_display:r,userIcon:i},m=window._.template(a.tpl,n);return m}}});_.Module.define({path:"common/widget/qianbaoPurchaseMember",requires:["common/widget/qianbaoCashierDialog","common/widget/baseUserData","common/widget/baseDialogUserBar"],sub:{$root:null,memberOptions:null,id:"qianbao_purchase_member",carouselA:null,carouselB:null,target:"",size:"",defaultA:"",defaultB:"",is_autopay:"",initial:function(){var e=this;window.pageUnit=window.pageUnit||{};var t=window.pageUnit;t[this.id]||(t[this.id]=$.ajax({url:"/theme/getPage",type:"GET",data:{id:["qianbao_purchase_member_hot_message","qianbao_purchase_member_member_types"]},dataType:"json"}).done(function(i){i=i.data||{},t[e.id]={hotMessage:i.qianbao_purchase_member_hot_message||"\u8FD8\u7B49\u4EC0\u4E48\u5347\u7EA7\u5E74\u8D39\u4F1A\u5458\uFF0C\u7ECF\u9A8C\u589E\u957F\u66F4\u5FEB\uFF01",memberTypes:i.qianbao_purchase_member_member_types||"super, normal"},t[e.id].memberTypes=t[e.id].memberTypes.split(/\s*,\s*/g)}).fail(function(){t[e.id]={hotMessage:"\u8FD8\u7B49\u4EC0\u4E48\u5347\u7EA7\u5E74\u8D39\u4F1A\u5458\uFF0C\u7ECF\u9A8C\u589E\u957F\u66F4\u5FEB\uFF01",memberTypes:["super","normal"]}})),e.cashierDialog=e.requireInstance("common/widget/qianbaoCashierDialog"),e.baseData=e.requireInstance("common/widget/baseUserData"),e.baseDialogUserBar=this.requireInstance("common/widget/baseDialogUserBar"),e.vip3Src="//tb2.bdstatic.com/tb/static-common/widget/qianbao_purchase_member/images/tb-plus-vip3_487ffa0.png",e.vip4Src="//tb2.bdstatic.com/tb/static-common/widget/qianbao_purchase_member/images/tb-plus-vip4_23cb1b2.png",e.icon1Src="//tb2.bdstatic.com/tb/static-common/widget/qianbao_purchase_member/images/icon_tbvip_super_first_pc_1a69991.png",e.icon2Src="//tb2.bdstatic.com/tb/static-common/widget/qianbao_purchase_member/images/icon_tbvip_super_second_pc_39a5284.png",e.icon3Src="//tb2.bdstatic.com/tb/static-common/widget/qianbao_purchase_member/images/icon_tbvip_super_third_pc_614294d.png",e.icon4Src="//tb2.bdstatic.com/tb/static-common/widget/qianbao_purchase_member/images/icon_tbvip_normal_first_pc_9e02559.png",e.icon5Src="//tb2.bdstatic.com/tb/static-common/widget/qianbao_purchase_member/images/icon_tbvip_normal_second_pc_ca769da.png",e.icon3Tip="//tb2.bdstatic.com/tb/static-common/widget/qianbao_purchase_member/images/icon_tbvip_attention_pc_f71bce9.png",e.return_url=e.cashierDialog.getPageUrl(),e.cashierDialog.bind("event_tdou_qianbao_pay_again",e.payAgain,e)},memberInit:function(){$.ajax({type:"GET",url:"/tbmall/member/recharge",cache:!1,dataType:"json"}).success(function(e){if(0==e.no){var t=e.user.show_nickname;if(e.goods_info.member){var i=e.goods_info.member.money_info;$(".j_list_1050001").html("");for(var a=0;a<i.length;a++){var o=i[a].discount?i[a].discount:"",n=1==i[a].default?" selected":"",s=i[a].tag_name?'<div class="tag_name">'+i[a].tag_name+"</div>":"";$(".j_list_1050001").append('<li class="time_item j_order_update j_time_item j_vip_month_'+i[a].months+n+'">'+s+'<div class="time-type vip_money" for="vip_money_'+i[a].months+'" id="vip_money_'+i[a].months+'" data-value='+i[a].months+n+'><div class="money_icon"></div>'+i[a].money/100+'</div><div class="time-type vip_des" for="vip_des_'+i[a].months+'" id="vip_des_'+i[a].months+'" data-value="'+i[a].months+'">'+o+'</div><div class="time-type vip_month" for="vip_month_'+i[a].months+'" id="vip_month_'+i[a].months+'" data-value='+i[a].months+">"+i[a].months+"\u4E2A\u6708</div></li>")}}else $(".j_type_1050001").css("display","none");if(e.goods_info.adv_member){var r=e.goods_info.adv_member.money_info;$(".j_list_1050002").html("");for(var a=0;a<r.length;a++){var o=r[a].discount?r[a].discount:"",n=1==r[a].default?" selected":"",s=r[a].tag_name?'<div class="tag_name">'+r[a].tag_name+"</div>":"",c=2==r[a].goods_type?"is_autopay_1":"",m=1==r[a].has_autopay_goods?"has_autopay_goods_"+r[a].months:"";$(".j_list_1050002").append('<li class="time_item '+c+" "+m+" j_order_update j_time_item j_vip_month_"+r[a].months+n+'" data-isAutoplay='+r[a].is_autopay+">"+s+'<div class="time-type '+m+' vip_money" for="vip_money_'+r[a].months+'" id="vip_money_'+r[a].months+'" data-value='+r[a].months+n+'><div class="money_icon"></div>'+r[a].money/100+'</div><div class="time-type '+m+' vip_des" for="vip_des_'+r[a].months+'" id="vip_des_'+r[a].months+'" data-value="'+r[a].months+'">'+o+'</div><div class="time-type '+m+' vip_month" for="vip_month_'+r[a].months+'" id="vip_month_'+r[a].months+'" data-value='+r[a].months+">"+r[a].months+"\u4E2A\u6708</div></li>")}}else $(".j_type_1050002").css("display","none");$(".member-info .user-name").html(t)}})},carouselIcon:function(e,t){function i(e,t){s=1,c++,o(c,t),c==t&&($(".slide-div ."+e+"-icon").css("left",0),c=1),$(".slide-div ."+e+"-icon").stop().animate({left:-c*r},1e3);setTimeout(function(){s=0},1e3)}function a(e,t){s=1,c--,o(c,t),-1==c&&($(".slide-div ."+e+"-icon").css({left:-(t-1)*r}),c=t-2),$(".slide-div ."+e+"-icon").animate({left:-c*r},1e3);setTimeout(function(){s=0},1e3)}function o(e,t){0==e||e==t-1?$(".button-left").addClass("no-optional"):$(".button-left").removeClass("no-optional"),e==t-2?$(".button-right").addClass("no-optional"):$(".button-right").removeClass("no-optional")}var n=this,s=0;n.target=e,n.size=t,$(".slide-div ."+e+"-icon").css("left","0");var r=300,c=0;$(".j_qianbao_cashier_dialog").off("click").on("click",".button-left",function(){$(this).hasClass("no-optional")||0!=s||a(n.target,n.size)}).on("click",".button-right",function(){$(this).hasClass("no-optional")||0!=s||i(n.target,n.size)})},payAgain:function(){var e=this;e.showDialog(e.memberOptions)},showDialog:function(e){var t=this;t.product=e.product||"member",t.memberOptions=e,t.member=t.baseData.getMemberIcon();$.now(),new Date("2018-07-10 00:00:00").getTime(),new Date("2018-08-31 24:00:00").getTime();t.initMemberId="1050002",t.initMemberCount="3",t.is_autopay="0",t.getPayMemberOrder(t.initMemberId,t.initMemberCount,t.is_autopay,function(e){var i={qianbao_params:e};t.showMember(i);var a=t.cashierDialog.getParams(e);t.orderId=a.orderId})},showMember:function(e){var t=this,i=window.pageUnit;if(i[this.id].done)return void(i[this.id]=i[this.id].done(function(){t.showMember(e)}));e.hotMessage=e.hotMessage||i[this.id].hotMessage,e.memberTypes=e.memberTypes||i[this.id].memberTypes;var a=e.qianbao_params||"",o=$.extend(e,{baseDialogUserBarTpl:t.baseDialogUserBar.getUserBarTemplate("getmember"),vip3Src:t.vip3Src,vip4Src:t.vip4Src,icon1Src:t.icon1Src,icon2Src:t.icon2Src,icon3Src:t.icon3Src,icon4Src:t.icon4Src,icon5Src:t.icon5Src,icon1Tip:t.icon1Tip,icon2Tip:t.icon2Tip,icon3Tip:t.icon3Tip,type_1050001:2==t.member.level||-2==t.member.level?" hide_type_1050001":""}),n=window.baidu.template('<!-- htmlcs-disable -->\r\n<div class="qianbao_cashier_purchase_member base_user_data">\r\n    <%- baseDialogUserBarTpl %>\r\n    <div class="member_cashier_wrap j_member_cashier_wrap" id="member_cashier_wrap">\r\n        <div class="member_wrap">\r\n            <ul class="member_list j_member_list">\r\n                <li class="member_item recommend j_order_update  j_type_1050002">\r\n                    <div class="member-type" id="ptype-1050002" data-name="\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458" data-value="1050002">\r\n                        <img src="<%- vip4Src %>">\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458\r\n                    </div>\r\n                </li>\r\n                <li class="member_item j_order_update j_type_1050001 <%- type_1050001 %>">\r\n                    <div class="member-type" id="ptype-1050001" data-name="\u8D34\u5427\u4F1A\u5458" data-value="1050001">\r\n                        <img src="<%- vip3Src %>">\u8D34\u5427\u4F1A\u5458\r\n                    </div>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n        <div class="member-info">\r\n            <div>\u5145\u503C\u8D26\u53F7\uFF1A\r\n                <span class="user-name"></span>\r\n            </div>\r\n            <div class="slide-content">\r\n                <div class="slide-title">\u5F00\u901A\u540E\u83B7\u5F97:</div>\r\n                <div class="slide-div j_slide_1050002">\r\n                    <ul class="super-icon">\r\n                        <li>\r\n                            <img src="<%- icon1Src %>">\r\n                        </li>\r\n                        <li>\r\n                            <img src="<%- icon2Src %>">\r\n                        </li>\r\n                        <li>\r\n                            <img src="<%- icon3Src %>">\r\n                        </li>\r\n                    </ul>\r\n                </div>\r\n                <div class="slide-div j_slide_1050001 no-picked" style="display: none">\r\n                    <ul class="member-icon">\r\n                        <li>\r\n                            <img src="<%- icon4Src %>">\r\n                        </li>\r\n                        <li>\r\n                            <img src="<%- icon5Src %>">\r\n                        </li>\r\n                        <li>\r\n                            <img src="<%- icon4Src %>">\r\n                        </li>\r\n                    </ul>\r\n                </div>\r\n                <ul id="controler">\r\n                    <li class="button-left no-optional"></li>\r\n                    <li class="button-right"></li>\r\n                </ul>\r\n            </div>\r\n        </div>\r\n        <div class="member_time_wrap">\r\n            <ul class="time_list j_time_list j_list_1050002"></ul>\r\n            <ul class="time_list j_time_list j_list_1050001"></ul>\r\n            <div class="form-tip">\r\n                <div class="single_selection"></div>\r\n                <span>\u5230\u671F\u540E\u81EA\u52A8\u7EED\u8D39 (\u53EF\u968F\u65F6\u53D6\u6D88) </span>\r\n                <a target="_blank" href="//tieba.baidu.com/tb/viprenew_eula.html" class="rule-tip"><img src="<%- icon3Tip %>"></a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n',o),s={qianbao_params:a,product:"member"},r=1;t.cashierDialog.showDialog(s,n,r,function(e){t.$root=e,t.initUI(t.initMemberId,t.initMemberCount,t.is_autopay),t.bindEvents()})},initUI:function(e,t,i){var a=this;a.selectedUI(e,t,i),a.memberInit(),a.carouselIcon("super",4)},selectedUI:function(e,t){var i=this;i.$root.find(".j_member_list li").removeClass("selected"),i.$root.find(".j_type_"+e).addClass("selected"),i.$root.find(".slide-div").css("display","none"),i.$root.find(".j_slide_"+e).css("display","block"),i.$root.find("#controler .button-left").addClass("no-optional"),i.$root.find("#controler .button-right").removeClass("no-optional"),i.$root.find(".j_time_list").css("display","none"),i.$root.find(".j_list_"+e).css("display","flex"),i.$root.find(".j_time_list li").removeClass("selected");var a=i.$root.find("#vip_month_"+t);$(".j_type_"+e).hasClass("selected")&&($(".j_type_icon").css("display","none"),$(".j_type_icon_"+e).css("display","block")),a.length?(a.parents("li.j_time_item").addClass("selected"),i.$root.find("#month-custum").val("")):i.$root.find(".j_custum_time").addClass("selected")},updatePayUI:function(e,t,i){var a=this;a.cashierDialog.showPayLoading(),e&&t&&a.getPayMemberOrder(e,t,i,function(e){a.cashierDialog.changeoPayAmount(e)})},bindEvents:function(){var e=this,t=120,i=0;e.$root.find(".single_selection").off("click").on("click",function(t){t.stopPropagation(),$(this).hasClass("picked")?($(this).removeClass("picked"),$(".j_vip_month_1").css("display","block"),$(".is_autopay_1.j_vip_month_1").css("display","none"),i=0):($(this).addClass("picked"),$(".j_vip_month_1").css("display","none"),$(".is_autopay_1.j_vip_month_1").css("display","block"),i=1),e.selectedUI("1050002","1",i),e.updatePayUI("1050002","1",i)}),e.$root.find(".qianbao_cashier_agreement a").on("click",function(e){e.stopPropagation(),$.stats.track("\u4ED8\u6B3E\u5F39\u7A97\u5E95\u90E8","\u5F00\u901A/\u7EED\u8D39\u4F1A\u5458\u670D\u52A1\u534F\u8BAE\u70B9\u51FB",PageData.page?PageData.page:"other","click")}),e.$root.on("click",".member_item",function(t){t.stopPropagation(),t.preventDefault();var a=$(t.target),o="",n="";o=a.data("value"),n=e.$root.find(".j_time_list li.selected .time-type").data("value"),n||(n=e.$root.find("#month-custum").val()),$(".form-tip").css("display","none"),"1050001"==o?(i=0,""!==e.defaultA?n=e.defaultA:"",e.carouselIcon("member",3),$(".j_vip_month_1").css("display","block"),$(".is_autopay_1.j_vip_month_1").css("display","none")):"1050002"==o&&(""!==e.defaultB?n=e.defaultB:"",e.carouselIcon("super",4)),e.selectedUI(o,n,i),e.updatePayUI(o,n,i),$.stats.track("swich_membertype_"+("1050001"==o?"\u8D34\u5427\u4F1A\u5458":"\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458"),"membertype-switch",PageData.page,"click")}),e.$root.on("click",".time-type",function(t){var a="",o="",n=e.$root.find(".j_member_list li.selected .member-type");t.stopPropagation(),t.preventDefault();var s=$(t.target);e.$root.find("#month-custum").val(""),o=s.data("value"),a=n.data("value"),1050001==a&&($(".form-tip").css("display","none"),i=0),$(".single_selection").removeClass("picked"),$(".j_vip_month_1").css("display","block"),$(".is_autopay_1.j_vip_month_1").css("display","none"),s.hasClass("has_autopay_goods_1")?$(".form-tip").css("display","flex"):($(".form-tip").css("display","none"),i=0),e.selectedUI(a,o,i),e.updatePayUI(a,o,i),$.stats.track("choose_custom_"+o,"memberCashier",PageData.page?PageData.page:"other","click",{member_type:n.data("name")})}),e.$root.find("#month-custum").on("input propertychange",function(){var i=/^[1-9]\d*$/,a=$(this),o=a.val();(o&&!i.test(o)||i.test(o)&&o>t)&&(o=o.replace(/\D/g,"").replace(/^0(\d*)$/,"$1"),o=Math.min(t,o),0==o&&(o=1),a.val(o),e.showCustomMonthBubble());var n=e.$root.find(".j_member_list li.selected .member-type").data("value");e.updatePayUI(n,o)}).on("focus",function(i){var a=$(i.target);e.$root.find(".j_time_list li").removeClass("selected"),e.$root.find(".j_custum_time").addClass("selected"),e.cashierDialog.showPayLoading();var o=a.val(),n=/^[1-9]\d*$/;(o&&!n.test(o)||n.test(o)&&o>t)&&(o=o.replace(/\D/g,"").replace(/^0(\d*)$/,"$1"),o=Math.min(t,o),0==o&&(o=1),a.val(o),e.showCustomMonthBubble());var s=e.$root.find(".j_member_list li.selected .member-type").data("value");e.updatePayUI(s,o)}),e.$root.find(".j_header_close").on("click",function(){e.cashierDialog.closeDialog()}),e.$root.find(".j_vip_month_12").hover(function(){e.showMonth12Bubble()},function(){e.hideMonth12Bubble()})},getPayMemberOrder:function(e,t,i,a){var o=this,n={terminal:"pc",pay_type:1,channel:2,memberId:e,memberCount:t,pageUrl:o.return_url,fr:""};1==i?n.is_autopay=1:"",n.fr=1==i?203:129,o._getPayMemberAjax&&o._getPayMemberAjax.abort(),o._getPayMemberAjax=$.ajax({type:"GET",url:"/tbmall/getPayUrl",data:n,cache:!1,dataType:"json"}).success(function(e){if(0==e.no)a&&a(e.data.return_url);else if(1990055==e.error_code)if("undefined"==typeof passport||"undefined"==typeof passport.pop.init){var t="undefined"!=typeof Env&&Env.server_time?Env.server_time:(new Date).getTime(),i="https://passport";$.JsLoadManager.use([i+".baidu.com/passApi/js/uni_login_wrapper.js?cdnversion="+Math.floor(t/6e4),i+".baidu.com/passApi/js/wrapper.js?cdnversion="+Math.floor(t/6e4)],function(){window.realname=passport.pop.init({type:"accRealName",apiOpt:{product:"tb",staticPage:"//tieba.baidu.com/tb/static-common/html/pass/v3Jump.html"},tangram:!0,color:"green"}),window.realname.show()},!0,"utf-8")}else window.realname.show()})},updatePayMemberOrder:function(e,t,i,a){var o=this,n={terminal:"pc",pay_type:1,channel:2,order_id:i,memberId:e,memberCount:t,pageUrl:o.return_url};o._upPayMemberAjax&&o._upPayMemberAjax.abort(),o._upPayMemberAjax=$.ajax({type:"GET",url:"/tbmall/upOrder",data:n,cache:!1,dataType:"json"}).success(function(e){0==e.no&&a&&a(e.data)})},createBubble:function(e){var t=$.extend(e,{arrow_dir:"down",arrow_pos:{left:30},closeBtn:!1,level:1,arrowReq:!0});return new UiBubbleTipBase(t)},showMonth12Bubble:function(){var e=this;e.hideCustomMonthBubble();var t=e.$root.find(".j_vip_month_12");if(!e.bubble_month_12){var i={content:"\u4E00\u6B21\u6027\u5F00\u901A12\u4E2A\u6708\u4EE5\u4E0A\u4F1A\u5458\uFF0C\u8D60\u9001\u8FDE\u7EED\u7B7E\u5230\u53613\u5F20",bubble_css:{top:0,right:-100,width:280},wrap:t};e.bubble_month_12=e.createBubble(i)}e.bubble_month_12.showBubble()},hideMonth12Bubble:function(){var e=this;e.bubble_month_12&&e.bubble_month_12.hideBubble()},showCustomMonthBubble:function(){var e=this,t=e.$root.find(".j_custum_time");if(!e.bubble_custom_month){var i={content:"\u4E00\u6B21\u6027\u53EA\u80FD\u5F00\u901A120\u4E2A\u6708\u8D34\u5427\u4F1A\u5458",bubble_css:{top:0,right:-100,width:280},wrap:t};e.bubble_custom_month=e.createBubble(i)}e.bubble_custom_month.showBubble()},hideCustomMonthBubble:function(){var e=this;e.bubble_custom_month&&e.bubble_custom_month.hideBubble()}}});_.Module.define({path:"common/widget/payMember",requires:["common/widget/qianbaoPurchaseMember","common/widget/Tdou/TdouOpenType"],sub:{pay_member_url:"/tbmfall/getPayUrl",PayMemberUrl:"/tbmall/getMyPayType",CASHIER:1,QIANBAO:2,initial:function(){var e=this;e.cashierDialog=e.requireInstance("common/widget/cashierDialog"),e.qianbaoPayMember=e.requireInstance("common/widget/qianbaoPurchaseMember"),e.openTypeList=e.requireInstance("common/widget/Tdou/TdouOpenType",{type:"member"})},showCashier:function(e){var a=this,i=e||{};$.extend(i,{fr:i.fr||"",track:"memberpay"}),this.opt=i,a._openCtrl("dialog"),a.payType=a.QIANBAO,a.payTypeCtrl()},_openCtrl:function(e){var a=this,i=a.openTypeList.getOpenType(a.opt.scene_id);switch(e="win"===e||"dialog"===e?e:i){case"win":a.openNewWindow();break;case"dialog":}},openNewWindow:function(){this.win=window.open("")},openDialog:function(){var e=this.opt;1==this.payType?this.cashierDialog.showDialog(e):this.qianbaoPayMember.showDialog(e)},_getPayType:function(e){var a=this,i=this.opt.scene_id;e?(a.payType=e,a.payTypeCtrl()):(e=1,$.ajax({type:"GET",dataType:"json",url:a.PayMemberUrl,data:{terminal:"pc",pay_type:"member",id:i},success:function(i){0==i.no&&(e=Number(i.data.pay_type_id)||1),a.payType=e,a.payTypeCtrl()}}))},payTypeCtrl:function(){var e=this;e.openDialog()}}});_.Module.define({path:"common/widget/http_transform",sub:{initial:function(){window.BaiduHttps||(window.BaiduHttps={callbacks:function(){}})},httpTransform:function(t){if(window.navigator.userAgent){var i=window.navigator.userAgent;i=i.toLowerCase();var n=new RegExp("/chrome|firefox|safari|msie 10|rsv:11|msie [89]/");n.test(i)&&(t=t.replace("http://www.baidu.com","https://www.baidu.com"))}return t},httpLinkHover:function(t){$(t).hover(function(){$.ajax({url:"https://www.baidu.com/con?from=tieba",type:"get",dataType:"JSONP"})})}}});_.Module.define({path:"common/widget/official_bar",sub:{initial:function(i){this.$officialWrapper=i.find(".u_official"),this.$official=$('<div class="u_menu_item"><span class="post_head_official">\u5B98\u65B9\u53F7\u670D\u52A1\u4E2D\u5FC3</span></div>'),this.$officialWrapper.append(this.$official),this.bindClickOfficial()},guideModal:function(){this.$guideModalWrapper=$(['<div class="post_head_official_guide_wrapper">','<div class="post_head_official_guide">','<div class="post-head-official-guide-close"></div>',"</div>","</div>"].join("")),this.$officialWrapper.append(this.$guideModalWrapper)},renewTips:function(){this.$renewTipsWrapper=$(['<div class="renew-tips-arrow">',"</div>",'<div class="renew-tips-wrapper">','<p class="renew-tips-title">',"\u5B98\u65B9\u53F7\u7EED\u8D39\u63D0\u9192","</p>",'<p class="renew-tips-content">',"\u5B98\u65B9\u53F7\u5373\u5C06\u5230\u671F\uFF0C\u8BF7\u7ACB\u5373\u8FDB\u884C\u7EED\u8D39\u3002\u5B98\u65B9\u53F7\u5230\u671F\u540E\u6240\u6709\u6743\u76CA\u5C06\u4E0D\u80FD\u88AB\u4F7F\u7528","</p>",'<div class="renew-tips-confirm">',"\u77E5\u9053\u4E86","</div>",'<div class="renew-tips-cancel">',"\u7ACB\u5373\u7EED\u8D39","</div>","</div>"].join("")),this.$officialWrapper.append(this.$renewTipsWrapper)},renewGoto:function(i){this.$renewGotoMove=$(['<div class="renew-goto-move-wrapper">','<div class="renew-goto-move">','<div class="renew-goto-move-title">',"\u5B98\u65B9\u53F7\u6E29\u99A8\u63D0\u793A","</div>",'<div class="post-head-official-guide-close"></div>','<div class="renew-goto-move-top">','<div class="renew-goto-move-top-icon"></div>','<div class="renew-goto-move-top-title">\u5B98\u65B9\u53F7\u5DF2\u7ECF\u8FC7\u671F\uFF0C\u8BF7\u5230\u79FB\u52A8\u7AEF\u8BA4\u8BC1\u9996\u9875\u91CD\u65B0\u5145\u503C\u8FDB\u884C\u5F00\u901A\u3002</div>','<div class="renew-goto-move-top-content">',"\u5F88\u9057\u61BE\u60A8\u7684\u5B98\u65B9\u53F7\u5DF2\u7ECF\u8FC7\u671F\uFF0C\u5B98\u65B9\u53F7\u670D\u52A1\u4E2D\u5FC3\u5DF2\u5173\u95ED\u670D\u52A1\uFF0C\u4E3A\u4E86\u7EE7\u7EED\u4E3A\u60A8\u63D0\u4F9B\u670D\u52A1\uFF0C\u8BF7\u5230\u79FB\u52A8\u7AEF\u8BA4\u8BC1\u9996\u9875\u91CD\u65B0\u5145\u503C\u8FDB\u884C\u5F00\u901A\u3002","</div>",'<div class="renew-goto-move-top-time">\u5230\u671F\u65F6\u95F4\uFF1A'+i+"</div>","</div>",'<div class="renew-download-wrapper">','<div class="renew-download-left"></div>','<div class="renew-download-right">','<p class="renew-download-right-title">\u8D34\u5427App\u626B\u7801\u6253\u5F00\u9A8C\u8BC1\u9996\u9875</p>','<p class="renew-download-right-cont">\u6700\u65B0\u7248\u767E\u5EA6\u8D34\u5427APP-\u6211\u7684-\u53F3\u4E0A\u89D2</p>','<div class="renew-download-right-img"></div>',"</div>","</div>",'<div class="renew-goto-move-bottom">','<div class="renew-goto-move-bottom-button">\u4E0B\u8F7D\u8D34\u5427App</div>','<div class="renew-goto-move-bottom-img">',"</div>","</div>","</div>","</div>"].join("")),this.$officialWrapper.append(this.$renewGotoMove)},bindClickOfficial:function(){var i=this;if(PageData.user.business_account){if(PageData.user.business_account.expiry_time)var e=new Date(1e3*PageData.user.business_account.expiry_time).toLocaleDateString().replace(/\//g,"-");1===PageData.user.business_account.show_pay_tip&&(i.renewTips(),i.closeRenewTips(),i.gotoRenew())}this.$officialWrapper.find(".post_head_official").click(function(){$.stats.track("Service_center_1","pc_hp","\u5B98\u65B9\u53F7\u670D\u52A1\u4E2D\u5FC3","click"),PageData.user.business_account||PageData.user.is_uc_account?1===PageData.user.business_account.status?window.open("https://tieba.baidu.com/home/business/all?fr=business"):0===PageData.user.business_account.status?(i.guideModal(),i.bindCloseGuide()):2===PageData.user.business_account.status&&(i.renewGoto(e),i.closeRenewGoto()):(i.guideModal(),i.bindCloseGuide())})},bindCloseGuide:function(){var i=this;this.$officialWrapper.find(".post-head-official-guide-close").click(function(){i.$guideModalWrapper.hide()})},closeRenewTips:function(){var i=this;this.$officialWrapper.find(".renew-tips-confirm").click(function(){i.$renewTipsWrapper.hide(),$.ajax({url:"//tieba.baidu.com/home/business/closePayTip",data:{type:"index"}})})},gotoRenew:function(){this.$officialWrapper.find(".renew-tips-cancel").click(function(){window.open("https://tieba.baidu.com/home/business/all?fr=business")})},closeRenewGoto:function(){var i=this;this.$officialWrapper.find(".post-head-official-guide-close").click(function(){i.$renewGotoMove.hide()})}}});_.Module.define({path:"common/widget/business_agent",sub:{initial:function(e,n){this.$agentWrapper=e.find(".u_agent");var t=n?"user":"tpAcountc";this.$agent=$('<div class="u_menu_item"><a rel="noreferrer" href="/home/business/'+t+'?fr=agent" target="_blank">\u4EE3\u7406\u5546\u4E2D\u5FC3</a></div>'),this.$agentWrapper.append(this.$agent)}}});_.Module.define({path:"common/widget/Userbar",requires:["DropDownList","common/widget/Card","common/widget/wallet_dialog","common/widget/newMessageSystem","common/widget/cashierDialog","common/widget/messenger","common/widget/creative_bar","common/widget/baseUserData","common/widget/payMember","common/widget/http_transform","common/widget/login_dialog","common/widget/official_bar","common/widget/business_agent"],sub:{_btns:{},_userinfo:null,$root:null,_logoutTimer:null,_product:null,_self:this,_urls:{itb_home:"",my_itb:"",my_club:"",u_split:"",my_space:""},_ddls:{itb:null,club:null,space:null},_userDataRended:{my_forum:!1,club:!1,space:!1},_is_open_yycurrency_open:function(){return this.globalSwitch=this.requireInstance("common/widget/GlobalSwitch"),this.globalSwitch.getSwitch()&&this.globalSwitch.getConvert()},_is_open_yycurrency:function(e){return this._is_open_yycurrency_open()?e.replace(/(\d*)T\u8C46/g,function(e,t){return(t/100||"")+"Y\u5E01"}):e},initial:function(e,t,i,r){this.globalSwitch=this.requireInstance("common/widget/GlobalSwitch"),t=t||"",TbCom.process("User","init",e,t),this._userinfo=e,this._product=t,this.userbarName=!1,PageData.user.joinEmoji&&"initial"!=PageData.user.joinEmoji&&(this.userbarName=PageData.user.joinEmoji),this._buildLayout(r),TbCom.process("MsgSystem","init"),setTimeout(function(){TbCom.process("UserMessage","init",t,r)},200),this._bluePush(i)},_isDateTime:function(e){var t=864e5,i=e+t,r=Number(localStorage.getItem("tiebaPush"));return+new Date<i&&(r&&r!==e||!r)?!0:!1},_bluePush:function(e){if(e.userDiamond&&e.userDiamond.notice_time&&e.bluePushUnit&&(e.bluePushFlag.indexOf(window.PageData.product)>-1||e.bluePushFlag.indexOf("all")>-1)){var t=1e3*Number(e.userDiamond.notice_time);if(this._isDateTime(t)){var i={acceptValue:e.bluePushUnit.button[0]||"",cancelValue:"\u5173\u95ED",onaccept:function(){window.open(e.bluePushUnit.url[0]||"//tieba.baidu.com")}};this._blue_dialog=new $.dialog.confirm(e.bluePushUnit.text[0]||"\u606D\u559C\u4F60",i),localStorage.setItem("tiebaPush",t)}}},_bindEvent:function(){},_initURLs:function(){this._urls.itb_st_param="st_mod=userbar&fr=tb0_"+this._product,this._urls.itb_home="/i/sys/jump?un="+this._userinfo.name_url+(this._userinfo.no_un?"&fr_noun=1":""),this._urls.my_favor=this._urls.itb_home+"&ie=utf-8&type=storethread&"+this._urls.itb_st_param,this._urls.itb_profile="/home/profile?un="+this._userinfo.name_url+(this._userinfo.no_un?"&fr_noun=1":"")},_buildLayout:function(e){var t=this,i="";-1!=$.inArray(this._product,["tbmall","livetool"])&&(i="userbar_theme2"),this.$root=$('<div id="com_userbar" class="userbar '+i+'"></div>');var r=$.getcurzIndex();(null==r||0>=r)&&(r=11e3),this.$root.css({"z-index":r});var o=$(e?e:"body");if(o.prepend(this.$root),this.$root.on("click","a",function(){var e=$(this),t="\u9876\u90E8-";e.parents(".u_setting").length>0?t="\u8BBE\u7F6E-":e.parents(".u_news").length>0?t="\u6D88\u606F-":e.parents(".u_username").length>0&&(t="\u7528\u6237\u540D-");var i=$.trim($(this).text()).replace(/[(\s\d)]+/,"");(0==$.trim(e.html()).length||e.hasClass("u_username_wrap"))&&(i=e.tbattr("title")),e.hasClass("j_cleardata")&&(t="\u6D88\u606F-"),i=t+i,$.stats.track(i,"\u8D34\u5427\u9876\u90E8\u5BFC\u822A\u70B9\u51FB\u7EDF\u8BA1")}),this._userinfo.is_login)this._buildLoginLayout(),this._buildNews(),t._buildOfflineCard(),TbCom.process("User","getUserInfoByRequest",function(e){t._initURLs(e),t._buildUsername(e),t._buildUSetting(e),t._buildToHome(e),t._buildToExtraUrl(),t._buildMember(e),e.is_videocreator&&t.requireInstance("common/widget/creative_bar",[t.$root]),(e.is_business_agent||e.is_tiebaplus_agent)&&t.requireInstance("common/widget/business_agent",[t.$root,e.is_business_agent]),t.requireInstance("common/widget/official_bar",[t.$root]);var i=$("#com_userbar").width();$("#head .j_search_nav").css("margin-right",i),$("#f_header").size()>0&&$("#f_header").hasClass("dasou_userbar_style")&&($("#com_userbar").addClass("com_userbar_dasou_style"),$("#head .j_search_nav").css("margin-right",0))});else{this._buildLogoutLayout(),this._buildToHome(),this._buildToExtraUrl(),this._buildMember();var a=$("#com_userbar").width();$("#head .j_search_nav").css("margin-right",a),$("#f_header").size()>0&&$("#f_header").hasClass("dasou_userbar_style")&&($("#com_userbar").addClass("com_userbar_dasou_style"),$("#head .j_search_nav").css("margin-right",0))}this._bindEvent(o)},_buildLoginLayout:function(){var e=["<ul>",'<li class="u_split"></li>','<li class="u_bdhome"></li>','<li class="u_extraurl"></li>','<li class="u_username" id="j_u_username"></li>','<li class="u_news"></li>','<li class="u_creative"></li>','<li class="u_official"></li>','<li class="u_agent"></li>','<li class="u_member"></li>','<li class="u_setting"></li>',"</ul>"].join("");this.$root.html(e),this._btns.logout=$('<a  rel="noopener" href="#" >\u9000\u51FA</a>')},_buildLogoutLayout:function(){var e=["<ul>",'<li class="u_split"></li>','<li class="u_bdhome"></li>','<li class="u_extraurl"></li>','<li class="u_login"></li>','<li class="u_reg"></li>','<li class="u_hermes"></li>','<li class="u_member"></li>',"</ul>"].join("");this._btns.reg=$('<div class="u_menu_item"><a  rel="noopener" href="https://passport.baidu.com/v2/?reg&tpl=tb&u=//tieba.baidu.com?tb_mod=userBar&tb_fr=index" onclick="return false;" >\u6CE8\u518C</a></div>'),this._btns.login=$('<div class="u_menu_item"><a  rel="noopener" href="#" onclick="return false;">\u767B\u5F55</a></div>'),this._btns.hermes=$('<div class="u_menu_item"><a  rel="noopener" href="/hermes/feedback">\u95EE\u9898\u53CD\u9988</a></div>'),this.$root.html(e),this.$root.find(".u_reg").append(this._btns.reg),this.$root.find(".u_login").append(this._btns.login),this.$root.find(".u_hermes").append(this._btns.hermes),this._btns.reg.click(function(){TbCom.process("User","buildRegisterFrame","userBar")}),this._btns.login.click(function(){_.Module.use("common/widget/LoginDialog",["","userBar"])})},_buildUsername:function(e){var t,i=this.$root.find(".u_username"),r=$('<div class="u_menu_item u_menu_username"></div>');t=this.userbarName?this.userbarName:$.tb.transforEmoji(e.show_nickname);var o="",a="";a=e.no_un?"https://passport.baidu.com/v2/?ucenteradduname&u="+encodeURIComponent(location.href):"//tieba.baidu.com/home/main?id="+e.portrait+"&fr=userbar";var n="";e.Parr_props&&e.Parr_props.level&&e.Parr_props.level.end_time>Env.server_time/1e3&&(n='style="color:#FF0000;"'),o='<a  rel="noopener" href="'+a+'" title="\u70B9\u51FB\u5230\u4E2A\u4EBA\u4E2D\u5FC3" class="u_username_wrap">'+o+'<span class="u_username_title" '+n+">"+t+'</span><i class="i-arrow-down"></i></a>',r.html(o),i.append(r);var s="";if(e.rt_room_id){var l="";for(var u in e.rt_room_id)u&&(l=u);s='<li class="u_liveroom"><a  rel="noopener" href="/show/'+l+'" target="_blank">\u6211\u8981\u76F4\u64AD</a></li>'}var _='<ul><li class="u_itieba"><a  rel="noopener" href="/home/main?id='+e.portrait+'&fr=userbar" >\u6211\u7684\u8D34\u5427</a></li><li class="u_mytbmall"><a  rel="noopener" href="/tbmall/mymall" target="_blank">\u6211\u7684\u5546\u57CE</a></li><li class="u_favor" location="user_favor_ch"><a  rel="noopener" href="'+this._urls.my_favor+'" target="_blank">\u6211\u7684\u6536\u85CF</a></li><li class="u_pan"><a  rel="noopener" href="https://pan.baidu.com/" target="_blank">\u6211\u7684\u7F51\u76D8</a></li><li class="u_game"><a  rel="noopener" href="https://wan.baidu.com/user?idfrom=2024" target="_blank">\u6211\u7684\u6E38\u620F</a></li>'+s+"</ul>",c=this._ddls.uname=this.use("DropDownList",i,r,"uname");c.innerContent("top",_)},_buildUSetting:function(e){var t=this,i=this.$root.find(".u_setting"),r=$('<div class="u_menu_item u_menu_setting"><a  rel="noopener" class="u_setting_wrap" href="#" onclick="return false;">\u66F4\u591A<i class="i-arrow-down"></i></a></div>');i.append(r);var o=["<ul>",'<li><a  rel="noopener" href="https://tiebac.baidu.com/c/s/download/pc?src=webtbGF" target="_blank">\u624B\u673AAPP</a></li>','<li><a  rel="noopener" href="/f?kw=%D3%A6%D3%C3%D6%D0%D0%C4&fr=userbar" target="_blank">\u5E94\u7528\u4E2D\u5FC3</a></li>','<li><a  rel="noopener" href="//passport.baidu.com/?center&tpl=tb&aid=6&default_tab=3#3,0">\u5E10\u53F7\u8BBE\u7F6E</a></li>','<li class="u_tb_profile"><a  rel="noopener" href="',this._urls.itb_profile,'">\u8D34\u5427\u8BBE\u7F6E</a></li>','<li class="pm_center"><a  rel="noopener" href="//tieba.baidu.com/pmc" class="j_pmc-center" target="_blank">\u670D\u52A1\u4E2D\u5FC3</a></li>','<li class="fuwu_center"><a  rel="noopener" href="//tieba.baidu.com/hermes/feedback" class="j_help-center" target="_blank">\u95EE\u9898\u53CD\u9988</a></li>','<li class="u_logout"></li>',"</ul>"].join(""),a=this._ddls.usetting=this.use("DropDownList",i,r);a.innerContent("top",o),$("body").on("click.helpcenter",".j_help-center",function(){$.stats.track("helpcenter","UEG-track-click","userbar","click")}),e.no_un&&i.find(".u_tb_profile a").click(function(){return TbCom.process("User","buildUnameFrame"),!1}),i.find(".u_logout").append(this._btns.logout),this._btns.logout.click(function(){t._logout()})},_buildMember:function(e){var t=this,i=this.$root.find(".u_member"),r=$('<div class="u_menu_item u_menu_member"><a  rel="noopener" class="u_member_wrap" href="#" onclick="return false;"><i class="i-member"></i>\u4F1A\u5458<i class="i-arrow-down"></i></a></div>');i.append(r);var o=t._getJoinVip(e),a=["<ul>",'<li><a  rel="noopener" class="dropdown-dou j_wallet" href="#" onclick="return false"><i class="i-dropdown-dou"></i>T\u8C46\u94B1\u5305</a></li>','<li><a  rel="noopener" class="dropdown-tbmall" href="//tieba.baidu.com/tbmall/home" target="_blank"><i class="i-dropdown-tbmall"></i>T\u8C46\u5546\u57CE</a></li>',o,"</ul>"].join(""),n=this._ddls.usetting=this.use("DropDownList",i,r);t.globalSwitch.getOpenAndConvertAsync(function(){a=["<ul>",'<li><a  rel="noopener" class="dropdown-dou j_wallet" href="#" onclick="return false"><i class="i-dropdown-dou"></i>Y\u5E01\u94B1\u5305</a></li>','<li><a  rel="noopener" class="dropdown-tbmall" href="//tieba.baidu.com/tbmall/home" target="_blank"><i class="i-dropdown-tbmall"></i>Y\u5E01\u5546\u57CE</a></li>',o,"</ul>"].join(""),n.innerContent("top",a)},function(){a=["<ul>",'<li><a  rel="noopener" class="dropdown-dou j_wallet" href="#" onclick="return false"><i class="i-dropdown-dou"></i>T\u8C46\u94B1\u5305</a></li>','<li><a  rel="noopener" class="dropdown-tbmall" href="//tieba.baidu.com/tbmall/home" target="_blank"><i class="i-dropdown-tbmall"></i>T\u8C46\u5546\u57CE</a></li>',o,"</ul>"].join(""),n.innerContent("top",a)}),i.on("click",".j_wallet",function(e){$.stats.track(t._is_open_yycurrency("T\u8C46\u5BFC\u822A\u680F"),"\u4F1A\u5458\u5B98\u7F51\u7EDF\u8BA1"),e.preventDefault(),t.requireInstance("common/widget/wallet_dialog").show()}),i.on("click",".j_btn_getmember",function(){if(PageData.user.is_login||_.Module.use("common/widget/LoginDialog",["","userBar"]),t.isMemeber)t._flowRateTest();else{window.open("/tbmall/tshow")}return!1})},_flowRateTest:function(){var e=this.requireInstance("common/widget/payMember"),t={fr:"userbar",scene_id:1001001e3};e.showCashier(t)},_getJoinVip:function(e){var t=!1,i="\u4F1A\u5458\u5B98\u7F51";e&&e.Parr_props&&e.Parr_props.level&&1e3*e.Parr_props.level.end_time>Env.server_time?(t=!0,i=(e.Parr_props.level.props_id>1?"\u7EED\u8D39\u8D85\u7EA7":"\u5347\u7EA7\u8D85\u7EA7")+"\u4F1A\u5458"):e&&e.Parr_props&&e.Parr_props.level&&1e3*e.Parr_props.level.end_time<Env.server_time&&(t=!0,i="\u5F00\u901A\u4F1A\u5458");var r='<li><a  rel="noopener" class="u_joinvip_wrap vip_red j_btn_getmember" href="javascript:;"  target="_blank"><i class="i-dropdown-member"></i>'+i+"</a></li>";return this.isMemeber=t,r},_buildToHome:function(){var e=this,t=this.$root.find(".u_bdhome"),i="\u767E\u5EA6\u9996\u9875",r=e.requireInstance("common/widget/http_transform"),o=r.httpTransform("//www.baidu.com?tn=SE_hldp03480_530ir7bs"),a=$('<div class="u_menu_item u_menu_bdhome j_u_menu_bd_home_link"><a  rel="noopener"  href="'+o+'" target="_blank" onclick="$.stats.track(\'top_baiduhomepage_link\', \'ps_callback_statics\')">'+i+"</a></div>");t.html(a),t.on("click",".j_u_menu_bd_home_link",function(){$.stats.track("\u53EC\u5524\u5EA6\u5A18\u70B9\u51FB\u91CF","\u7528\u6237\u6761")})},_buildToExtraUrl:function(){if(PageData.userBarExtraConfig&&1===+PageData.userBarExtraConfig.switch){$.stats.track("\u6362\u91CF\u5BFC\u6D41","\u7528\u6237\u6761","","view");var e=this,t=this.$root.find(".u_extraurl"),i=PageData.userBarExtraConfig.word,r=e.requireInstance("common/widget/http_transform"),o=r.httpTransform(PageData.userBarExtraConfig.url),a=$('<div class="u_menu_item u_menu_extra_url j_u_menu_extra_url_link"><a  rel="noopener"  href="'+o+'" target="_blank" >'+i+"</a></div>");t.html(a),t.on("click",".j_u_menu_extra_url_link",function(){$.stats.track("\u6362\u91CF\u5BFC\u6D41","\u7528\u6237\u6761","","click")})}},_buildOfflineCard:function(){var e=this,t=1*new Date;t>1408032e6||$.tb.Storage.get("balv_tdou_update")>t||(e.offline_card=this.use("common/widget/Card",{content:'<span style="cursor:pointer;position: absolute;width: 10px; height: 10px; right: 5px; top: 6px;" class="j_close"></span><a  rel="noopener" target="_blank" class="j_link" href="/p/3199708402"><img style="margin: 4px 4px 0;" src="//tb1.bdstatic.com/tb/static-ucenter/img/offline1.png"></a>',clazz:"doupiao_offline",arrow_dir:"up",card_css:{width:172,"z-index":1010,right:10,top:30},arrow_pos:{left:70,top:-8},wrap:$("#com_userbar"),card_leave_display:!0}),e.offline_card._j_card.on("click",".j_close",function(){$.tb.Storage.set("balv_tdou_update",t+864e5),e.offline_card._j_card.remove()}).on("click",".j_link",function(){$.tb.Storage.set("balv_tdou_update",t+864e5),e.offline_card._j_card.remove()}),e.offline_card.showCard())},_buildNews:function(){this.use("common/widget/newMessageSystem")},_logout:function(){var e,t=0,i=this;try{e=PageData.user?PageData.user.name:PageData.user_info.name}catch(r){e=""}try{t="baidubrowser.tieba"==window.external.GetVersion("version")?!0:null}catch(r){t=null}(!$.cookie("baidu_broswer_setup_"+e)&&!t||"NaN"===$.cookie("baidu_broswer_setup_"+e))&&$.cookie("baidu_broswer_setup_"+e,0);var o='<p>\u786E\u5B9A\u8981\u9000\u51FA\u5417\uFF1F\u9000\u51FA\u540E\u5C06\u65E0\u6CD5\u6536\u5230\u5427\u53CB\u4E92\u52A8\u6D88\u606F</p><p><span>\u60A8\u53EF\u4EE5\u9009\u62E9</span><span class = "switch_login">\uFF3B\u5207\u6362\u8D26\u6237\uFF3D</span></p><div class = "quit_logout btn_logout">\u9000\u51FA</div><div class = "cancel_logout btn_logout">\u53D6\u6D88</div>',a=new $.dialog({html:o,height:"120px",width:"430px",title:"\u786E\u5B9A\u8981\u9000\u51FA\u5417\uFF1F",holderClassName:"logout_dialog"});$(".logout_dialog").on("click",".switch_login",function(){return a.close(),i.requireInstance("common/widget/LoginDialog"),!1}).on("click",".cancel_logout",function(){a.close()}).on("click",".quit_logout",function(){TbCom.process("User","logout")})}}}),_.Module.define({path:"common/widget/Userbar/DropDownList",requires:[],sub:{_ite:null,_wrapper:null,key:null,_listWrapper:null,_conWrapper:null,_bottomConWrapper:null,_topConWrapper:null,initial:function(e,t,i){this._wrapper=e,this._ite=t,this.key=i,this._build()},_build:function(){var e=['<div class="u_ddl">','<div class="u_ddl_con">','<span class="u_ddl_arrow"> <em></em> </span>','<div class="u_ddl_con_top"></div>','<div class="d_ddl_con_bottom"></div>',"</div>","</div>"].join("");this._listWrapper=$(e),this._wrapper.append(this._listWrapper),this._conWrapper=this._listWrapper.find(".u_ddl_con:first"),this._topConWrapper=this._listWrapper.find(".u_ddl_con_top:first"),this._bottomConWrapper=this._listWrapper.find(".d_ddl_con_bottom:first"),this._bindEvents()},_bindEvents:function(){var e,t=this;t._wrapper.hover(function(){e&&clearTimeout(e),t.expand()},function(){e=setTimeout(function(){t.close()},0)})},_innerTopContent:function(e){"object"==typeof e?this._topConWrapper.append(e):"string"==typeof e&&this._topConWrapper.html(this._topConWrapper.html()+e)},_innerBottomContent:function(e){"object"==typeof e?this._bottomConWrapper.append(e):"string"==typeof e&&this._bottomConWrapper.html(this._bottomConWrapper.html()+e),this._bottomConWrapper.css("display","block")},expand:function(){var e=this._ite.innerWidth()-16,t=this._listWrapper.width(),i=(e-t)/2;this._listWrapper.css({display:"block",left:i+4})},close:function(){this._listWrapper.css("display","none")},innerContent:function(e,t){"top"==e?this._innerTopContent(t):"bottom"==e&&this._innerBottomContent(t)}}});_.Module.define({path:"common/widget/footer",requires:[],sub:{initial:function(){this._handleEvents()},_handleEvents:function(){var i=$("#btnFroceToPad");i.bind("click",function(){$.cookie("tb_device",null),url=window.location.href.toString(),-1!==url.indexOf("kw")&&-1===url.indexOf("ie=utf-8")&&(url+=-1!==url.indexOf("?")?"&ie=utf-8":"?ie=utf-8"),window.location.href=url})}}});_.Module.define({path:"common/widget/poptip",sub:{_cookieKey:"poptip_0",initial:function(o){o=o||{};var e=$("#common_poptip_html").html(),i=/pv_code=.?(\d+).?/.exec(e);null!=i&&(this._cookieKey="poptip_"+i[1]),this._isShowed(this._cookieKey)||this._show(e,o)},_show:function(o,e){var i=this,t={content:o,arrow_dir:"up",bubble_css:{top:20,right:20,width:null!=e.width?e.width:228},arrow_pos:{right:15},wrap:$("body"),closeBtn:!0,arrowReq:!1},n=new UiBubbleTipBase(t);n.bind("onclose",function(){i._setShowed(i._cookieKey),n.closeBubble()}),n.showBubble()},_setShowed:function(o){$.cookie(o,1,{expires:30})},_isShowed:function(o){return null!=$.cookie(o)}}});_.Module.define({path:"common/widget/AdStats",sub:{adPositionConfig:[{locate:"\u53F3\u4E0A\u65B9button",locateClass:"#search_button",adId:"1"},{locate:"\u53F3\u4FA7\u56FE\u7247",locateClass:"#aside_ad .aside_ad_pic",adId:"2"},{locate:"\u5F39\u7A97",locateClass:"#pop_frame .pop_button_w",adId:"3"},{locate:"PC\u5168\u8D34\u5427\u641C\u7D22\u6846sug\u63A8\u8350\u4F4D\u7F6E\u4E00",locateClass:".suggestion_list .item_top1",adId:"4"},{locate:"PC\u5168\u8D34\u5427\u641C\u7D22\u6846sug\u63A8\u8350\u4F4D\u7F6E\u4E8C",locateClass:".suggestion_list .item_top2",adId:"4"},{locate:"PC\u5168\u8D34\u5427\u641C\u7D22\u6846sug\u63A8\u8350\u4F4D\u7F6E\u4E09",locateClass:".suggestion_list .item_top3",adId:"4"},{locate:"PC\u9996\u9875\u7126\u70B9\u56FE\u7B2C\u4E00\u5E27\u7B2C\u4E00\u5F20",locateClass:"#carousel_wrap .img_list_3pic:eq(0) a:eq(0)",adId:"5"},{locate:"PC\u9996\u9875\u7126\u70B9\u56FE\u7B2C\u4E00\u5E27\u7B2C\u4E8C\u5F20",locateClass:"#carousel_wrap .img_list_3pic:eq(0) a:eq(1)",adId:"6"},{locate:"PC\u9996\u9875\u7126\u70B9\u56FE\u7B2C\u4E00\u5E27\u7B2C\u4E09\u5F20",locateClass:"#carousel_wrap .img_list_3pic:eq(0) a:eq(2)",adId:"7"},{locate:"PC\u9996\u9875\u7126\u70B9\u56FE\u7B2C\u4E8C\u5E27\u7B2C\u4E8C\u5F20",locateClass:"#carousel_wrap .img_list_3pic:eq(1) a:eq(2)",adId:"8"},{locate:"PC\u9996\u9875\u7126\u70B9\u56FE\u7B2C\u4E09\u5E27",locateClass:"#carousel_wrap .img_list_1pic a",adId:"9"},{locate:"PC\u9996\u9875\u6735\u6735\u5947\u5427",locateClass:".rcmd_forum_list a",adId:"10"},{locate:"PC\u9996\u9875\u4E3B\u9898\u5427\u63A8\u8350",locateClass:".gr_f_list .good_forum",adId:"11"},{locate:"PC\u9996\u9875\u6D3B\u52A8\u5927\u5385\u8F6E\u64AD\u56FE",locateClass:".act_slider_area .good_act_page a",adId:"12"},{locate:"PC\u9996\u9875\u6D3B\u52A8\u5E73\u53F0\u63A8\u5E7F\u4F4D",locateClass:"#plat_act_wrapper .platact_lucky",adId:"13"},{locate:"PC\u9996\u9875\u70ED\u95E8\u52A8\u6001\u7B2C\u4E8C\u4F4D\u7F6E",locateClass:"",adId:"14"},{locate:"PC\u9996\u9875\u65B0\u589E\u5165\u9A7B",locateClass:".adide_platform a.pii_img_w, .adide_platform a.h6",adId:"15"},{locate:"PC\u9996\u9875\u53F3\u4FA7\u516C\u544A\u677F\u56FE\u7247",locateClass:"#notice_item a.notice",adId:"16"},{locate:"PC\u9996\u9875\u53F3\u4FA7\u516C\u544A\u677F\u5217\u8868",locateClass:"#notice_item .notice_list a",adId:"16"},{locate:"\u5427\u76AE\u80A4",locateClass:".couplet_left, .couplet_right",adId:"17"},{locate:"\u8D34\u5427\u9876\u90E8\u5934\u56FE",locateClass:".star_banner .j_click_status",adId:"18"},{locate:"\u8D34\u5427\u5DE6\u4FA7\u6D6E\u6807",locateClass:".j_platform_float_content",adId:"19"},{locate:"\u8D34\u5427\u53F3\u4FA7\u6D3B\u52A8\u7EC4\u4EF6",locateClass:".platforum_aside_images .platform_aside_images_img a",adId:"20"},{locate:"\u8D34\u5427\u53F3\u4E0B\u65B9\u89C6\u9891\u7EC4\u4EF6",locateClass:".platform_spread_video a",adId:"21"},{locate:"\u8D34\u5427\u5BFC\u822A\u4E0A\u65B9\u5F3A\u63A8\u5E7F\u6837\u5F0F",locateClass:"",adId:"22"},{locate:"\u8D34\u5427\u53F3\u4FA7\u6587\u5B57\u94FE/\u56FE\u7247\u805A\u5408\u6A21\u5757",locateClass:"",adId:"23"},{locate:"\u8D34\u5427feed\u6D41\u7279\u578B\u62BD\u5956\u8D34",locateClass:".threadlist_detail .platact_lucky",adId:"24"}],adObjType:"\u5E73\u53F0\u5316",adTask:"\u5546\u5E7F\u4F4D\u7EDF\u8BA1",initial:function(){var a=this.adPositionConfig,t=this.adObjType,l=this.adTask;$.each(a,function(){var a=this;this.locateClass&&this.locateClass.length>0&&$("body").on("mousedown",this.locateClass,function(){var e=$(this);$.stats.track(a.locate,l,null,"click",{obj_url:e.tbattr("href")||"-",obj_name:a.adId||"-",obj_type:t})})})}}});_.Module.define({path:"common/widget/verifyManagerPhone",requires:[],sub:{_hasNextTimeButton:null,_template:{_confirmDialog:["<h2>","#{title}","</h2>","<p>","#{text}","</p>"].join(""),_changeBind:["<div>* \u5982\u60A8\u9700\u8981\u6362\u7ED1\u60A8\u7684\u624B\u673A\u540E\u518D\u8FDB\u884C\u7ED1\u5B9A\u9A8C\u8BC1\uFF0C\u8BF7<a target='_blank' href='#{href}'>\u70B9\u6B64\u6362\u7ED1</a>\u3002</div>"].join(""),_complain:["<div>* \u5982\u679C\u60A8\u7533\u8BC9\u8FC7\u7A0B\u4E2D\u51FA\u73B0\u95EE\u9898\u5BFC\u81F4\u65E0\u6CD5\u9A8C\u8BC1\uFF0C\u8BF7<a target='_blank' href='#{href}'>\u70B9\u6B64\u4E13\u8D34</a>\u53CD\u9988\u3002</div>"].join("")},_url:{nextTime:"/bawu2/checkphone/commitActsctrl",getPopPassData:"/bawu2/checkphone/getPhoneToken",verifyDone:"/bawu2/checkphone/commitCheckTime"},initial:function(t){var e=this;e._hasNextTimeButton=!t,e._title=null,e._text=null,t?(e._title="\u5C0A\u656C\u7684\u8D34\u5427\u5427\u4E3B\u7528\u6237",e._text="\u4E3A\u4E86\u60A8\u7684\u8D26\u53F7\u5B89\u5168\uFF0C\u8BF7\u60A8\u8FDB\u884C\u624B\u673A\u7ED1\u5B9A\u9A8C\u8BC1\uFF0C<br/>\u4EE5\u9632\u8D26\u53F7\u88AB\u76D7\u9020\u6210\u635F\u5931\u3002<span class='verify_manager_phone_tip_strong'>\uFF08\u8BBE\u7F6E\u6210\u529F\u540E\u4E0D\u518D\u63D0\u793A\uFF09</span>"):(e._title="\u5C0A\u656C\u7684\u8D34\u5427\u5427\u4E3B\u7528\u6237\uFF1A",e._text="\u4E3A\u4E86\u60A8\u7684\u8D26\u53F7\u5B89\u5168\uFF0C\u5F3A\u70C8\u5EFA\u8BAE\u60A8\u8FDB\u884C\u624B\u673A\u7ED1\u5B9A\u9A8C\u8BC1\uFF0C<br/>\u4EE5\u9632\u8D26\u53F7\u88AB\u76D7\u9020\u6210\u635F\u5931\u3002<span class='verify_manager_phone_tip_strong'>\uFF08\u8BBE\u7F6E\u6210\u529F\u540E\u4E0D\u518D\u63D0\u793A\uFF09</span>"),e._popConfirmDialog()},_startVerify:function(){var t=this;t._getPopPassData(function(e){t._popPassDialog(e.hasBind?"verify":"bind",e.token)},function(){t._onVerifyFail()})},_onVerifyFail:function(t){var e=this;t||(t="\u9A8C\u8BC1\u5931\u8D25~ T_T \u8BF7\u91CD\u8BD5~~");var n={message:"<h2>\u9A8C\u8BC1\u624B\u673A\u5931\u8D25\uFF1A</h2><p>"+t+"</p>",holderClassName:"verify_manager_phone_dialog",buttons:[{text:"\u91CD\u8BD5",callback:function(){e._startVerify()}},{text:"\u53D6\u6D88"}]};n.buttons[0]["class"]="ui_btn_m btn_left",n.buttons[1]["class"]="ui_btn_sub_m",$.tb.alert(n)},_popConfirmDialog:function(){function t(){n._startVerify()}function e(){n._informServerNextTime()}var n=this,a={text:"\u4E0B\u6B21\u518D\u8BF4",callback:e};a["class"]="ui_btn_sub_m";var i={text:"\u7ACB\u5373\u8BBE\u7F6E",callback:t};i["class"]="ui_btn_m btn_left";var o=[i];n._hasNextTimeButton&&o.push(a),$.tb.alert({message:$.tb.format(n._template._confirmDialog,{title:n._title,text:n._text}),holderClassName:"verify_manager_phone_dialog",buttons:o})},_getPopPassData:function(t,e){var n=this;$.ajax({url:n._url.getPopPassData,dataType:"json",success:function(n){n&&0===n.errno?t(n.data):e()},error:e})},_popPassDialog:function(t,e){function n(t){o._informServerVerifyDone(t)}function a(){o._informServerVerifyDone()}function i(){o._onVerifyFail()}var o=this;"verify"===t?o._showMobileVerify(e,a,i):o._showMobileBind(e,n,i)},_showMobileVerify:function(t,e,n){var a=this;$.JsLoadManager.use(["https://passport.baidu.com/passApi/js/uni_forceverify_wrapper.js?cdnversion="+a._getTimeStamp(),"https://passport.bdimg.com/passApi/js/wrapper.js?cdnversion="+a._getTimeStamp()],function(){var i=window.passport.pop.initForceverify({token:t,curType:"mobile",onRender:function(){var t=this,e=$(t.getById("content")),n=e.find(".footer-tip");a._updatePassDialogZIndex(t);var i=$($.tb.format(a._template._changeBind,{href:"//passport.baidu.com/v2/accountsecurity?act=rebindmobile"}));n.prepend(i);var o=$($.tb.format(a._template._complain,{href:"//tieba.baidu.com/p/3472422906"}));n.prepend(o);var r=n&&n.html?n.html()||"":"",s=r.lastIndexOf("<br>");n.html(r.substring(0,s))},onSubmitSuccess:e,onGetapiError:n,onSubmitFailure:n});i.show()},!0,"utf-8")},_showMobileBind:function(t,e,n){var a=this;$.JsLoadManager.use(["https://passport.baidu.com/passApi/js/uni_armorwidget_wrapper.js?cdnversion="+a._getTimeStamp(),"https://passport.bdimg.com/passApi/js/wrapper.js?cdnversion="+a._getTimeStamp()],function(){var i=window.passport.pop.ArmorWidget("bindmobile",{token:t,onRender:function(){var t=this,e=$(t.getById("content")),n=e.find(".footer-tip");a._updatePassDialogZIndex(this);var i=$($.tb.format(a._template._complain,{href:"//tieba.baidu.com/p/3472422906"}));n.prepend(i);var o=n&&n.html?n.html()||"":"",r=o.lastIndexOf("<br>");n.html(o.substring(0,r))},successCountdown:0,onSubmitSuccess:function(t){e(t.bindid)},onInitFail:n,otherValue:{tpl:"tb"}});i.show()},!0,"utf-8")},_informServerNextTime:function(){var t=this;$.ajax(t._url.nextTime)},_informServerVerifyDone:function(t){var e=this,n=function(){$.tb.alert({message:"<h2>\u8BBE\u7F6E\u6210\u529F\uFF01</h2>",holderClassName:"verify_manager_phone_dialog",onclose:function(){location.reload()},buttons:[{text:"\u786E\u8BA4"}]})},a=function(){e._onVerifyFail()},i=e._url.verifyDone;t&&(i+="?bindid="+t),$.ajax({url:i,dataType:"json",success:function(t){t&&0===t.errno?n():a()},error:a})},_getTimeStamp:function(){var t=(new Date).getTime();return Math.floor(t/6e4)},_updatePassDialogZIndex:function(t){var e=$(t.getById("mask")),n=$(t.getById("wrapper"));e.css("zIndex",5e4+parseInt(e.css("zIndex"))),n.css("zIndex",5e4+parseInt(n.css("zIndex")))}}});